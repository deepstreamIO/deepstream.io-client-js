!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("deepstream",[],t):"object"==typeof exports?exports.deepstream=t():e.deepstream=t()}(window,function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=33)}([function(e,t,n){"use strict";var r,i,o,s,a,c,u,h,l,E,f;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.payloadEncoding="e",e.name="n",e.names="m",e.subscription="s",e.correlationId="c",e.version="v",e.path="p",e.reason="r",e.url="u",e.originalTopic="t",e.originalAction="a",e.protocolVersion="x",e.requestorName="rn",e.requestorData="rd",e.trustedSender="ts",e.registryTopic="rt"}(t.META_KEYS||(t.META_KEYS={})),function(e){e.JSON="j",e.BINARY="b"}(t.PAYLOAD_ENCODING||(t.PAYLOAD_ENCODING={})),function(e){e[e.ERROR=0]="ERROR",e[e.PARSER=1]="PARSER",e[e.CONNECTION=2]="CONNECTION",e[e.AUTH=3]="AUTH",e[e.EVENT=4]="EVENT",e[e.RECORD=5]="RECORD",e[e.RPC=6]="RPC",e[e.PRESENCE=7]="PRESENCE",e[e.SUBSCRIPTIONS=16]="SUBSCRIPTIONS",e[e.ONLINE_USERS=17]="ONLINE_USERS",e[e.EVENT_SUBSCRIPTIONS=32]="EVENT_SUBSCRIPTIONS",e[e.RECORD_SUBSCRIPTIONS=33]="RECORD_SUBSCRIPTIONS",e[e.RPC_SUBSCRIPTIONS=34]="RPC_SUBSCRIPTIONS",e[e.PRESENCE_SUBSCRIPTIONS=35]="PRESENCE_SUBSCRIPTIONS",e[e.RECORD_LISTEN_PATTERNS=36]="RECORD_LISTEN_PATTERNS",e[e.EVENT_LISTEN_PATTERNS=37]="EVENT_LISTEN_PATTERNS",e[e.RECORD_PUBLISHED_SUBSCRIPTIONS=38]="RECORD_PUBLISHED_SUBSCRIPTIONS",e[e.EVENT_PUBLISHED_SUBSCRIPTIONS=39]="EVENT_PUBLISHED_SUBSCRIPTIONS",e[e.RECORD_LISTENING=40]="RECORD_LISTENING",e[e.EVENT_LISTENING=41]="EVENT_LISTENING",e[e.STATE_REGISTRY=48]="STATE_REGISTRY",e[e.CLUSTER=49]="CLUSTER",e[e.LOCK=50]="LOCK"}(r=t.TOPIC||(t.TOPIC={})),function(e){e[e.UNKNOWN_TOPIC=80]="UNKNOWN_TOPIC",e[e.UNKNOWN_ACTION=81]="UNKNOWN_ACTION",e[e.INVALID_MESSAGE=82]="INVALID_MESSAGE",e[e.MESSAGE_PARSE_ERROR=83]="MESSAGE_PARSE_ERROR",e[e.MAXIMUM_MESSAGE_SIZE_EXCEEDED=84]="MAXIMUM_MESSAGE_SIZE_EXCEEDED",e[e.ERROR=85]="ERROR",e[e.INVALID_META_PARAMS=86]="INVALID_META_PARAMS"}(i=t.PARSER_ACTIONS||(t.PARSER_ACTIONS={})),function(e){e[e.ERROR=0]="ERROR",e[e.PING=1]="PING",e[e.PONG=2]="PONG",e[e.ACCEPT=3]="ACCEPT",e[e.CHALLENGE=4]="CHALLENGE",e[e.REJECT=6]="REJECT",e[e.REDIRECT=7]="REDIRECT",e[e.CLOSING=8]="CLOSING",e[e.CLOSED=9]="CLOSED",e[e.AUTHENTICATION_TIMEOUT=80]="AUTHENTICATION_TIMEOUT",e[e.INVALID_MESSAGE=82]="INVALID_MESSAGE"}(o=t.CONNECTION_ACTIONS||(t.CONNECTION_ACTIONS={})),function(e){e[e.ERROR=0]="ERROR",e[e.REQUEST=1]="REQUEST",e[e.AUTH_SUCCESSFUL=2]="AUTH_SUCCESSFUL",e[e.AUTH_UNSUCCESSFUL=3]="AUTH_UNSUCCESSFUL",e[e.TOO_MANY_AUTH_ATTEMPTS=80]="TOO_MANY_AUTH_ATTEMPTS",e[e.INVALID_MESSAGE=82]="INVALID_MESSAGE",e[e.INVALID_MESSAGE_DATA=98]="INVALID_MESSAGE_DATA"}(s=t.AUTH_ACTIONS||(t.AUTH_ACTIONS={})),function(e){e[e.ERROR=0]="ERROR",e[e.EMIT=1]="EMIT",e[e.SUBSCRIBE=2]="SUBSCRIBE",e[e.SUBSCRIBE_ACK=130]="SUBSCRIBE_ACK",e[e.UNSUBSCRIBE=3]="UNSUBSCRIBE",e[e.UNSUBSCRIBE_ACK=131]="UNSUBSCRIBE_ACK",e[e.LISTEN=4]="LISTEN",e[e.LISTEN_ACK=132]="LISTEN_ACK",e[e.UNLISTEN=5]="UNLISTEN",e[e.UNLISTEN_ACK=133]="UNLISTEN_ACK",e[e.LISTEN_ACCEPT=6]="LISTEN_ACCEPT",e[e.LISTEN_REJECT=7]="LISTEN_REJECT",e[e.SUBSCRIPTION_FOR_PATTERN_FOUND=8]="SUBSCRIPTION_FOR_PATTERN_FOUND",e[e.SUBSCRIPTION_FOR_PATTERN_REMOVED=9]="SUBSCRIPTION_FOR_PATTERN_REMOVED",e[e.INVALID_LISTEN_REGEX=80]="INVALID_LISTEN_REGEX",e[e.MESSAGE_PERMISSION_ERROR=96]="MESSAGE_PERMISSION_ERROR",e[e.MESSAGE_DENIED=97]="MESSAGE_DENIED",e[e.INVALID_MESSAGE_DATA=98]="INVALID_MESSAGE_DATA",e[e.MULTIPLE_SUBSCRIPTIONS=99]="MULTIPLE_SUBSCRIPTIONS",e[e.NOT_SUBSCRIBED=100]="NOT_SUBSCRIBED"}(a=t.EVENT_ACTIONS||(t.EVENT_ACTIONS={})),function(e){e[e.ERROR=0]="ERROR",e[e.READ=1]="READ",e[e.READ_RESPONSE=2]="READ_RESPONSE",e[e.HEAD=3]="HEAD",e[e.HEAD_RESPONSE=4]="HEAD_RESPONSE",e[e.DELETE=5]="DELETE",e[e.DELETE_SUCCESS=6]="DELETE_SUCCESS",e[e.DELETED=8]="DELETED",e[e.WRITE_ACKNOWLEDGEMENT=9]="WRITE_ACKNOWLEDGEMENT",e[e.CREATE=16]="CREATE",e[e.CREATEANDUPDATE=17]="CREATEANDUPDATE",e[e.CREATEANDUPDATE_WITH_WRITE_ACK=18]="CREATEANDUPDATE_WITH_WRITE_ACK",e[e.CREATEANDPATCH=19]="CREATEANDPATCH",e[e.CREATEANDPATCH_WITH_WRITE_ACK=20]="CREATEANDPATCH_WITH_WRITE_ACK",e[e.UPDATE=21]="UPDATE",e[e.UPDATE_WITH_WRITE_ACK=22]="UPDATE_WITH_WRITE_ACK",e[e.PATCH=23]="PATCH",e[e.PATCH_WITH_WRITE_ACK=24]="PATCH_WITH_WRITE_ACK",e[e.ERASE=25]="ERASE",e[e.ERASE_WITH_WRITE_ACK=26]="ERASE_WITH_WRITE_ACK",e[e.SUBSCRIBEANDHEAD=32]="SUBSCRIBEANDHEAD",e[e.SUBSCRIBEANDREAD=34]="SUBSCRIBEANDREAD",e[e.SUBSCRIBECREATEANDREAD=36]="SUBSCRIBECREATEANDREAD",e[e.SUBSCRIBECREATEANDUPDATE=38]="SUBSCRIBECREATEANDUPDATE",e[e.SUBSCRIBE=40]="SUBSCRIBE",e[e.SUBSCRIBE_ACK=168]="SUBSCRIBE_ACK",e[e.UNSUBSCRIBE=41]="UNSUBSCRIBE",e[e.UNSUBSCRIBE_ACK=169]="UNSUBSCRIBE_ACK",e[e.LISTEN=48]="LISTEN",e[e.LISTEN_ACK=176]="LISTEN_ACK",e[e.UNLISTEN=49]="UNLISTEN",e[e.UNLISTEN_ACK=177]="UNLISTEN_ACK",e[e.LISTEN_ACCEPT=50]="LISTEN_ACCEPT",e[e.LISTEN_REJECT=51]="LISTEN_REJECT",e[e.SUBSCRIPTION_HAS_PROVIDER=52]="SUBSCRIPTION_HAS_PROVIDER",e[e.SUBSCRIPTION_HAS_NO_PROVIDER=53]="SUBSCRIPTION_HAS_NO_PROVIDER",e[e.SUBSCRIPTION_FOR_PATTERN_FOUND=54]="SUBSCRIPTION_FOR_PATTERN_FOUND",e[e.SUBSCRIPTION_FOR_PATTERN_REMOVED=55]="SUBSCRIPTION_FOR_PATTERN_REMOVED",e[e.CACHE_RETRIEVAL_TIMEOUT=80]="CACHE_RETRIEVAL_TIMEOUT",e[e.STORAGE_RETRIEVAL_TIMEOUT=81]="STORAGE_RETRIEVAL_TIMEOUT",e[e.VERSION_EXISTS=82]="VERSION_EXISTS",e[e.RECORD_LOAD_ERROR=83]="RECORD_LOAD_ERROR",e[e.RECORD_CREATE_ERROR=84]="RECORD_CREATE_ERROR",e[e.RECORD_UPDATE_ERROR=85]="RECORD_UPDATE_ERROR",e[e.RECORD_DELETE_ERROR=86]="RECORD_DELETE_ERROR",e[e.RECORD_NOT_FOUND=88]="RECORD_NOT_FOUND",e[e.INVALID_VERSION=89]="INVALID_VERSION",e[e.INVALID_PATCH_ON_HOTPATH=90]="INVALID_PATCH_ON_HOTPATH",e[e.INVALID_LISTEN_REGEX=91]="INVALID_LISTEN_REGEX",e[e.MESSAGE_PERMISSION_ERROR=96]="MESSAGE_PERMISSION_ERROR",e[e.MESSAGE_DENIED=97]="MESSAGE_DENIED",e[e.INVALID_MESSAGE_DATA=98]="INVALID_MESSAGE_DATA",e[e.MULTIPLE_SUBSCRIPTIONS=99]="MULTIPLE_SUBSCRIPTIONS",e[e.NOT_SUBSCRIBED=100]="NOT_SUBSCRIBED"}(c=t.RECORD_ACTIONS||(t.RECORD_ACTIONS={})),function(e){e[e.ERROR=0]="ERROR",e[e.REQUEST=1]="REQUEST",e[e.ACCEPT=2]="ACCEPT",e[e.RESPONSE=3]="RESPONSE",e[e.REJECT=4]="REJECT",e[e.REQUEST_ERROR=5]="REQUEST_ERROR",e[e.PROVIDE=6]="PROVIDE",e[e.PROVIDE_ACK=134]="PROVIDE_ACK",e[e.UNPROVIDE=7]="UNPROVIDE",e[e.UNPROVIDE_ACK=135]="UNPROVIDE_ACK",e[e.NO_RPC_PROVIDER=80]="NO_RPC_PROVIDER",e[e.ACCEPT_TIMEOUT=82]="ACCEPT_TIMEOUT",e[e.MULTIPLE_ACCEPT=83]="MULTIPLE_ACCEPT",e[e.INVALID_RPC_CORRELATION_ID=84]="INVALID_RPC_CORRELATION_ID",e[e.RESPONSE_TIMEOUT=85]="RESPONSE_TIMEOUT",e[e.MULTIPLE_RESPONSE=86]="MULTIPLE_RESPONSE",e[e.MESSAGE_PERMISSION_ERROR=96]="MESSAGE_PERMISSION_ERROR",e[e.MESSAGE_DENIED=97]="MESSAGE_DENIED",e[e.INVALID_MESSAGE_DATA=98]="INVALID_MESSAGE_DATA",e[e.MULTIPLE_PROVIDERS=99]="MULTIPLE_PROVIDERS",e[e.NOT_PROVIDED=100]="NOT_PROVIDED"}(u=t.RPC_ACTIONS||(t.RPC_ACTIONS={})),function(e){e[e.ERROR=0]="ERROR",e[e.QUERY_ALL=1]="QUERY_ALL",e[e.QUERY_ALL_RESPONSE=2]="QUERY_ALL_RESPONSE",e[e.QUERY=3]="QUERY",e[e.QUERY_RESPONSE=4]="QUERY_RESPONSE",e[e.PRESENCE_JOIN=5]="PRESENCE_JOIN",e[e.PRESENCE_JOIN_ALL=6]="PRESENCE_JOIN_ALL",e[e.PRESENCE_LEAVE=7]="PRESENCE_LEAVE",e[e.PRESENCE_LEAVE_ALL=8]="PRESENCE_LEAVE_ALL",e[e.SUBSCRIBE=9]="SUBSCRIBE",e[e.SUBSCRIBE_ACK=137]="SUBSCRIBE_ACK",e[e.UNSUBSCRIBE=10]="UNSUBSCRIBE",e[e.UNSUBSCRIBE_ACK=138]="UNSUBSCRIBE_ACK",e[e.SUBSCRIBE_ALL=11]="SUBSCRIBE_ALL",e[e.SUBSCRIBE_ALL_ACK=139]="SUBSCRIBE_ALL_ACK",e[e.UNSUBSCRIBE_ALL=12]="UNSUBSCRIBE_ALL",e[e.UNSUBSCRIBE_ALL_ACK=140]="UNSUBSCRIBE_ALL_ACK",e[e.INVALID_PRESENCE_USERS=80]="INVALID_PRESENCE_USERS",e[e.MESSAGE_PERMISSION_ERROR=96]="MESSAGE_PERMISSION_ERROR",e[e.MESSAGE_DENIED=97]="MESSAGE_DENIED",e[e.MULTIPLE_SUBSCRIPTIONS=99]="MULTIPLE_SUBSCRIPTIONS",e[e.NOT_SUBSCRIBED=100]="NOT_SUBSCRIBED"}(h=t.PRESENCE_ACTIONS||(t.PRESENCE_ACTIONS={})),function(e){e[e.ERROR=0]="ERROR",e[e.REQUEST=1]="REQUEST",e[e.RESPONSE=2]="RESPONSE",e[e.RELEASE=3]="RELEASE"}(l=t.LOCK_ACTIONS||(t.LOCK_ACTIONS={})),function(e){e[e.ERROR=0]="ERROR",e[e.ADD=1]="ADD",e[e.REMOVE=2]="REMOVE",e[e.REQUEST_FULL_STATE=3]="REQUEST_FULL_STATE",e[e.FULL_STATE=4]="FULL_STATE"}(E=t.STATE_ACTIONS||(t.STATE_ACTIONS={})),function(e){e[e.PING=0]="PING",e[e.PONG=1]="PONG",e[e.CLOSE=2]="CLOSE",e[e.REJECT=3]="REJECT",e[e.REJECT_DUPLICATE=4]="REJECT_DUPLICATE",e[e.IDENTIFICATION_REQUEST=5]="IDENTIFICATION_REQUEST",e[e.IDENTIFICATION_RESPONSE=6]="IDENTIFICATION_RESPONSE",e[e.KNOWN_PEERS=7]="KNOWN_PEERS"}(f=t.CLUSTER_ACTIONS||(t.CLUSTER_ACTIONS={})),t.ACTIONS={[r.PARSER]:i,[r.CONNECTION]:o,[r.AUTH]:s,[r.EVENT]:a,[r.RECORD]:c,[r.RPC]:u,[r.PRESENCE]:h,[r.LOCK]:l,[r.STATE_REGISTRY]:E,[r.CLUSTER]:f},function(e){e.INFO="INFO",e.DEPRECATED="DEPRECATED",e.INCOMING_CONNECTION="INCOMING_CONNECTION",e.CLOSED_SOCKET_INTERACTION="CLOSED_SOCKET_INTERACTION",e.CLIENT_DISCONNECTED="CLIENT_DISCONNECTED",e.CONNECTION_ERROR="CONNECTION_ERROR",e.AUTH_ERROR="AUTH_ERROR",e.PLUGIN_ERROR="PLUGIN_ERROR",e.PLUGIN_INITIALIZATION_ERROR="PLUGIN_INITIALIZATION_ERROR",e.PLUGIN_INITIALIZATION_TIMEOUT="PLUGIN_INITIALIZATION_TIMEOUT",e.TIMEOUT="TIMEOUT",e.LEADING_LISTEN="LEADING_LISTEN",e.LOCAL_LISTEN="LOCAL_LISTEN",e.INVALID_CONFIG_DATA="INVALID_CONFIG_DATA",e.INVALID_STATE_TRANSITION="INVALID_STATE_TRANSITION",e.INVALID_LEADER_REQUEST="INVALID_LEADER_REQUEST"}(t.EVENT||(t.EVENT={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.UNSOLICITED_MESSAGE=0]="UNSOLICITED_MESSAGE",e[e.IS_CLOSED=1]="IS_CLOSED",e[e.MAX_RECONNECTION_ATTEMPTS_REACHED=2]="MAX_RECONNECTION_ATTEMPTS_REACHED",e[e.CONNECTION_ERROR=3]="CONNECTION_ERROR",e[e.ACK_TIMEOUT=4]="ACK_TIMEOUT",e[e.UNKNOWN_CORRELATION_ID=5]="UNKNOWN_CORRELATION_ID",e[e.HEARTBEAT_TIMEOUT=6]="HEARTBEAT_TIMEOUT",e[e.LISTENER_EXISTS=7]="LISTENER_EXISTS",e[e.NOT_LISTENING=8]="NOT_LISTENING",e[e.RECORD_ALREADY_DESTROYED=9]="RECORD_ALREADY_DESTROYED",e[e.RECORD_DELETE_TIMEOUT=10]="RECORD_DELETE_TIMEOUT",e.CLIENT_OFFLINE="client offline",e.INVALID_AUTHENTICATION_DETAILS="INVALID_AUTHENTICATION_DETAILS",e.CONNECTION_LOST="connectionLost",e.CONNECTION_REESTABLISHED="connectionReestablished",e.EXIT_LIMBO="exitLimbo",e.CONNECTION_STATE_CHANGED="connectionStateChanged",e.CLIENT_DATA_CHANGED="clientDataChanged",e.REAUTHENTICATION_FAILURE="reauthenticationFailure",e.AUTHENTICATION_TIMEOUT="AUTHENTICATION_TIMEOUT",e.RECORD_ERROR="error",e.RECORD_READY="ready",e.RECORD_DELETED="delete",e.RECORD_DISCARDED="discard",e.RECORD_VERSION_EXISTS="versionExists",e.RECORD_HAS_PROVIDER_CHANGED="hasProviderChanged",e.RECORD_STATE_CHANGED="onRecordStateChanged",e.ENTRY_ADDED_EVENT="entry-added",e.ENTRY_REMOVED_EVENT="entry-removed",e.ENTRY_MOVED_EVENT="entry-moved"}(t.EVENT||(t.EVENT={})),function(e){e.CLOSING="CLOSING",e.CLOSED="CLOSED",e.INITIALISING="INITIALISING",e.AWAITING_CONNECTION="AWAITING_CONNECTION",e.CHALLENGING="CHALLENGING",e.AWAITING_AUTHENTICATION="AWAITING_AUTHENTICATION",e.AUTHENTICATING="AUTHENTICATING",e.OPEN="OPEN",e.ERROR="ERROR",e.RECONNECTING="RECONNECTING",e.REDIRECTING="REDIRECTING",e.CHALLENGE_DENIED="CHALLENGE_DENIED",e.TOO_MANY_AUTH_ATTEMPTS="TOO_MANY_AUTH_ATTEMPTS",e.AUTHENTICATION_TIMEOUT="AUTHENTICATION_TIMEOUT",e.PAUSING="PAUSING",e.OFFLINE="OFFLINE"}(t.CONNECTION_STATE||(t.CONNECTION_STATE={}))},function(e,t,n){function r(e){if(e)return function(e){for(var t in r.prototype)e[t]=r.prototype[t];return e}(e)}e.exports=r,r.prototype.on=r.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||Object.create(null),(this._callbacks[e]=this._callbacks[e]||[]).push(t),this},r.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},r.prototype.off=r.prototype.removeListener=r.prototype.removeAllListeners=r.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||Object.create(null),0==arguments.length)return this._callbacks=Object.create(null),this;var n,r=this._callbacks[e];if(!r)return this;if(1==arguments.length)return delete this._callbacks[e],this;for(var i=0;i<r.length;i++)if((n=r[i])===t||n.fn===t){r.splice(i,1);break}return 0===r.length&&delete this._callbacks[e],this},r.prototype.emit=function(e){this._callbacks=this._callbacks||Object.create(null);for(var t=new Array(arguments.length-1),n=this._callbacks[e],r=1;r<arguments.length;r++)t[r-1]=arguments[r];if(n){r=0;for(var i=(n=n.slice(0)).length;r<i;++r)n[r].apply(this,t)}return this},r.prototype.listeners=function(e){return this._callbacks=this._callbacks||Object.create(null),this._callbacks[e]||[]},r.prototype.hasListeners=function(e){return!!this.listeners(e).length},r.prototype.eventNames=function(){return this._callbacks?Object.keys(this._callbacks):[]}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(54),i=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;t.trim=function(e){return e.trim?e.trim():e.replace(i,"")},t.deepEquals=((e,t)=>e===t||"object"==typeof e&&"object"==typeof t&&JSON.stringify(e)===JSON.stringify(t)),t.deepCopy=(e=>"object"==typeof e?JSON.parse(JSON.stringify(e)):e),t.shallowCopy=(e=>{if(Array.isArray(e))return e.slice(0);if("object"==typeof e){const t=Object.create(null),n=Object.keys(e);for(let r=0;r<n.length;r++)t[n[r]]=e[n[r]];return t}return e});const o=/^wss:|^ws:|^\/\//,s=/^http:|^https:/;t.parseUrl=((e,t)=>{let n=e;if(s.test(n))throw new Error("Only ws and wss are supported");o.test(n)?0===n.indexOf("//")&&(n=`ws:${n}`):n=`ws://${n}`;const i=r.parse(n);if(!i.host)throw new Error("invalid url, missing host");return i.protocol=i.protocol?i.protocol:"ws:",i.pathname=i.pathname?i.pathname:t,r.format(i)}),t.getUid=(()=>{return`${(new Date).getTime().toString(36)}-${(1e16*Math.random()).toString(36).replace(".","")}`}),t.normalizeSetArguments=((e,t=0)=>{let n;const r=e=>void 0!==e&&"object"==typeof e,i=e=>"function"!=typeof e,o=e=>void 0!==e&&"string"==typeof e,s=e=>"function"==typeof e;if(e.length===t+1&&(n={path:void 0,data:r(e[t])?e[t]:void 0,callback:void 0}),e.length===t+2&&(n={path:void 0,data:void 0,callback:void 0},!s(e[t])&&i(e[t])&&(n.path=o(e[t])?e[t]:void 0),o(e[t])?n.data=i(e[t+1])?e[t+1]:void 0:n.data=r(e[t])?e[t]:void 0,o(e[t])||(n.callback=!!s(e[t+1])&&e[t+1])),e.length===t+3&&(n={path:o(e[t])?e[t]:void 0,data:i(e[t+1])?e[t+1]:void 0,callback:s(e[t+2])?e[t+2]:void 0}),n){if(void 0!==n.path&&0===n.path.length||void 0===n.path&&!n.data)throw Error("Invalid set path argument");if(void 0===n.data&&void 0===n.path)throw Error("Invalid set data argument");if(void 0!==n.callback&&!1===n.callback||void 0===n.callback&&e.length===t+3)throw Error("Invalid set callback argument");return n}throw Error("Invalid set arguments")}),t.normalizeArguments=(e=>{if(1===e.length&&"object"==typeof e[0])return e[0];const t=Object.create(null);for(let n=0;n<e.length;n++)"string"==typeof e[n]?t.path=e[n]:"function"==typeof e[n]?t.callback=e[n]:"boolean"==typeof e[n]&&(t.triggerNow=e[n]);return t})},function(e,t,n){"use strict";(function(e){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
var r=n(44),i=n(45),o=n(46);function s(){return c.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function a(e,t){if(s()<t)throw new RangeError("Invalid typed array length");return c.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=c.prototype:(null===e&&(e=new c(t)),e.length=t),e}function c(e,t,n){if(!(c.TYPED_ARRAY_SUPPORT||this instanceof c))return new c(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return l(this,e)}return u(this,e,t,n)}function u(e,t,n,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,r){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");t=void 0===n&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r);c.TYPED_ARRAY_SUPPORT?(e=t).__proto__=c.prototype:e=E(e,t);return e}(e,t,n,r):"string"==typeof t?function(e,t,n){"string"==typeof n&&""!==n||(n="utf8");if(!c.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|d(t,n),i=(e=a(e,r)).write(t,n);i!==r&&(e=e.slice(0,i));return e}(e,t,n):function(e,t){if(c.isBuffer(t)){var n=0|f(t.length);return 0===(e=a(e,n)).length?e:(t.copy(e,0,0,n),e)}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(r=t.length)!=r?a(e,0):E(e,t);if("Buffer"===t.type&&o(t.data))return E(e,t.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function h(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function l(e,t){if(h(t),e=a(e,t<0?0:0|f(t)),!c.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function E(e,t){var n=t.length<0?0:0|f(t.length);e=a(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function f(e){if(e>=s())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s().toString(16)+" bytes");return 0|e}function d(e,t){if(c.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return G(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return H(e).length;default:if(r)return G(e).length;t=(""+t).toLowerCase(),r=!0}}function p(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function S(e,t,n,r,i){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof t&&(t=c.from(t,r)),c.isBuffer(t))return 0===t.length?-1:T(e,t,n,r,i);if("number"==typeof t)return t&=255,c.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):T(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function T(e,t,n,r,i){var o,s=1,a=e.length,c=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;s=2,a/=2,c/=2,n/=2}function u(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(i){var h=-1;for(o=n;o<a;o++)if(u(e,o)===u(t,-1===h?0:o-h)){if(-1===h&&(h=o),o-h+1===c)return h*s}else-1!==h&&(o-=o-h),h=-1}else for(n+c>a&&(n=a-c),o=n;o>=0;o--){for(var l=!0,E=0;E<c;E++)if(u(e,o+E)!==u(t,E)){l=!1;break}if(l)return o}return-1}function _(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var o=t.length;if(o%2!=0)throw new TypeError("Invalid hex string");r>o/2&&(r=o/2);for(var s=0;s<r;++s){var a=parseInt(t.substr(2*s,2),16);if(isNaN(a))return s;e[n+s]=a}return s}function C(e,t,n,r){return V(G(t,e.length-n),e,n,r)}function R(e,t,n,r){return V(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function O(e,t,n,r){return R(e,t,n,r)}function N(e,t,n,r){return V(H(t),e,n,r)}function g(e,t,n,r){return V(function(e,t){for(var n,r,i,o=[],s=0;s<e.length&&!((t-=2)<0);++s)n=e.charCodeAt(s),r=n>>8,i=n%256,o.push(i),o.push(r);return o}(t,e.length-n),e,n,r)}function A(e,t,n){return 0===t&&n===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,n))}function I(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var o,s,a,c,u=e[i],h=null,l=u>239?4:u>223?3:u>191?2:1;if(i+l<=n)switch(l){case 1:u<128&&(h=u);break;case 2:128==(192&(o=e[i+1]))&&(c=(31&u)<<6|63&o)>127&&(h=c);break;case 3:o=e[i+1],s=e[i+2],128==(192&o)&&128==(192&s)&&(c=(15&u)<<12|(63&o)<<6|63&s)>2047&&(c<55296||c>57343)&&(h=c);break;case 4:o=e[i+1],s=e[i+2],a=e[i+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&(c=(15&u)<<18|(63&o)<<12|(63&s)<<6|63&a)>65535&&c<1114112&&(h=c)}null===h?(h=65533,l=1):h>65535&&(h-=65536,r.push(h>>>10&1023|55296),h=56320|1023&h),r.push(h),i+=l}return function(e){var t=e.length;if(t<=m)return String.fromCharCode.apply(String,e);var n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=m));return n}(r)}t.Buffer=c,t.SlowBuffer=function(e){+e!=e&&(e=0);return c.alloc(+e)},t.INSPECT_MAX_BYTES=50,c.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=s(),c.poolSize=8192,c._augment=function(e){return e.__proto__=c.prototype,e},c.from=function(e,t,n){return u(null,e,t,n)},c.TYPED_ARRAY_SUPPORT&&(c.prototype.__proto__=Uint8Array.prototype,c.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&c[Symbol.species]===c&&Object.defineProperty(c,Symbol.species,{value:null,configurable:!0})),c.alloc=function(e,t,n){return function(e,t,n,r){return h(t),t<=0?a(e,t):void 0!==n?"string"==typeof r?a(e,t).fill(n,r):a(e,t).fill(n):a(e,t)}(null,e,t,n)},c.allocUnsafe=function(e){return l(null,e)},c.allocUnsafeSlow=function(e){return l(null,e)},c.isBuffer=function(e){return!(null==e||!e._isBuffer)},c.compare=function(e,t){if(!c.isBuffer(e)||!c.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,i=0,o=Math.min(n,r);i<o;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},c.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(e,t){if(!o(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return c.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=c.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var s=e[n];if(!c.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(r,i),i+=s.length}return r},c.byteLength=d,c.prototype._isBuffer=!0,c.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)p(this,t,t+1);return this},c.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)p(this,t,t+3),p(this,t+1,t+2);return this},c.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)p(this,t,t+7),p(this,t+1,t+6),p(this,t+2,t+5),p(this,t+3,t+4);return this},c.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?I(this,0,e):function(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return b(this,t,n);case"utf8":case"utf-8":return I(this,t,n);case"ascii":return v(this,t,n);case"latin1":case"binary":return y(this,t,n);case"base64":return A(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return D(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}.apply(this,arguments)},c.prototype.equals=function(e){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===c.compare(this,e)},c.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(e+=" ... ")),"<Buffer "+e+">"},c.prototype.compare=function(e,t,n,r,i){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return-1;if(t>=n)return 1;if(this===e)return 0;for(var o=(i>>>=0)-(r>>>=0),s=(n>>>=0)-(t>>>=0),a=Math.min(o,s),u=this.slice(r,i),h=e.slice(t,n),l=0;l<a;++l)if(u[l]!==h[l]){o=u[l],s=h[l];break}return o<s?-1:s<o?1:0},c.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},c.prototype.indexOf=function(e,t,n){return S(this,e,t,n,!0)},c.prototype.lastIndexOf=function(e,t,n){return S(this,e,t,n,!1)},c.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return _(this,e,t,n);case"utf8":case"utf-8":return C(this,e,t,n);case"ascii":return R(this,e,t,n);case"latin1":case"binary":return O(this,e,t,n);case"base64":return N(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return g(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var m=4096;function v(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function y(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function b(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",o=t;o<n;++o)i+=Y(e[o]);return i}function D(e,t,n){for(var r=e.slice(t,n),i="",o=0;o<r.length;o+=2)i+=String.fromCharCode(r[o]+256*r[o+1]);return i}function P(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function w(e,t,n,r,i,o){if(!c.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<o)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function L(e,t,n,r){t<0&&(t=65535+t+1);for(var i=0,o=Math.min(e.length-n,2);i<o;++i)e[n+i]=(t&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function M(e,t,n,r){t<0&&(t=4294967295+t+1);for(var i=0,o=Math.min(e.length-n,4);i<o;++i)e[n+i]=t>>>8*(r?i:3-i)&255}function U(e,t,n,r,i,o){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function B(e,t,n,r,o){return o||U(e,0,n,4),i.write(e,t,n,r,23,4),n+4}function k(e,t,n,r,o){return o||U(e,0,n,8),i.write(e,t,n,r,52,8),n+8}c.prototype.slice=function(e,t){var n,r=this.length;if((e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e),c.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=c.prototype;else{var i=t-e;n=new c(i,void 0);for(var o=0;o<i;++o)n[o]=this[o+e]}return n},c.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||P(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r},c.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||P(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},c.prototype.readUInt8=function(e,t){return t||P(e,1,this.length),this[e]},c.prototype.readUInt16LE=function(e,t){return t||P(e,2,this.length),this[e]|this[e+1]<<8},c.prototype.readUInt16BE=function(e,t){return t||P(e,2,this.length),this[e]<<8|this[e+1]},c.prototype.readUInt32LE=function(e,t){return t||P(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},c.prototype.readUInt32BE=function(e,t){return t||P(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},c.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||P(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},c.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||P(e,t,this.length);for(var r=t,i=1,o=this[e+--r];r>0&&(i*=256);)o+=this[e+--r]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*t)),o},c.prototype.readInt8=function(e,t){return t||P(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},c.prototype.readInt16LE=function(e,t){t||P(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt16BE=function(e,t){t||P(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt32LE=function(e,t){return t||P(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},c.prototype.readInt32BE=function(e,t){return t||P(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},c.prototype.readFloatLE=function(e,t){return t||P(e,4,this.length),i.read(this,e,!0,23,4)},c.prototype.readFloatBE=function(e,t){return t||P(e,4,this.length),i.read(this,e,!1,23,4)},c.prototype.readDoubleLE=function(e,t){return t||P(e,8,this.length),i.read(this,e,!0,52,8)},c.prototype.readDoubleBE=function(e,t){return t||P(e,8,this.length),i.read(this,e,!1,52,8)},c.prototype.writeUIntLE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||w(this,e,t,n,Math.pow(2,8*n)-1,0);var i=1,o=0;for(this[t]=255&e;++o<n&&(i*=256);)this[t+o]=e/i&255;return t+n},c.prototype.writeUIntBE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||w(this,e,t,n,Math.pow(2,8*n)-1,0);var i=n-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+n},c.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||w(this,e,t,1,255,0),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},c.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||w(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):L(this,e,t,!0),t+2},c.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||w(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):L(this,e,t,!1),t+2},c.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||w(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):M(this,e,t,!0),t+4},c.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||w(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):M(this,e,t,!1),t+4},c.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);w(this,e,t,n,i-1,-i)}var o=0,s=1,a=0;for(this[t]=255&e;++o<n&&(s*=256);)e<0&&0===a&&0!==this[t+o-1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+n},c.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);w(this,e,t,n,i-1,-i)}var o=n-1,s=1,a=0;for(this[t+o]=255&e;--o>=0&&(s*=256);)e<0&&0===a&&0!==this[t+o+1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+n},c.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||w(this,e,t,1,127,-128),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},c.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||w(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):L(this,e,t,!0),t+2},c.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||w(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):L(this,e,t,!1),t+2},c.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||w(this,e,t,4,2147483647,-2147483648),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):M(this,e,t,!0),t+4},c.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||w(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):M(this,e,t,!1),t+4},c.prototype.writeFloatLE=function(e,t,n){return B(this,e,t,!0,n)},c.prototype.writeFloatBE=function(e,t,n){return B(this,e,t,!1,n)},c.prototype.writeDoubleLE=function(e,t,n){return k(this,e,t,!0,n)},c.prototype.writeDoubleBE=function(e,t,n){return k(this,e,t,!1,n)},c.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i,o=r-n;if(this===e&&n<t&&t<r)for(i=o-1;i>=0;--i)e[i+t]=this[i+n];else if(o<1e3||!c.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)e[i+t]=this[i+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+o),t);return o},c.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!c.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var o;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(o=t;o<n;++o)this[o]=e;else{var s=c.isBuffer(e)?e:G(new c(e,r).toString()),a=s.length;for(o=0;o<n-t;++o)this[o+t]=s[o%a]}return this};var K=/[^+\/0-9A-Za-z-_]/g;function Y(e){return e<16?"0"+e.toString(16):e.toString(16)}function G(e,t){var n;t=t||1/0;for(var r=e.length,i=null,o=[],s=0;s<r;++s){if((n=e.charCodeAt(s))>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(s+1===r){(t-=3)>-1&&o.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&o.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function H(e){return r.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(K,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function V(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}}).call(this,n(5))},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},function(e,t,n){"use strict";var r=n(12),i=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t};e.exports=l;var o=n(10);o.inherits=n(6);var s=n(27),a=n(16);o.inherits(l,s);for(var c=i(a.prototype),u=0;u<c.length;u++){var h=c[u];l.prototype[h]||(l.prototype[h]=a.prototype[h])}function l(e){if(!(this instanceof l))return new l(e);s.call(this,e),a.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",E)}function E(){this.allowHalfOpen||this._writableState.ended||r.nextTick(f,this)}function f(e){e.end()}Object.defineProperty(l.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(l.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}}),l.prototype._destroy=function(e,t){this.push(null),this.end(),r.nextTick(t,e)}},function(e,t){t.getArg=function(e,t,n){if(t in e)return e[t];if(3===arguments.length)return n;throw new Error('"'+t+'" is a required argument.')};var n=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,r=/^data:.+\,.+$/;function i(e){var t=e.match(n);return t?{scheme:t[1],auth:t[2],host:t[3],port:t[4],path:t[5]}:null}function o(e){var t="";return e.scheme&&(t+=e.scheme+":"),t+="//",e.auth&&(t+=e.auth+"@"),e.host&&(t+=e.host),e.port&&(t+=":"+e.port),e.path&&(t+=e.path),t}function s(e){var n=e,r=i(e);if(r){if(!r.path)return e;n=r.path}for(var s,a=t.isAbsolute(n),c=n.split(/\/+/),u=0,h=c.length-1;h>=0;h--)"."===(s=c[h])?c.splice(h,1):".."===s?u++:u>0&&(""===s?(c.splice(h+1,u),u=0):(c.splice(h,2),u--));return""===(n=c.join("/"))&&(n=a?"/":"."),r?(r.path=n,o(r)):n}function a(e,t){""===e&&(e="."),""===t&&(t=".");var n=i(t),a=i(e);if(a&&(e=a.path||"/"),n&&!n.scheme)return a&&(n.scheme=a.scheme),o(n);if(n||t.match(r))return t;if(a&&!a.host&&!a.path)return a.host=t,o(a);var c="/"===t.charAt(0)?t:s(e.replace(/\/+$/,"")+"/"+t);return a?(a.path=c,o(a)):c}t.urlParse=i,t.urlGenerate=o,t.normalize=s,t.join=a,t.isAbsolute=function(e){return"/"===e.charAt(0)||n.test(e)},t.relative=function(e,t){""===e&&(e="."),e=e.replace(/\/$/,"");for(var n=0;0!==t.indexOf(e+"/");){var r=e.lastIndexOf("/");if(r<0)return t;if((e=e.slice(0,r)).match(/^([^\/]+:\/)?\/*$/))return t;++n}return Array(n+1).join("../")+t.substr(e.length+1)};var c=!("__proto__"in Object.create(null));function u(e){return e}function h(e){if(!e)return!1;var t=e.length;if(t<9)return!1;if(95!==e.charCodeAt(t-1)||95!==e.charCodeAt(t-2)||111!==e.charCodeAt(t-3)||116!==e.charCodeAt(t-4)||111!==e.charCodeAt(t-5)||114!==e.charCodeAt(t-6)||112!==e.charCodeAt(t-7)||95!==e.charCodeAt(t-8)||95!==e.charCodeAt(t-9))return!1;for(var n=t-10;n>=0;n--)if(36!==e.charCodeAt(n))return!1;return!0}function l(e,t){return e===t?0:null===e?1:null===t?-1:e>t?1:-1}t.toSetString=c?u:function(e){return h(e)?"$"+e:e},t.fromSetString=c?u:function(e){return h(e)?e.slice(1):e},t.compareByOriginalPositions=function(e,t,n){var r=l(e.source,t.source);return 0!==r?r:0!=(r=e.originalLine-t.originalLine)?r:0!=(r=e.originalColumn-t.originalColumn)||n?r:0!=(r=e.generatedColumn-t.generatedColumn)?r:0!=(r=e.generatedLine-t.generatedLine)?r:l(e.name,t.name)},t.compareByGeneratedPositionsDeflated=function(e,t,n){var r=e.generatedLine-t.generatedLine;return 0!==r?r:0!=(r=e.generatedColumn-t.generatedColumn)||n?r:0!==(r=l(e.source,t.source))?r:0!=(r=e.originalLine-t.originalLine)?r:0!=(r=e.originalColumn-t.originalColumn)?r:l(e.name,t.name)},t.compareByGeneratedPositionsInflated=function(e,t){var n=e.generatedLine-t.generatedLine;return 0!==n?n:0!=(n=e.generatedColumn-t.generatedColumn)?n:0!==(n=l(e.source,t.source))?n:0!=(n=e.originalLine-t.originalLine)?n:0!=(n=e.originalColumn-t.originalColumn)?n:l(e.name,t.name)},t.parseSourceMapInput=function(e){return JSON.parse(e.replace(/^\)]}'[^\n]*\n/,""))},t.computeSourceURL=function(e,t,n){if(t=t||"",e&&("/"!==e[e.length-1]&&"/"!==t[0]&&(e+="/"),t=e+t),n){var r=i(n);if(!r)throw new Error("sourceMapURL could not be parsed");if(r.path){var c=r.path.lastIndexOf("/");c>=0&&(r.path=r.path.substring(0,c+1))}t=a(o(r),t)}return s(t)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0);function i(e){const t={};for(const n in e)t[e[n]]=Number(n);return t}t.isWriteAck=function(e){return e===r.RECORD_ACTIONS.CREATEANDPATCH_WITH_WRITE_ACK||e===r.RECORD_ACTIONS.CREATEANDUPDATE_WITH_WRITE_ACK||e===r.RECORD_ACTIONS.PATCH_WITH_WRITE_ACK||e===r.RECORD_ACTIONS.UPDATE_WITH_WRITE_ACK||e===r.RECORD_ACTIONS.ERASE_WITH_WRITE_ACK||e===r.RECORD_ACTIONS.WRITE_ACKNOWLEDGEMENT},t.ACTION_TO_WRITE_ACK={[r.RECORD_ACTIONS.CREATEANDPATCH]:r.RECORD_ACTIONS.CREATEANDPATCH_WITH_WRITE_ACK,[r.RECORD_ACTIONS.CREATEANDUPDATE]:r.RECORD_ACTIONS.CREATEANDUPDATE_WITH_WRITE_ACK,[r.RECORD_ACTIONS.PATCH]:r.RECORD_ACTIONS.PATCH_WITH_WRITE_ACK,[r.RECORD_ACTIONS.UPDATE]:r.RECORD_ACTIONS.UPDATE_WITH_WRITE_ACK,[r.RECORD_ACTIONS.ERASE]:r.RECORD_ACTIONS.ERASE_WITH_WRITE_ACK},t.reverseMapNumeric=i,t.WRITE_ACK_TO_ACTION=i(t.ACTION_TO_WRITE_ACK),t.RESPONSE_TO_REQUEST={[r.TOPIC.RECORD]:{[r.RECORD_ACTIONS.HEAD_RESPONSE]:r.RECORD_ACTIONS.HEAD,[r.RECORD_ACTIONS.READ_RESPONSE]:r.RECORD_ACTIONS.READ,[r.RECORD_ACTIONS.DELETE_SUCCESS]:r.RECORD_ACTIONS.DELETE},[r.TOPIC.PRESENCE]:{[r.PRESENCE_ACTIONS.QUERY_RESPONSE]:r.PRESENCE_ACTIONS.QUERY,[r.PRESENCE_ACTIONS.QUERY_ALL_RESPONSE]:r.PRESENCE_ACTIONS.QUERY_ALL},[r.TOPIC.RPC]:{[r.RPC_ACTIONS.ACCEPT]:r.RPC_ACTIONS.REQUEST,[r.RPC_ACTIONS.ERROR]:r.RPC_ACTIONS.REQUEST},[r.TOPIC.EVENT]:{}}},function(e,t,n){(function(e){function n(e){return Object.prototype.toString.call(e)}t.isArray=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===n(e)},t.isBoolean=function(e){return"boolean"==typeof e},t.isNull=function(e){return null===e},t.isNullOrUndefined=function(e){return null==e},t.isNumber=function(e){return"number"==typeof e},t.isString=function(e){return"string"==typeof e},t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=function(e){return void 0===e},t.isRegExp=function(e){return"[object RegExp]"===n(e)},t.isObject=function(e){return"object"==typeof e&&null!==e},t.isDate=function(e){return"[object Date]"===n(e)},t.isError=function(e){return"[object Error]"===n(e)||e instanceof Error},t.isFunction=function(e){return"function"==typeof e},t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=e.isBuffer}).call(this,n(4).Buffer)},function(e,t,n){"use strict";var r,i="object"==typeof Reflect?Reflect:null,o=i&&"function"==typeof i.apply?i.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};r=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var s=Number.isNaN||function(e){return e!=e};function a(){a.init.call(this)}e.exports=a,a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var c=10;function u(e){return void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners}function h(e,t,n,r){var i,o,s,a;if("function"!=typeof n)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof n);if(void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),s=o[t]),void 0===s)s=o[t]=n,++e._eventsCount;else if("function"==typeof s?s=o[t]=r?[n,s]:[s,n]:r?s.unshift(n):s.push(n),(i=u(e))>0&&s.length>i&&!s.warned){s.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=s.length,a=c,console&&console.warn&&console.warn(a)}return e}function l(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=function(){for(var e=[],t=0;t<arguments.length;t++)e.push(arguments[t]);this.fired||(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,o(this.listener,this.target,e))}.bind(r);return i.listener=n,r.wrapFn=i,i}function E(e,t,n){var r=e._events;if(void 0===r)return[];var i=r[t];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):d(i,i.length)}function f(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function d(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");c=e}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},a.prototype.getMaxListeners=function(){return u(this)},a.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var r="error"===e,i=this._events;if(void 0!==i)r=r&&void 0===i.error;else if(!r)return!1;if(r){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var c=i[e];if(void 0===c)return!1;if("function"==typeof c)o(c,this,t);else{var u=c.length,h=d(c,u);for(n=0;n<u;++n)o(h[n],this,t)}return!0},a.prototype.addListener=function(e,t){return h(this,e,t,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(e,t){return h(this,e,t,!0)},a.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);return this.on(e,l(this,e,t)),this},a.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);return this.prependListener(e,l(this,e,t)),this},a.prototype.removeListener=function(e,t){var n,r,i,o,s;if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);if(void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){s=n[o].listener,i=o;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,s||t)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,o=Object.keys(n);for(r=0;r<o.length;++r)"removeListener"!==(i=o[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},a.prototype.listeners=function(e){return E(this,e,!0)},a.prototype.rawListeners=function(e){return E(this,e,!1)},a.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):f.call(e,t)},a.prototype.listenerCount=f,a.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},function(e,t,n){"use strict";(function(t){!t.version||0===t.version.indexOf("v0.")||0===t.version.indexOf("v1.")&&0!==t.version.indexOf("v1.8.")?e.exports={nextTick:function(e,n,r,i){if("function"!=typeof e)throw new TypeError('"callback" argument must be a function');var o,s,a=arguments.length;switch(a){case 0:case 1:return t.nextTick(e);case 2:return t.nextTick(function(){e.call(null,n)});case 3:return t.nextTick(function(){e.call(null,n,r)});case 4:return t.nextTick(function(){e.call(null,n,r,i)});default:for(o=new Array(a-1),s=0;s<o.length;)o[s++]=arguments[s];return t.nextTick(function(){e.apply(null,o)})}}}:e.exports=t}).call(this,n(!function(){var e=new Error("Cannot find module './../process/browser.js'");throw e.code="MODULE_NOT_FOUND",e}()))},function(e,t,n){var r=n(4),i=r.Buffer;function o(e,t){for(var n in e)t[n]=e[n]}function s(e,t,n){return i(e,t,n)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=r:(o(r,t),t.Buffer=s),o(i,s),s.from=function(e,t,n){if("number"==typeof e)throw new TypeError("Argument must not be a number");return i(e,t,n)},s.alloc=function(e,t,n){if("number"!=typeof e)throw new TypeError("Argument must be a number");var r=i(e);return void 0!==t?"string"==typeof n?r.fill(t,n):r.fill(t):r.fill(0),r},s.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i(e)},s.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r.SlowBuffer(e)}},function(e,t){},function(e,t,n){(t=e.exports=n(27)).Stream=t,t.Readable=t,t.Writable=n(16),t.Duplex=n(7),t.Transform=n(31),t.PassThrough=n(90)},function(e,t,n){"use strict";(function(t,r,i){var o=n(12);function s(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,n){var r=e.entry;e.entry=null;for(;r;){var i=r.callback;t.pendingcb--,i(n),r=r.next}t.corkedRequestsFree?t.corkedRequestsFree.next=e:t.corkedRequestsFree=e}(t,e)}}e.exports=_;var a,c=!t.browser&&["v0.10","v0.9."].indexOf(t.version.slice(0,5))>-1?r:o.nextTick;_.WritableState=T;var u=n(10);u.inherits=n(6);var h={deprecate:n(89)},l=n(28),E=n(13).Buffer,f=i.Uint8Array||function(){};var d,p=n(29);function S(){}function T(e,t){a=a||n(7),e=e||{};var r=t instanceof a;this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var i=e.highWaterMark,u=e.writableHighWaterMark,h=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:r&&(u||0===u)?u:h,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var l=!1===e.decodeStrings;this.decodeStrings=!l,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var n=e._writableState,r=n.sync,i=n.writecb;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(n),t)!function(e,t,n,r,i){--t.pendingcb,n?(o.nextTick(i,r),o.nextTick(A,e,t),e._writableState.errorEmitted=!0,e.emit("error",r)):(i(r),e._writableState.errorEmitted=!0,e.emit("error",r),A(e,t))}(e,n,r,t,i);else{var s=N(n);s||n.corked||n.bufferProcessing||!n.bufferedRequest||O(e,n),r?c(R,e,n,s,i):R(e,n,s,i)}}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new s(this)}function _(e){if(a=a||n(7),!(d.call(_,this)||this instanceof a))return new _(e);this._writableState=new T(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),l.call(this)}function C(e,t,n,r,i,o,s){t.writelen=r,t.writecb=s,t.writing=!0,t.sync=!0,n?e._writev(i,t.onwrite):e._write(i,o,t.onwrite),t.sync=!1}function R(e,t,n,r){n||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,r(),A(e,t)}function O(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var r=t.bufferedRequestCount,i=new Array(r),o=t.corkedRequestsFree;o.entry=n;for(var a=0,c=!0;n;)i[a]=n,n.isBuf||(c=!1),n=n.next,a+=1;i.allBuffers=c,C(e,t,!0,t.length,i,"",o.finish),t.pendingcb++,t.lastBufferedRequest=null,o.next?(t.corkedRequestsFree=o.next,o.next=null):t.corkedRequestsFree=new s(t),t.bufferedRequestCount=0}else{for(;n;){var u=n.chunk,h=n.encoding,l=n.callback;if(C(e,t,!1,t.objectMode?1:u.length,u,h,l),n=n.next,t.bufferedRequestCount--,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequest=n,t.bufferProcessing=!1}function N(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function g(e,t){e._final(function(n){t.pendingcb--,n&&e.emit("error",n),t.prefinished=!0,e.emit("prefinish"),A(e,t)})}function A(e,t){var n=N(t);return n&&(!function(e,t){t.prefinished||t.finalCalled||("function"==typeof e._final?(t.pendingcb++,t.finalCalled=!0,o.nextTick(g,e,t)):(t.prefinished=!0,e.emit("prefinish")))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"))),n}u.inherits(_,l),T.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(T.prototype,"buffer",{get:h.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(d=Function.prototype[Symbol.hasInstance],Object.defineProperty(_,Symbol.hasInstance,{value:function(e){return!!d.call(this,e)||this===_&&(e&&e._writableState instanceof T)}})):d=function(e){return e instanceof this},_.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},_.prototype.write=function(e,t,n){var r,i=this._writableState,s=!1,a=!i.objectMode&&(r=e,E.isBuffer(r)||r instanceof f);return a&&!E.isBuffer(e)&&(e=function(e){return E.from(e)}(e)),"function"==typeof t&&(n=t,t=null),a?t="buffer":t||(t=i.defaultEncoding),"function"!=typeof n&&(n=S),i.ended?function(e,t){var n=new Error("write after end");e.emit("error",n),o.nextTick(t,n)}(this,n):(a||function(e,t,n,r){var i=!0,s=!1;return null===n?s=new TypeError("May not write null values to stream"):"string"==typeof n||void 0===n||t.objectMode||(s=new TypeError("Invalid non-string/buffer chunk")),s&&(e.emit("error",s),o.nextTick(r,s),i=!1),i}(this,i,e,n))&&(i.pendingcb++,s=function(e,t,n,r,i,o){if(!n){var s=function(e,t,n){e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=E.from(t,n));return t}(t,r,i);r!==s&&(n=!0,i="buffer",r=s)}var a=t.objectMode?1:r.length;t.length+=a;var c=t.length<t.highWaterMark;c||(t.needDrain=!0);if(t.writing||t.corked){var u=t.lastBufferedRequest;t.lastBufferedRequest={chunk:r,encoding:i,isBuf:n,callback:o,next:null},u?u.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else C(e,t,!1,a,r,i,o);return c}(this,i,a,e,t,n)),s},_.prototype.cork=function(){this._writableState.corked++},_.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||O(this,e))},_.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(_.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),_.prototype._write=function(e,t,n){n(new Error("_write() is not implemented"))},_.prototype._writev=null,_.prototype.end=function(e,t,n){var r=this._writableState;"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),null!=e&&this.write(e,t),r.corked&&(r.corked=1,this.uncork()),r.ending||r.finished||function(e,t,n){t.ending=!0,A(e,t),n&&(t.finished?o.nextTick(n):e.once("finish",n));t.ended=!0,e.writable=!1}(this,r,n)},Object.defineProperty(_.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),_.prototype.destroy=p.destroy,_.prototype._undestroy=p.undestroy,_.prototype._destroy=function(e,t){this.end(),t(e)}}).call(this,n(!function(){var e=new Error("Cannot find module './../../process/browser.js'");throw e.code="MODULE_NOT_FOUND",e}()),n(!function(){var e=new Error("Cannot find module './../../timers-browserify/main.js'");throw e.code="MODULE_NOT_FOUND",e}()).setImmediate,n(5))},function(e,t,n){(function(e){var r=Object.getOwnPropertyDescriptors||function(e){for(var t=Object.keys(e),n={},r=0;r<t.length;r++)n[t[r]]=Object.getOwnPropertyDescriptor(e,t[r]);return n},i=/%[sdj%]/g;t.format=function(e){if(!T(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(a(arguments[n]));return t.join(" ")}n=1;for(var r=arguments,o=r.length,s=String(e).replace(i,function(e){if("%%"===e)return"%";if(n>=o)return e;switch(e){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(e){return"[Circular]"}default:return e}}),c=r[n];n<o;c=r[++n])p(c)||!R(c)?s+=" "+c:s+=" "+a(c);return s},t.deprecate=function(n,r){if(void 0!==e&&!0===e.noDeprecation)return n;if(void 0===e)return function(){return t.deprecate(n,r).apply(this,arguments)};var i=!1;return function(){if(!i){if(e.throwDeprecation)throw new Error(r);e.traceDeprecation?console.trace(r):console.error(r),i=!0}return n.apply(this,arguments)}};var o,s={};function a(e,n){var r={seen:[],stylize:u};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),d(n)?r.showHidden=n:n&&t._extend(r,n),_(r.showHidden)&&(r.showHidden=!1),_(r.depth)&&(r.depth=2),_(r.colors)&&(r.colors=!1),_(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=c),h(r,e,r.depth)}function c(e,t){var n=a.styles[t];return n?"["+a.colors[n][0]+"m"+e+"["+a.colors[n][1]+"m":e}function u(e,t){return e}function h(e,n,r){if(e.customInspect&&n&&g(n.inspect)&&n.inspect!==t.inspect&&(!n.constructor||n.constructor.prototype!==n)){var i=n.inspect(r,e);return T(i)||(i=h(e,i,r)),i}var o=function(e,t){if(_(t))return e.stylize("undefined","undefined");if(T(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}if(S(t))return e.stylize(""+t,"number");if(d(t))return e.stylize(""+t,"boolean");if(p(t))return e.stylize("null","null")}(e,n);if(o)return o;var s=Object.keys(n),a=function(e){var t={};return e.forEach(function(e,n){t[e]=!0}),t}(s);if(e.showHidden&&(s=Object.getOwnPropertyNames(n)),N(n)&&(s.indexOf("message")>=0||s.indexOf("description")>=0))return l(n);if(0===s.length){if(g(n)){var c=n.name?": "+n.name:"";return e.stylize("[Function"+c+"]","special")}if(C(n))return e.stylize(RegExp.prototype.toString.call(n),"regexp");if(O(n))return e.stylize(Date.prototype.toString.call(n),"date");if(N(n))return l(n)}var u,R="",A=!1,I=["{","}"];(f(n)&&(A=!0,I=["[","]"]),g(n))&&(R=" [Function"+(n.name?": "+n.name:"")+"]");return C(n)&&(R=" "+RegExp.prototype.toString.call(n)),O(n)&&(R=" "+Date.prototype.toUTCString.call(n)),N(n)&&(R=" "+l(n)),0!==s.length||A&&0!=n.length?r<0?C(n)?e.stylize(RegExp.prototype.toString.call(n),"regexp"):e.stylize("[Object]","special"):(e.seen.push(n),u=A?function(e,t,n,r,i){for(var o=[],s=0,a=t.length;s<a;++s)v(t,String(s))?o.push(E(e,t,n,r,String(s),!0)):o.push("");return i.forEach(function(i){i.match(/^\d+$/)||o.push(E(e,t,n,r,i,!0))}),o}(e,n,r,a,s):s.map(function(t){return E(e,n,r,a,t,A)}),e.seen.pop(),function(e,t,n){if(e.reduce(function(e,t){return 0,t.indexOf("\n")>=0&&0,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60)return n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1];return n[0]+t+" "+e.join(", ")+" "+n[1]}(u,R,I)):I[0]+R+I[1]}function l(e){return"["+Error.prototype.toString.call(e)+"]"}function E(e,t,n,r,i,o){var s,a,c;if((c=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?a=c.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):c.set&&(a=e.stylize("[Setter]","special")),v(r,i)||(s="["+i+"]"),a||(e.seen.indexOf(c.value)<0?(a=p(n)?h(e,c.value,null):h(e,c.value,n-1)).indexOf("\n")>-1&&(a=o?a.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+a.split("\n").map(function(e){return"   "+e}).join("\n")):a=e.stylize("[Circular]","special")),_(s)){if(o&&i.match(/^\d+$/))return a;(s=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=e.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=e.stylize(s,"string"))}return s+": "+a}function f(e){return Array.isArray(e)}function d(e){return"boolean"==typeof e}function p(e){return null===e}function S(e){return"number"==typeof e}function T(e){return"string"==typeof e}function _(e){return void 0===e}function C(e){return R(e)&&"[object RegExp]"===A(e)}function R(e){return"object"==typeof e&&null!==e}function O(e){return R(e)&&"[object Date]"===A(e)}function N(e){return R(e)&&("[object Error]"===A(e)||e instanceof Error)}function g(e){return"function"==typeof e}function A(e){return Object.prototype.toString.call(e)}function I(e){return e<10?"0"+e.toString(10):e.toString(10)}t.debuglog=function(n){if(_(o)&&(o=e.env.NODE_DEBUG||""),n=n.toUpperCase(),!s[n])if(new RegExp("\\b"+n+"\\b","i").test(o)){var r=e.pid;s[n]=function(){var e=t.format.apply(t,arguments);console.error("%s %d: %s",n,r,e)}}else s[n]=function(){};return s[n]},t.inspect=a,a.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},a.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},t.isArray=f,t.isBoolean=d,t.isNull=p,t.isNullOrUndefined=function(e){return null==e},t.isNumber=S,t.isString=T,t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=_,t.isRegExp=C,t.isObject=R,t.isDate=O,t.isError=N,t.isFunction=g,t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=n(96);var m=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function v(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.log=function(){var e,n;console.log("%s - %s",(e=new Date,n=[I(e.getHours()),I(e.getMinutes()),I(e.getSeconds())].join(":"),[e.getDate(),m[e.getMonth()],n].join(" ")),t.format.apply(t,arguments))},t.inherits=n(6),t._extend=function(e,t){if(!t||!R(t))return e;for(var n=Object.keys(t),r=n.length;r--;)e[n[r]]=t[n[r]];return e};var y="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function b(e,t){if(!e){var n=new Error("Promise was rejected with a falsy value");n.reason=e,e=n}return t(e)}t.promisify=function(e){if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');if(y&&e[y]){var t;if("function"!=typeof(t=e[y]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(t,y,{value:t,enumerable:!1,writable:!1,configurable:!0}),t}function t(){for(var t,n,r=new Promise(function(e,r){t=e,n=r}),i=[],o=0;o<arguments.length;o++)i.push(arguments[o]);i.push(function(e,r){e?n(e):t(r)});try{e.apply(this,i)}catch(e){n(e)}return r}return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),y&&Object.defineProperty(t,y,{value:t,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(t,r(e))},t.promisify.custom=y,t.callbackify=function(t){if("function"!=typeof t)throw new TypeError('The "original" argument must be of type Function');function n(){for(var n=[],r=0;r<arguments.length;r++)n.push(arguments[r]);var i=n.pop();if("function"!=typeof i)throw new TypeError("The last argument must be of type Function");var o=this,s=function(){return i.apply(o,arguments)};t.apply(this,n).then(function(t){e.nextTick(s,null,t)},function(t){e.nextTick(b,t,s)})}return Object.setPrototypeOf(n,Object.getPrototypeOf(t)),Object.defineProperties(n,r(t)),n}}).call(this,n(!function(){var e=new Error("Cannot find module './../process/browser.js'");throw e.code="MODULE_NOT_FOUND",e}()))},function(e,t,n){var r=n(19),i=n(8),o=n(20).ArraySet,s=n(38).MappingList;function a(e){e||(e={}),this._file=i.getArg(e,"file",null),this._sourceRoot=i.getArg(e,"sourceRoot",null),this._skipValidation=i.getArg(e,"skipValidation",!1),this._sources=new o,this._names=new o,this._mappings=new s,this._sourcesContents=null}a.prototype._version=3,a.fromSourceMap=function(e){var t=e.sourceRoot,n=new a({file:e.file,sourceRoot:t});return e.eachMapping(function(e){var r={generated:{line:e.generatedLine,column:e.generatedColumn}};null!=e.source&&(r.source=e.source,null!=t&&(r.source=i.relative(t,r.source)),r.original={line:e.originalLine,column:e.originalColumn},null!=e.name&&(r.name=e.name)),n.addMapping(r)}),e.sources.forEach(function(r){var o=r;null!==t&&(o=i.relative(t,r)),n._sources.has(o)||n._sources.add(o);var s=e.sourceContentFor(r);null!=s&&n.setSourceContent(r,s)}),n},a.prototype.addMapping=function(e){var t=i.getArg(e,"generated"),n=i.getArg(e,"original",null),r=i.getArg(e,"source",null),o=i.getArg(e,"name",null);this._skipValidation||this._validateMapping(t,n,r,o),null!=r&&(r=String(r),this._sources.has(r)||this._sources.add(r)),null!=o&&(o=String(o),this._names.has(o)||this._names.add(o)),this._mappings.add({generatedLine:t.line,generatedColumn:t.column,originalLine:null!=n&&n.line,originalColumn:null!=n&&n.column,source:r,name:o})},a.prototype.setSourceContent=function(e,t){var n=e;null!=this._sourceRoot&&(n=i.relative(this._sourceRoot,n)),null!=t?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[i.toSetString(n)]=t):this._sourcesContents&&(delete this._sourcesContents[i.toSetString(n)],0===Object.keys(this._sourcesContents).length&&(this._sourcesContents=null))},a.prototype.applySourceMap=function(e,t,n){var r=t;if(null==t){if(null==e.file)throw new Error('SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map\'s "file" property. Both were omitted.');r=e.file}var s=this._sourceRoot;null!=s&&(r=i.relative(s,r));var a=new o,c=new o;this._mappings.unsortedForEach(function(t){if(t.source===r&&null!=t.originalLine){var o=e.originalPositionFor({line:t.originalLine,column:t.originalColumn});null!=o.source&&(t.source=o.source,null!=n&&(t.source=i.join(n,t.source)),null!=s&&(t.source=i.relative(s,t.source)),t.originalLine=o.line,t.originalColumn=o.column,null!=o.name&&(t.name=o.name))}var u=t.source;null==u||a.has(u)||a.add(u);var h=t.name;null==h||c.has(h)||c.add(h)},this),this._sources=a,this._names=c,e.sources.forEach(function(t){var r=e.sourceContentFor(t);null!=r&&(null!=n&&(t=i.join(n,t)),null!=s&&(t=i.relative(s,t)),this.setSourceContent(t,r))},this)},a.prototype._validateMapping=function(e,t,n,r){if(t&&"number"!=typeof t.line&&"number"!=typeof t.column)throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if((!(e&&"line"in e&&"column"in e&&e.line>0&&e.column>=0)||t||n||r)&&!(e&&"line"in e&&"column"in e&&t&&"line"in t&&"column"in t&&e.line>0&&e.column>=0&&t.line>0&&t.column>=0&&n))throw new Error("Invalid mapping: "+JSON.stringify({generated:e,source:n,original:t,name:r}))},a.prototype._serializeMappings=function(){for(var e,t,n,o,s=0,a=1,c=0,u=0,h=0,l=0,E="",f=this._mappings.toArray(),d=0,p=f.length;d<p;d++){if(e="",(t=f[d]).generatedLine!==a)for(s=0;t.generatedLine!==a;)e+=";",a++;else if(d>0){if(!i.compareByGeneratedPositionsInflated(t,f[d-1]))continue;e+=","}e+=r.encode(t.generatedColumn-s),s=t.generatedColumn,null!=t.source&&(o=this._sources.indexOf(t.source),e+=r.encode(o-l),l=o,e+=r.encode(t.originalLine-1-u),u=t.originalLine-1,e+=r.encode(t.originalColumn-c),c=t.originalColumn,null!=t.name&&(n=this._names.indexOf(t.name),e+=r.encode(n-h),h=n)),E+=e}return E},a.prototype._generateSourcesContent=function(e,t){return e.map(function(e){if(!this._sourcesContents)return null;null!=t&&(e=i.relative(t,e));var n=i.toSetString(e);return Object.prototype.hasOwnProperty.call(this._sourcesContents,n)?this._sourcesContents[n]:null},this)},a.prototype.toJSON=function(){var e={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return null!=this._file&&(e.file=this._file),null!=this._sourceRoot&&(e.sourceRoot=this._sourceRoot),this._sourcesContents&&(e.sourcesContent=this._generateSourcesContent(e.sources,e.sourceRoot)),e},a.prototype.toString=function(){return JSON.stringify(this.toJSON())},t.SourceMapGenerator=a},function(e,t,n){var r=n(37);t.encode=function(e){var t,n="",i=function(e){return e<0?1+(-e<<1):0+(e<<1)}(e);do{t=31&i,(i>>>=5)>0&&(t|=32),n+=r.encode(t)}while(i>0);return n},t.decode=function(e,t,n){var i,o,s,a,c=e.length,u=0,h=0;do{if(t>=c)throw new Error("Expected more digits in base 64 VLQ value.");if(-1===(o=r.decode(e.charCodeAt(t++))))throw new Error("Invalid base64 digit: "+e.charAt(t-1));i=!!(32&o),u+=(o&=31)<<h,h+=5}while(i);n.value=(a=(s=u)>>1,1==(1&s)?-a:a),n.rest=t}},function(e,t,n){var r=n(8),i=Object.prototype.hasOwnProperty,o="undefined"!=typeof Map;function s(){this._array=[],this._set=o?new Map:Object.create(null)}s.fromArray=function(e,t){for(var n=new s,r=0,i=e.length;r<i;r++)n.add(e[r],t);return n},s.prototype.size=function(){return o?this._set.size:Object.getOwnPropertyNames(this._set).length},s.prototype.add=function(e,t){var n=o?e:r.toSetString(e),s=o?this.has(e):i.call(this._set,n),a=this._array.length;s&&!t||this._array.push(e),s||(o?this._set.set(e,a):this._set[n]=a)},s.prototype.has=function(e){if(o)return this._set.has(e);var t=r.toSetString(e);return i.call(this._set,t)},s.prototype.indexOf=function(e){if(o){var t=this._set.get(e);if(t>=0)return t}else{var n=r.toSetString(e);if(i.call(this._set,n))return this._set[n]}throw new Error('"'+e+'" is not in the set.')},s.prototype.at=function(e){if(e>=0&&e<this._array.length)return this._array[e];throw new Error("No element indexed by "+e)},s.prototype.toArray=function(){return this._array.slice()},t.ArraySet=s},function(e,t,n){(function(e){function n(e,t){for(var n=0,r=e.length-1;r>=0;r--){var i=e[r];"."===i?e.splice(r,1):".."===i?(e.splice(r,1),n++):n&&(e.splice(r,1),n--)}if(t)for(;n--;n)e.unshift("..");return e}var r=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,i=function(e){return r.exec(e).slice(1)};function o(e,t){if(e.filter)return e.filter(t);for(var n=[],r=0;r<e.length;r++)t(e[r],r,e)&&n.push(e[r]);return n}t.resolve=function(){for(var t="",r=!1,i=arguments.length-1;i>=-1&&!r;i--){var s=i>=0?arguments[i]:e.cwd();if("string"!=typeof s)throw new TypeError("Arguments to path.resolve must be strings");s&&(t=s+"/"+t,r="/"===s.charAt(0))}return(r?"/":"")+(t=n(o(t.split("/"),function(e){return!!e}),!r).join("/"))||"."},t.normalize=function(e){var r=t.isAbsolute(e),i="/"===s(e,-1);return(e=n(o(e.split("/"),function(e){return!!e}),!r).join("/"))||r||(e="."),e&&i&&(e+="/"),(r?"/":"")+e},t.isAbsolute=function(e){return"/"===e.charAt(0)},t.join=function(){var e=Array.prototype.slice.call(arguments,0);return t.normalize(o(e,function(e,t){if("string"!=typeof e)throw new TypeError("Arguments to path.join must be strings");return e}).join("/"))},t.relative=function(e,n){function r(e){for(var t=0;t<e.length&&""===e[t];t++);for(var n=e.length-1;n>=0&&""===e[n];n--);return t>n?[]:e.slice(t,n-t+1)}e=t.resolve(e).substr(1),n=t.resolve(n).substr(1);for(var i=r(e.split("/")),o=r(n.split("/")),s=Math.min(i.length,o.length),a=s,c=0;c<s;c++)if(i[c]!==o[c]){a=c;break}var u=[];for(c=a;c<i.length;c++)u.push("..");return(u=u.concat(o.slice(a))).join("/")},t.sep="/",t.delimiter=":",t.dirname=function(e){var t=i(e),n=t[0],r=t[1];return n||r?(r&&(r=r.substr(0,r.length-1)),n+r):"."},t.basename=function(e,t){var n=i(e)[2];return t&&n.substr(-1*t.length)===t&&(n=n.substr(0,n.length-t.length)),n},t.extname=function(e){return i(e)[3]};var s="b"==="ab".substr(-1)?function(e,t,n){return e.substr(t,n)}:function(e,t,n){return t<0&&(t=e.length+t),e.substr(t,n)}}).call(this,n(!function(){var e=new Error("Cannot find module './../process/browser.js'");throw e.code="MODULE_NOT_FOUND",e}()))},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});const r=n(0),i=n(23),o=n(9),s=n(24);function a(e){return e.action>=80&&e.action<112||e.topic===r.TOPIC.PARSER}function c(e,t){if(e.length<t+i.HEADER_LENGTH)return{bytesConsumed:0};const n=!!(128&e[t]),r=127&e[t],o=e[t+1],s=e.readUIntBE(t+2,3),a=e.readUIntBE(t+5,3),c=i.HEADER_LENGTH+s+a;if(e.length<t+c)return{bytesConsumed:0};const u={fin:n,topic:r,action:o,rawHeader:e.slice(t,t+i.HEADER_LENGTH)};return s>0&&(u.meta=e.slice(t+i.HEADER_LENGTH,t+i.HEADER_LENGTH+s)),a>0&&(u.payload=e.slice(t+i.HEADER_LENGTH+s,t+c)),{bytesConsumed:c,rawMessage:u}}function u(t){if(0===t.length)throw new Error("parseMessage must not be called with an empty message queue");if(1===t.length)return t[0];const{topic:n,action:r,rawHeader:i}=t[0],o=[],s=[];t.forEach(({payload:e,meta:t})=>{e&&o.push(e),t&&s.push(t)});const a=e.concat(o);return{fin:!0,topic:n,action:r,rawHeader:i,meta:e.concat(s),payload:a}}function h(e){const{topic:t,action:n,rawHeader:i}=e;if(void 0===r.TOPIC[t])return{parseError:!0,action:r.PARSER_ACTIONS.UNKNOWN_TOPIC,parsedMessage:{topic:t,action:n},description:`unknown topic ${t}`,raw:i};const c=t;if(void 0===r.ACTIONS[c][n])return{parseError:!0,action:r.PARSER_ACTIONS.UNKNOWN_ACTION,parsedMessage:{topic:c,action:n},description:`unknown ${r.TOPIC[c]} action ${n}`,raw:i};const u={topic:c,action:127&n};if(e.meta&&e.meta.length>0){const t=l(e.meta);if(!t||"object"!=typeof t)return{parseError:!0,action:r.PARSER_ACTIONS.MESSAGE_PARSE_ERROR,parsedMessage:u,description:`invalid meta field ${e.meta.toString()}`,raw:i};const o=s.validateMeta(c,n,t);if(o)throw new Error(`invalid meta ${r.TOPIC[u.topic]} ${r.ACTIONS[u.topic][u.action]}: ${o}`);!function(e,t){for(const n in r.META_KEYS){const i=e[r.META_KEYS[n]];void 0!==i&&(t[n]=i)}}(t,u)}if(void 0!==e.payload){if(!s.hasPayload(u.topic,n))return{parseError:!0,action:r.PARSER_ACTIONS.INVALID_MESSAGE,parsedMessage:u,description:"should not have a payload"};u.payloadEncoding||c!==r.TOPIC.PARSER||(u.payloadEncoding=r.PAYLOAD_ENCODING.BINARY),u.data=e.payload}return u.isAck=n>=128,u.isError=a(u),u.topic===r.TOPIC.RECORD&&o.isWriteAck(n)&&(u.isWriteAck=!0),u}function l(e){try{return JSON.parse(e.toString())}catch(e){return}}t.isError=a,t.parse=function(e,t=[]){let n=0;const r=[];do{const{bytesConsumed:i,rawMessage:o}=c(e,n);if(!o)break;if(t.push(o),n+=i,o.fin){const e=h(u(t));t.length=0,r.push(e)}}while(n<e.length);return r},t.parseData=function(e){return void 0!==e.parsedData||void 0===e.data||(e.payloadEncoding&&e.payloadEncoding!==r.PAYLOAD_ENCODING.JSON?new Error(`unable to parse data of type '${e.payloadEncoding}'`):"string"==typeof e.data?new Error("tried to parse string data with binary parser"):(e.parsedData=l(e.data),void 0!==e.parsedData||new Error(`unable to parse data ${e.data}`)))},t.parseJSON=l}).call(this,n(4).Buffer)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HEADER_LENGTH=8,t.META_PAYLOAD_OVERFLOW_LENGTH=Math.pow(2,24)-1},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0);t.META_PARAMS_SPEC={[r.TOPIC.PARSER]:{[r.PARSER_ACTIONS.UNKNOWN_TOPIC]:[[r.META_KEYS.originalTopic],[]],[r.PARSER_ACTIONS.UNKNOWN_ACTION]:[[r.META_KEYS.originalTopic,r.META_KEYS.originalAction],[]],[r.PARSER_ACTIONS.INVALID_MESSAGE]:[[],[]],[r.PARSER_ACTIONS.INVALID_META_PARAMS]:[[r.META_KEYS.originalTopic,r.META_KEYS.originalAction],[]]},[r.TOPIC.CONNECTION]:{[r.CONNECTION_ACTIONS.PING]:[[],[]],[r.CONNECTION_ACTIONS.PONG]:[[],[]],[r.CONNECTION_ACTIONS.CHALLENGE]:[[r.META_KEYS.url,r.META_KEYS.protocolVersion],[]],[r.CONNECTION_ACTIONS.ACCEPT]:[[],[]],[r.CONNECTION_ACTIONS.REJECT]:[[],[]],[r.CONNECTION_ACTIONS.REDIRECT]:[[r.META_KEYS.url],[]],[r.CONNECTION_ACTIONS.CLOSING]:[[],[]],[r.CONNECTION_ACTIONS.CLOSED]:[[],[]],[r.CONNECTION_ACTIONS.ERROR]:[[],[]],[r.CONNECTION_ACTIONS.AUTHENTICATION_TIMEOUT]:[[],[]],[r.CONNECTION_ACTIONS.INVALID_MESSAGE]:[[r.META_KEYS.originalTopic,r.META_KEYS.originalAction],[]]},[r.TOPIC.AUTH]:{[r.AUTH_ACTIONS.REQUEST]:[[],[]],[r.AUTH_ACTIONS.AUTH_SUCCESSFUL]:[[],[]],[r.AUTH_ACTIONS.AUTH_UNSUCCESSFUL]:[[],[]],[r.AUTH_ACTIONS.TOO_MANY_AUTH_ATTEMPTS]:[[],[]],[r.AUTH_ACTIONS.INVALID_MESSAGE]:[[r.META_KEYS.originalTopic,r.META_KEYS.originalAction],[]],[r.AUTH_ACTIONS.INVALID_MESSAGE_DATA]:[[r.META_KEYS.originalAction],[]]},[r.TOPIC.RECORD]:{[r.RECORD_ACTIONS.SUBSCRIBE]:[[r.META_KEYS.name],[]],[r.RECORD_ACTIONS.SUBSCRIBE_ACK]:[[r.META_KEYS.name],[]],[r.RECORD_ACTIONS.UNSUBSCRIBE]:[[r.META_KEYS.name],[]],[r.RECORD_ACTIONS.UNSUBSCRIBE_ACK]:[[r.META_KEYS.name],[]],[r.RECORD_ACTIONS.MULTIPLE_SUBSCRIPTIONS]:[[r.META_KEYS.name],[r.META_KEYS.originalAction]],[r.RECORD_ACTIONS.NOT_SUBSCRIBED]:[[r.META_KEYS.name],[]],[r.RECORD_ACTIONS.HEAD]:[[r.META_KEYS.name],[]],[r.RECORD_ACTIONS.SUBSCRIBEANDHEAD]:[[r.META_KEYS.name],[]],[r.RECORD_ACTIONS.HEAD_RESPONSE]:[[r.META_KEYS.name,r.META_KEYS.version],[]],[r.RECORD_ACTIONS.READ]:[[r.META_KEYS.name],[]],[r.RECORD_ACTIONS.SUBSCRIBEANDREAD]:[[r.META_KEYS.name],[]],[r.RECORD_ACTIONS.READ_RESPONSE]:[[r.META_KEYS.name,r.META_KEYS.version],[]],[r.RECORD_ACTIONS.UPDATE]:[[r.META_KEYS.name,r.META_KEYS.version],[]],[r.RECORD_ACTIONS.UPDATE_WITH_WRITE_ACK]:[[r.META_KEYS.name,r.META_KEYS.version,r.META_KEYS.correlationId],[]],[r.RECORD_ACTIONS.PATCH]:[[r.META_KEYS.name,r.META_KEYS.version,r.META_KEYS.path],[]],[r.RECORD_ACTIONS.PATCH_WITH_WRITE_ACK]:[[r.META_KEYS.name,r.META_KEYS.version,r.META_KEYS.path,r.META_KEYS.correlationId],[]],[r.RECORD_ACTIONS.ERASE]:[[r.META_KEYS.name,r.META_KEYS.version,r.META_KEYS.path],[]],[r.RECORD_ACTIONS.ERASE_WITH_WRITE_ACK]:[[r.META_KEYS.name,r.META_KEYS.version,r.META_KEYS.path,r.META_KEYS.correlationId],[]],[r.RECORD_ACTIONS.CREATEANDUPDATE]:[[r.META_KEYS.name,r.META_KEYS.version],[]],[r.RECORD_ACTIONS.SUBSCRIBECREATEANDUPDATE]:[[r.META_KEYS.name,r.META_KEYS.version],[]],[r.RECORD_ACTIONS.CREATEANDUPDATE_WITH_WRITE_ACK]:[[r.META_KEYS.name,r.META_KEYS.version,r.META_KEYS.correlationId],[]],[r.RECORD_ACTIONS.CREATEANDPATCH]:[[r.META_KEYS.name,r.META_KEYS.version,r.META_KEYS.path],[]],[r.RECORD_ACTIONS.CREATEANDPATCH_WITH_WRITE_ACK]:[[r.META_KEYS.name,r.META_KEYS.version,r.META_KEYS.path,r.META_KEYS.correlationId],[]],[r.RECORD_ACTIONS.DELETE]:[[r.META_KEYS.name],[]],[r.RECORD_ACTIONS.DELETE_SUCCESS]:[[r.META_KEYS.name],[]],[r.RECORD_ACTIONS.DELETED]:[[r.META_KEYS.name],[]],[r.RECORD_ACTIONS.SUBSCRIBECREATEANDREAD]:[[r.META_KEYS.name],[]],[r.RECORD_ACTIONS.SUBSCRIPTION_HAS_PROVIDER]:[[r.META_KEYS.name],[]],[r.RECORD_ACTIONS.SUBSCRIPTION_HAS_NO_PROVIDER]:[[r.META_KEYS.name],[]],[r.RECORD_ACTIONS.WRITE_ACKNOWLEDGEMENT]:[[r.META_KEYS.name,r.META_KEYS.correlationId],[]],[r.RECORD_ACTIONS.VERSION_EXISTS]:[[r.META_KEYS.name,r.META_KEYS.version],[r.META_KEYS.originalAction]],[r.RECORD_ACTIONS.CACHE_RETRIEVAL_TIMEOUT]:[[r.META_KEYS.name],[]],[r.RECORD_ACTIONS.STORAGE_RETRIEVAL_TIMEOUT]:[[r.META_KEYS.name],[]],[r.RECORD_ACTIONS.RECORD_LOAD_ERROR]:[[r.META_KEYS.name],[]],[r.RECORD_ACTIONS.RECORD_CREATE_ERROR]:[[r.META_KEYS.name],[r.META_KEYS.correlationId,r.META_KEYS.originalAction]],[r.RECORD_ACTIONS.RECORD_UPDATE_ERROR]:[[r.META_KEYS.name],[r.META_KEYS.correlationId,r.META_KEYS.originalAction]],[r.RECORD_ACTIONS.RECORD_DELETE_ERROR]:[[r.META_KEYS.name],[]],[r.RECORD_ACTIONS.RECORD_NOT_FOUND]:[[r.META_KEYS.name,r.META_KEYS.originalAction],[]],[r.RECORD_ACTIONS.INVALID_VERSION]:[[r.META_KEYS.name,r.META_KEYS.originalAction],[r.META_KEYS.correlationId]],[r.RECORD_ACTIONS.INVALID_PATCH_ON_HOTPATH]:[[r.META_KEYS.name,r.META_KEYS.originalAction],[r.META_KEYS.correlationId]],[r.RECORD_ACTIONS.LISTEN]:[[r.META_KEYS.name],[]],[r.RECORD_ACTIONS.LISTEN_ACK]:[[r.META_KEYS.name],[]],[r.RECORD_ACTIONS.UNLISTEN]:[[r.META_KEYS.name],[]],[r.RECORD_ACTIONS.UNLISTEN_ACK]:[[r.META_KEYS.name],[]],[r.RECORD_ACTIONS.SUBSCRIPTION_FOR_PATTERN_FOUND]:[[r.META_KEYS.name,r.META_KEYS.subscription],[]],[r.RECORD_ACTIONS.SUBSCRIPTION_FOR_PATTERN_REMOVED]:[[r.META_KEYS.name,r.META_KEYS.subscription],[]],[r.RECORD_ACTIONS.LISTEN_ACCEPT]:[[r.META_KEYS.name,r.META_KEYS.subscription],[]],[r.RECORD_ACTIONS.LISTEN_REJECT]:[[r.META_KEYS.name,r.META_KEYS.subscription],[]],[r.RECORD_ACTIONS.INVALID_LISTEN_REGEX]:[[r.META_KEYS.name],[]],[r.RECORD_ACTIONS.MESSAGE_PERMISSION_ERROR]:[[r.META_KEYS.originalAction,r.META_KEYS.name],[r.META_KEYS.correlationId]],[r.RECORD_ACTIONS.MESSAGE_DENIED]:[[r.META_KEYS.originalAction,r.META_KEYS.name],[r.META_KEYS.correlationId]],[r.RECORD_ACTIONS.INVALID_MESSAGE_DATA]:[[r.META_KEYS.originalAction,r.META_KEYS.name],[r.META_KEYS.correlationId]]},[r.TOPIC.RPC]:{[r.RPC_ACTIONS.REQUEST_ERROR]:[[r.META_KEYS.name,r.META_KEYS.correlationId],[r.META_KEYS.reason]],[r.RPC_ACTIONS.REQUEST]:[[r.META_KEYS.name,r.META_KEYS.correlationId],[r.META_KEYS.requestorName,r.META_KEYS.requestorData,r.META_KEYS.trustedSender]],[r.RPC_ACTIONS.ACCEPT]:[[r.META_KEYS.name,r.META_KEYS.correlationId],[]],[r.RPC_ACTIONS.REJECT]:[[r.META_KEYS.name,r.META_KEYS.correlationId],[]],[r.RPC_ACTIONS.RESPONSE]:[[r.META_KEYS.name,r.META_KEYS.correlationId],[]],[r.RPC_ACTIONS.PROVIDE]:[[r.META_KEYS.name],[]],[r.RPC_ACTIONS.PROVIDE_ACK]:[[r.META_KEYS.name],[]],[r.RPC_ACTIONS.UNPROVIDE]:[[r.META_KEYS.name],[]],[r.RPC_ACTIONS.UNPROVIDE_ACK]:[[r.META_KEYS.name],[]],[r.RPC_ACTIONS.MULTIPLE_PROVIDERS]:[[r.META_KEYS.correlationId],[]],[r.RPC_ACTIONS.NOT_PROVIDED]:[[r.META_KEYS.correlationId],[]],[r.RPC_ACTIONS.MULTIPLE_RESPONSE]:[[r.META_KEYS.name,r.META_KEYS.correlationId],[]],[r.RPC_ACTIONS.RESPONSE_TIMEOUT]:[[r.META_KEYS.name,r.META_KEYS.correlationId],[]],[r.RPC_ACTIONS.INVALID_RPC_CORRELATION_ID]:[[r.META_KEYS.name,r.META_KEYS.correlationId,r.META_KEYS.originalAction],[]],[r.RPC_ACTIONS.MULTIPLE_ACCEPT]:[[r.META_KEYS.name,r.META_KEYS.correlationId],[]],[r.RPC_ACTIONS.ACCEPT_TIMEOUT]:[[r.META_KEYS.name,r.META_KEYS.correlationId],[]],[r.RPC_ACTIONS.NO_RPC_PROVIDER]:[[r.META_KEYS.name,r.META_KEYS.correlationId],[]],[r.RPC_ACTIONS.MESSAGE_PERMISSION_ERROR]:[[r.META_KEYS.originalAction],[r.META_KEYS.name,r.META_KEYS.correlationId]],[r.RPC_ACTIONS.MESSAGE_DENIED]:[[r.META_KEYS.originalAction],[r.META_KEYS.name,r.META_KEYS.correlationId]],[r.RPC_ACTIONS.INVALID_MESSAGE_DATA]:[[r.META_KEYS.originalAction],[r.META_KEYS.name,r.META_KEYS.correlationId]]},[r.TOPIC.EVENT]:{[r.EVENT_ACTIONS.EMIT]:[[r.META_KEYS.name],[]],[r.EVENT_ACTIONS.SUBSCRIBE]:[[r.META_KEYS.name],[]],[r.EVENT_ACTIONS.SUBSCRIBE_ACK]:[[r.META_KEYS.name],[]],[r.EVENT_ACTIONS.UNSUBSCRIBE]:[[r.META_KEYS.name],[]],[r.EVENT_ACTIONS.UNSUBSCRIBE_ACK]:[[r.META_KEYS.name],[]],[r.EVENT_ACTIONS.MULTIPLE_SUBSCRIPTIONS]:[[r.META_KEYS.name],[]],[r.EVENT_ACTIONS.NOT_SUBSCRIBED]:[[r.META_KEYS.name],[]],[r.EVENT_ACTIONS.MESSAGE_PERMISSION_ERROR]:[[r.META_KEYS.originalAction,r.META_KEYS.name],[]],[r.EVENT_ACTIONS.MESSAGE_DENIED]:[[r.META_KEYS.originalAction,r.META_KEYS.name],[]],[r.EVENT_ACTIONS.LISTEN]:[[r.META_KEYS.name],[]],[r.EVENT_ACTIONS.LISTEN_ACK]:[[r.META_KEYS.name],[]],[r.EVENT_ACTIONS.UNLISTEN]:[[r.META_KEYS.name],[]],[r.EVENT_ACTIONS.UNLISTEN_ACK]:[[r.META_KEYS.name],[]],[r.EVENT_ACTIONS.SUBSCRIPTION_FOR_PATTERN_FOUND]:[[r.META_KEYS.name,r.META_KEYS.subscription],[]],[r.EVENT_ACTIONS.SUBSCRIPTION_FOR_PATTERN_REMOVED]:[[r.META_KEYS.name,r.META_KEYS.subscription],[]],[r.EVENT_ACTIONS.LISTEN_ACCEPT]:[[r.META_KEYS.name,r.META_KEYS.subscription],[]],[r.EVENT_ACTIONS.LISTEN_REJECT]:[[r.META_KEYS.name,r.META_KEYS.subscription],[]],[r.EVENT_ACTIONS.INVALID_LISTEN_REGEX]:[[r.META_KEYS.name],[]],[r.EVENT_ACTIONS.MESSAGE_PERMISSION_ERROR]:[[r.META_KEYS.originalAction,r.META_KEYS.name],[]],[r.EVENT_ACTIONS.MESSAGE_DENIED]:[[r.META_KEYS.originalAction,r.META_KEYS.name],[]],[r.EVENT_ACTIONS.INVALID_MESSAGE_DATA]:[[r.META_KEYS.name,r.META_KEYS.originalAction],[]]},[r.TOPIC.PRESENCE]:{[r.PRESENCE_ACTIONS.SUBSCRIBE]:[[r.META_KEYS.correlationId,r.META_KEYS.names],[]],[r.PRESENCE_ACTIONS.SUBSCRIBE_ACK]:[[r.META_KEYS.correlationId],[]],[r.PRESENCE_ACTIONS.SUBSCRIBE_ALL]:[[],[]],[r.PRESENCE_ACTIONS.SUBSCRIBE_ALL_ACK]:[[],[]],[r.PRESENCE_ACTIONS.UNSUBSCRIBE]:[[r.META_KEYS.correlationId,r.META_KEYS.names],[]],[r.PRESENCE_ACTIONS.UNSUBSCRIBE_ACK]:[[r.META_KEYS.correlationId],[]],[r.PRESENCE_ACTIONS.UNSUBSCRIBE_ALL]:[[r.META_KEYS.correlationId],[]],[r.PRESENCE_ACTIONS.UNSUBSCRIBE_ALL_ACK]:[[r.META_KEYS.correlationId],[]],[r.PRESENCE_ACTIONS.NOT_SUBSCRIBED]:[[],[r.META_KEYS.correlationId]],[r.PRESENCE_ACTIONS.MULTIPLE_SUBSCRIPTIONS]:[[],[r.META_KEYS.correlationId,r.META_KEYS.name,r.META_KEYS.originalAction]],[r.PRESENCE_ACTIONS.QUERY]:[[r.META_KEYS.correlationId,r.META_KEYS.names],[]],[r.PRESENCE_ACTIONS.QUERY_RESPONSE]:[[r.META_KEYS.correlationId],[]],[r.PRESENCE_ACTIONS.QUERY_ALL]:[[],[]],[r.PRESENCE_ACTIONS.QUERY_ALL_RESPONSE]:[[r.META_KEYS.names],[]],[r.PRESENCE_ACTIONS.PRESENCE_JOIN]:[[r.META_KEYS.name],[]],[r.PRESENCE_ACTIONS.PRESENCE_LEAVE]:[[r.META_KEYS.name],[]],[r.PRESENCE_ACTIONS.PRESENCE_JOIN_ALL]:[[r.META_KEYS.name],[]],[r.PRESENCE_ACTIONS.PRESENCE_LEAVE_ALL]:[[r.META_KEYS.name],[]],[r.PRESENCE_ACTIONS.INVALID_PRESENCE_USERS]:[[],[]],[r.PRESENCE_ACTIONS.MESSAGE_PERMISSION_ERROR]:[[r.META_KEYS.originalAction,r.META_KEYS.name],[r.META_KEYS.correlationId]],[r.PRESENCE_ACTIONS.MESSAGE_DENIED]:[[r.META_KEYS.originalAction],[r.META_KEYS.correlationId,r.META_KEYS.name]]},[r.TOPIC.CLUSTER]:{[r.CLUSTER_ACTIONS.CLOSE]:[[],[]],[r.CLUSTER_ACTIONS.IDENTIFICATION_REQUEST]:[[],[]],[r.CLUSTER_ACTIONS.IDENTIFICATION_RESPONSE]:[[],[]],[r.CLUSTER_ACTIONS.KNOWN_PEERS]:[[],[]],[r.CLUSTER_ACTIONS.PING]:[[],[]],[r.CLUSTER_ACTIONS.PONG]:[[],[]],[r.CLUSTER_ACTIONS.REJECT]:[[],[]],[r.CLUSTER_ACTIONS.REJECT_DUPLICATE]:[[],[]]},[r.TOPIC.STATE_REGISTRY]:{[r.STATE_ACTIONS.ERROR]:[[r.META_KEYS.registryTopic],[]],[r.STATE_ACTIONS.ADD]:[[r.META_KEYS.registryTopic],[]],[r.STATE_ACTIONS.REMOVE]:[[r.META_KEYS.registryTopic],[]],[r.STATE_ACTIONS.REQUEST_FULL_STATE]:[[r.META_KEYS.registryTopic],[]],[r.STATE_ACTIONS.FULL_STATE]:[[r.META_KEYS.registryTopic],[]]},[r.TOPIC.LOCK]:{}};const i={[r.TOPIC.PARSER]:[r.PARSER_ACTIONS.MESSAGE_PARSE_ERROR,r.PARSER_ACTIONS.INVALID_META_PARAMS],[r.TOPIC.AUTH]:[r.AUTH_ACTIONS.REQUEST,r.AUTH_ACTIONS.AUTH_SUCCESSFUL,r.AUTH_ACTIONS.AUTH_UNSUCCESSFUL],[r.TOPIC.RECORD]:[r.RECORD_ACTIONS.READ_RESPONSE,r.RECORD_ACTIONS.UPDATE,r.RECORD_ACTIONS.UPDATE_WITH_WRITE_ACK,r.RECORD_ACTIONS.PATCH,r.RECORD_ACTIONS.PATCH_WITH_WRITE_ACK,r.RECORD_ACTIONS.CREATEANDUPDATE,r.RECORD_ACTIONS.CREATEANDUPDATE_WITH_WRITE_ACK,r.RECORD_ACTIONS.CREATEANDPATCH,r.RECORD_ACTIONS.CREATEANDPATCH_WITH_WRITE_ACK,r.RECORD_ACTIONS.VERSION_EXISTS],[r.TOPIC.RPC]:[r.RPC_ACTIONS.REQUEST,r.RPC_ACTIONS.RESPONSE,r.RPC_ACTIONS.REQUEST_ERROR],[r.TOPIC.EVENT]:[r.EVENT_ACTIONS.EMIT],[r.TOPIC.PRESENCE]:[r.PRESENCE_ACTIONS.QUERY_RESPONSE],[r.TOPIC.CLUSTER]:[r.CLUSTER_ACTIONS.IDENTIFICATION_REQUEST,r.CLUSTER_ACTIONS.IDENTIFICATION_RESPONSE,r.CLUSTER_ACTIONS.KNOWN_PEERS],[r.TOPIC.STATE_REGISTRY]:[r.STATE_ACTIONS.FULL_STATE],[r.TOPIC.LOCK]:[]};t.hasPayload=((e,t)=>(function(e,t,n){const r=e[t];return!!r&&-1!==r.indexOf(n)})(i,e,t)),t.validateUnkownMeta=function(e,n,r){const i=t.META_PARAMS_SPEC[e][n];if(!i)return"no meta spec";const[o,s]=i;for(const e in r)if(void 0!==r[e]&&-1===o.indexOf(e)&&-1===s.indexOf(e))return`meta object has unknown key ${e}`},t.validateMeta=function(e,n,r){const i=t.META_PARAMS_SPEC[e][n];if(!i)return"no meta spec";const[o]=i;for(const e of o)if(void 0===r[e])return`meta object does not have required key ${e}`},t.hasCorrelationId=function(e,n){const i=t.META_PARAMS_SPEC[e][n];if(!i)return;const[o,s]=i;return-1!==o.indexOf(r.META_KEYS.correlationId)||-1!==s.indexOf(r.META_KEYS.correlationId)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.StateMachine=class{constructor(e,t){this.inEndState=!1,this.transitions=t.transitions,this.state=t.init,this.stateMachine=t}transition(e){let t;for(let n=0;n<this.transitions.length;n++)if(e===(t=this.transitions[n]).name&&(this.state===t.from||void 0===t.from)){const e=this.state;return this.state=t.to,this.stateMachine.onStateChanged&&this.stateMachine.onStateChanged(this.state,e),void(t.handler&&t.handler())}const n=JSON.stringify({transition:e,state:this.state});throw new Error(`Invalid state transition: ${n}`)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0),i=n(1);t.Listener=class{constructor(e,t){this.topic=e,this.services=t,this.listeners=new Map,this.stopCallbacks=new Map,e===r.TOPIC.RECORD?this.actions=r.RECORD_ACTIONS:e===r.TOPIC.EVENT&&(this.actions=r.EVENT_ACTIONS),this.services.connection.onLost(this.onConnectionLost.bind(this)),this.services.connection.onReestablished(this.onConnectionReestablished.bind(this))}listen(e,t){if("string"!=typeof e||0===e.length)throw new Error("invalid argument pattern");if("function"!=typeof t)throw new Error("invalid argument callback");this.listeners.has(e)?this.services.logger.warn({topic:this.topic,action:i.EVENT.LISTENER_EXISTS,name:e}):(this.listeners.set(e,t),this.sendListen(e))}unlisten(e){if("string"!=typeof e||0===e.length)throw new Error("invalid argument pattern");this.listeners.has(e)?(this.listeners.delete(e),this.sendUnlisten(e)):this.services.logger.warn({topic:this.topic,action:i.EVENT.NOT_LISTENING,name:e})}accept(e,t){this.services.connection.sendMessage({topic:this.topic,action:this.actions.LISTEN_ACCEPT,name:e,subscription:t})}reject(e,t){this.services.connection.sendMessage({topic:this.topic,action:this.actions.LISTEN_REJECT,name:e,subscription:t})}stop(e,t){this.stopCallbacks.set(e,t)}handle(e){if(e.isAck)this.services.timeoutRegistry.remove(e);else if(e.action!==this.actions.SUBSCRIPTION_FOR_PATTERN_FOUND)if(e.action!==this.actions.SUBSCRIPTION_FOR_PATTERN_REMOVED)this.services.logger.error(e,i.EVENT.UNSOLICITED_MESSAGE);else{const t=this.stopCallbacks.get(e.subscription);t&&(t(e.subscription),this.stopCallbacks.delete(e.subscription))}else{const t=this.listeners.get(e.name);t&&t(e.subscription,{accept:this.accept.bind(this,e.name,e.subscription),reject:this.reject.bind(this,e.name,e.subscription),onStop:this.stop.bind(this,e.subscription)})}}onConnectionLost(){this.stopCallbacks.forEach((e,t)=>{e(t)}),this.stopCallbacks.clear()}onConnectionReestablished(){this.listeners.forEach((e,t)=>{this.sendListen(t)})}sendListen(e){const t={topic:this.topic,action:this.actions.LISTEN,name:e};this.services.timeoutRegistry.add({message:t}),this.services.connection.sendMessage(t)}sendUnlisten(e){const t={topic:this.topic,action:this.actions.UNLISTEN,name:e};this.services.timeoutRegistry.add({message:t}),this.services.connection.sendMessage(t)}}},function(e,t,n){"use strict";(function(t,r){var i=n(12);e.exports=C;var o,s=n(85);C.ReadableState=_;n(11).EventEmitter;var a=function(e,t){return e.listeners(t).length},c=n(28),u=n(13).Buffer,h=t.Uint8Array||function(){};var l=n(10);l.inherits=n(6);var E=n(86),f=void 0;f=E&&E.debuglog?E.debuglog("stream"):function(){};var d,p=n(87),S=n(29);l.inherits(C,c);var T=["error","close","destroy","pause","resume"];function _(e,t){e=e||{};var r=t instanceof(o=o||n(7));this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var i=e.highWaterMark,s=e.readableHighWaterMark,a=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:r&&(s||0===s)?s:a,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new p,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(d||(d=n(30).StringDecoder),this.decoder=new d(e.encoding),this.encoding=e.encoding)}function C(e){if(o=o||n(7),!(this instanceof C))return new C(e);this._readableState=new _(e,this),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),c.call(this)}function R(e,t,n,r,i){var o,s=e._readableState;null===t?(s.reading=!1,function(e,t){if(t.ended)return;if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,A(e)}(e,s)):(i||(o=function(e,t){var n;r=t,u.isBuffer(r)||r instanceof h||"string"==typeof t||void 0===t||e.objectMode||(n=new TypeError("Invalid non-string/buffer chunk"));var r;return n}(s,t)),o?e.emit("error",o):s.objectMode||t&&t.length>0?("string"==typeof t||s.objectMode||Object.getPrototypeOf(t)===u.prototype||(t=function(e){return u.from(e)}(t)),r?s.endEmitted?e.emit("error",new Error("stream.unshift() after end event")):O(e,s,t,!0):s.ended?e.emit("error",new Error("stream.push() after EOF")):(s.reading=!1,s.decoder&&!n?(t=s.decoder.write(t),s.objectMode||0!==t.length?O(e,s,t,!1):m(e,s)):O(e,s,t,!1))):r||(s.reading=!1));return function(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}(s)}function O(e,t,n,r){t.flowing&&0===t.length&&!t.sync?(e.emit("data",n),e.read(0)):(t.length+=t.objectMode?1:n.length,r?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&A(e)),m(e,t)}Object.defineProperty(C.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),C.prototype.destroy=S.destroy,C.prototype._undestroy=S.undestroy,C.prototype._destroy=function(e,t){this.push(null),t(e)},C.prototype.push=function(e,t){var n,r=this._readableState;return r.objectMode?n=!0:"string"==typeof e&&((t=t||r.defaultEncoding)!==r.encoding&&(e=u.from(e,t),t=""),n=!0),R(this,e,t,!1,n)},C.prototype.unshift=function(e){return R(this,e,null,!0,!1)},C.prototype.isPaused=function(){return!1===this._readableState.flowing},C.prototype.setEncoding=function(e){return d||(d=n(30).StringDecoder),this._readableState.decoder=new d(e),this._readableState.encoding=e,this};var N=8388608;function g(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=N?e=N:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function A(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(f("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?i.nextTick(I,e):I(e))}function I(e){f("emit readable"),e.emit("readable"),D(e)}function m(e,t){t.readingMore||(t.readingMore=!0,i.nextTick(v,e,t))}function v(e,t){for(var n=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(f("maybeReadMore read 0"),e.read(0),n!==t.length);)n=t.length;t.readingMore=!1}function y(e){f("readable nexttick read 0"),e.read(0)}function b(e,t){t.reading||(f("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),D(e),t.flowing&&!t.reading&&e.read(0)}function D(e){var t=e._readableState;for(f("flow",t.flowing);t.flowing&&null!==e.read(););}function P(e,t){return 0===t.length?null:(t.objectMode?n=t.buffer.shift():!e||e>=t.length?(n=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):n=function(e,t,n){var r;e<t.head.data.length?(r=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):r=e===t.head.data.length?t.shift():n?function(e,t){var n=t.head,r=1,i=n.data;e-=i.length;for(;n=n.next;){var o=n.data,s=e>o.length?o.length:e;if(s===o.length?i+=o:i+=o.slice(0,e),0===(e-=s)){s===o.length?(++r,n.next?t.head=n.next:t.head=t.tail=null):(t.head=n,n.data=o.slice(s));break}++r}return t.length-=r,i}(e,t):function(e,t){var n=u.allocUnsafe(e),r=t.head,i=1;r.data.copy(n),e-=r.data.length;for(;r=r.next;){var o=r.data,s=e>o.length?o.length:e;if(o.copy(n,n.length-e,0,s),0===(e-=s)){s===o.length?(++i,r.next?t.head=r.next:t.head=t.tail=null):(t.head=r,r.data=o.slice(s));break}++i}return t.length-=i,n}(e,t);return r}(e,t.buffer,t.decoder),n);var n}function w(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,i.nextTick(L,t,e))}function L(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function M(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}C.prototype.read=function(e){f("read",e),e=parseInt(e,10);var t=this._readableState,n=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return f("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?w(this):A(this),null;if(0===(e=g(e,t))&&t.ended)return 0===t.length&&w(this),null;var r,i=t.needReadable;return f("need readable",i),(0===t.length||t.length-e<t.highWaterMark)&&f("length less than watermark",i=!0),t.ended||t.reading?f("reading or ended",i=!1):i&&(f("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=g(n,t))),null===(r=e>0?P(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),n!==e&&t.ended&&w(this)),null!==r&&this.emit("data",r),r},C.prototype._read=function(e){this.emit("error",new Error("_read() is not implemented"))},C.prototype.pipe=function(e,t){var n=this,o=this._readableState;switch(o.pipesCount){case 0:o.pipes=e;break;case 1:o.pipes=[o.pipes,e];break;default:o.pipes.push(e)}o.pipesCount+=1,f("pipe count=%d opts=%j",o.pipesCount,t);var c=(!t||!1!==t.end)&&e!==r.stdout&&e!==r.stderr?h:C;function u(t,r){f("onunpipe"),t===n&&r&&!1===r.hasUnpiped&&(r.hasUnpiped=!0,f("cleanup"),e.removeListener("close",T),e.removeListener("finish",_),e.removeListener("drain",l),e.removeListener("error",S),e.removeListener("unpipe",u),n.removeListener("end",h),n.removeListener("end",C),n.removeListener("data",p),E=!0,!o.awaitDrain||e._writableState&&!e._writableState.needDrain||l())}function h(){f("onend"),e.end()}o.endEmitted?i.nextTick(c):n.once("end",c),e.on("unpipe",u);var l=function(e){return function(){var t=e._readableState;f("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&a(e,"data")&&(t.flowing=!0,D(e))}}(n);e.on("drain",l);var E=!1;var d=!1;function p(t){f("ondata"),d=!1,!1!==e.write(t)||d||((1===o.pipesCount&&o.pipes===e||o.pipesCount>1&&-1!==M(o.pipes,e))&&!E&&(f("false write response, pause",n._readableState.awaitDrain),n._readableState.awaitDrain++,d=!0),n.pause())}function S(t){f("onerror",t),C(),e.removeListener("error",S),0===a(e,"error")&&e.emit("error",t)}function T(){e.removeListener("finish",_),C()}function _(){f("onfinish"),e.removeListener("close",T),C()}function C(){f("unpipe"),n.unpipe(e)}return n.on("data",p),function(e,t,n){if("function"==typeof e.prependListener)return e.prependListener(t,n);e._events&&e._events[t]?s(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n)}(e,"error",S),e.once("close",T),e.once("finish",_),e.emit("pipe",n),o.flowing||(f("pipe resume"),n.resume()),e},C.prototype.unpipe=function(e){var t=this._readableState,n={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,n),this);if(!e){var r=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var o=0;o<i;o++)r[o].emit("unpipe",this,n);return this}var s=M(t.pipes,e);return-1===s?this:(t.pipes.splice(s,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,n),this)},C.prototype.on=function(e,t){var n=c.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var r=this._readableState;r.endEmitted||r.readableListening||(r.readableListening=r.needReadable=!0,r.emittedReadable=!1,r.reading?r.length&&A(this):i.nextTick(y,this))}return n},C.prototype.addListener=C.prototype.on,C.prototype.resume=function(){var e=this._readableState;return e.flowing||(f("resume"),e.flowing=!0,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,i.nextTick(b,e,t))}(this,e)),this},C.prototype.pause=function(){return f("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(f("pause"),this._readableState.flowing=!1,this.emit("pause")),this},C.prototype.wrap=function(e){var t=this,n=this._readableState,r=!1;for(var i in e.on("end",function(){if(f("wrapped end"),n.decoder&&!n.ended){var e=n.decoder.end();e&&e.length&&t.push(e)}t.push(null)}),e.on("data",function(i){(f("wrapped data"),n.decoder&&(i=n.decoder.write(i)),n.objectMode&&null==i)||(n.objectMode||i&&i.length)&&(t.push(i)||(r=!0,e.pause()))}),e)void 0===this[i]&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));for(var o=0;o<T.length;o++)e.on(T[o],this.emit.bind(this,T[o]));return this._read=function(t){f("wrapped _read",t),r&&(r=!1,e.resume())},this},Object.defineProperty(C.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),C._fromList=P}).call(this,n(5),n(!function(){var e=new Error("Cannot find module './../../process/browser.js'");throw e.code="MODULE_NOT_FOUND",e}()))},function(e,t,n){e.exports=n(11).EventEmitter},function(e,t,n){"use strict";var r=n(12);function i(e,t){e.emit("error",t)}e.exports={destroy:function(e,t){var n=this,o=this._readableState&&this._readableState.destroyed,s=this._writableState&&this._writableState.destroyed;return o||s?(t?t(e):!e||this._writableState&&this._writableState.errorEmitted||r.nextTick(i,this,e),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,function(e){!t&&e?(r.nextTick(i,n,e),n._writableState&&(n._writableState.errorEmitted=!0)):t&&t(e)}),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},function(e,t,n){"use strict";var r=n(13).Buffer,i=r.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function o(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(r.isEncoding===i||!i(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=c,this.end=u,t=4;break;case"utf8":this.fillLast=a,t=4;break;case"base64":this.text=h,this.end=l,t=3;break;default:return this.write=E,void(this.end=f)}this.lastNeed=0,this.lastTotal=0,this.lastChar=r.allocUnsafe(t)}function s(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function a(e){var t=this.lastTotal-this.lastNeed,n=function(e,t,n){if(128!=(192&t[0]))return e.lastNeed=0,"";if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"";if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,""}}(this,e);return void 0!==n?n:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function c(e,t){if((e.length-t)%2==0){var n=e.toString("utf16le",t);if(n){var r=n.charCodeAt(n.length-1);if(r>=55296&&r<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],n.slice(0,-1)}return n}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function u(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var n=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,n)}return t}function h(e,t){var n=(e.length-t)%3;return 0===n?e.toString("base64",t):(this.lastNeed=3-n,this.lastTotal=3,1===n?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-n))}function l(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function E(e){return e.toString(this.encoding)}function f(e){return e&&e.length?this.write(e):""}t.StringDecoder=o,o.prototype.write=function(e){if(0===e.length)return"";var t,n;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";n=this.lastNeed,this.lastNeed=0}else n=0;return n<e.length?t?t+this.text(e,n):this.text(e,n):t||""},o.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"":t},o.prototype.text=function(e,t){var n=function(e,t,n){var r=t.length-1;if(r<n)return 0;var i=s(t[r]);if(i>=0)return i>0&&(e.lastNeed=i-1),i;if(--r<n||-2===i)return 0;if((i=s(t[r]))>=0)return i>0&&(e.lastNeed=i-2),i;if(--r<n||-2===i)return 0;if((i=s(t[r]))>=0)return i>0&&(2===i?i=0:e.lastNeed=i-3),i;return 0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=n;var r=e.length-(n-this.lastNeed);return e.copy(this.lastChar,0,r),e.toString("utf8",t,r)},o.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},function(e,t,n){"use strict";e.exports=s;var r=n(7),i=n(10);function o(e,t){var n=this._transformState;n.transforming=!1;var r=n.writecb;if(!r)return this.emit("error",new Error("write callback called multiple times"));n.writechunk=null,n.writecb=null,null!=t&&this.push(t),r(e);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}function s(e){if(!(this instanceof s))return new s(e);r.call(this,e),this._transformState={afterTransform:o.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",a)}function a(){var e=this;"function"==typeof this._flush?this._flush(function(t,n){c(e,t,n)}):c(this,null,null)}function c(e,t,n){if(t)return e.emit("error",t);if(null!=n&&e.push(n),e._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(e._transformState.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}i.inherits=n(6),i.inherits(s,r),s.prototype.push=function(e,t){return this._transformState.needTransform=!1,r.prototype.push.call(this,e,t)},s.prototype._transform=function(e,t,n){throw new Error("_transform() is not implemented")},s.prototype._write=function(e,t,n){var r=this._transformState;if(r.writecb=n,r.writechunk=e,r.writeencoding=t,!r.transforming){var i=this._readableState;(r.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},s.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},s.prototype._destroy=function(e,t){var n=this;r.prototype._destroy.call(this,e,function(e){t(e),n.emit("close")})}},function(e,t){e.exports=function(){var e,t=Array.prototype.slice.call(arguments),n=null;"object"==typeof t[0]?(n=t.shift(),"string"==typeof(e=t.shift())&&(e=n[e])):e=t.shift();return function(r){e.apply(n,t.concat(r))}}},function(e,t,n){e.exports=n(34)},function(e,t,n){"use strict";n(35).install();const r=n(47),i=n(1),o=n(0),s=(e,t)=>new r.Client(e,t);e.exports=Object.assign(s,{CONNECTION_STATE:i.CONNECTION_STATE,C:o,EVENT:i.EVENT,deepstream:s})},function(e,t,n){(function(e){var r,i=n(36).SourceMapConsumer,o=n(21);try{(r=n(14)).existsSync&&r.readFileSync||(r=null)}catch(e){}var s=n(43),a=!1,c=!1,u=!1,h="auto",l={},E={},f=/^data:application\/json[^,]+base64,/,d=[],p=[];function S(){return"browser"===h||"node"!==h&&("undefined"!=typeof window&&"function"==typeof XMLHttpRequest&&!(window.require&&window.module&&window.process&&"renderer"===window.process.type))}function T(e){return function(t){for(var n=0;n<e.length;n++){var r=e[n](t);if(r)return r}return null}}var _=T(d);function C(e,t){if(!e)return t;var n=o.dirname(e),r=/^\w+:\/\/[^\/]*/.exec(n),i=r?r[0]:"",s=n.slice(i.length);return i&&/^\/\w\:/.test(s)?(i+="/")+o.resolve(n.slice(i.length),t).replace(/\\/g,"/"):i+o.resolve(n.slice(i.length),t)}d.push(function(e){if(e=e.trim(),/^file:/.test(e)&&(e=e.replace(/file:\/\/\/(\w:)?/,function(e,t){return t?"":"/"})),e in l)return l[e];var t="";try{if(r)r.existsSync(e)&&(t=r.readFileSync(e,"utf8"));else{var n=new XMLHttpRequest;n.open("GET",e,!1),n.send(null),4===n.readyState&&200===n.status&&(t=n.responseText)}}catch(e){}return l[e]=t});var R=T(p);function O(e){var t=E[e.source];if(!t){var n=R(e.source);n?(t=E[e.source]={url:n.url,map:new i(n.map)}).map.sourcesContent&&t.map.sources.forEach(function(e,n){var r=t.map.sourcesContent[n];if(r){var i=C(t.url,e);l[i]=r}}):t=E[e.source]={url:null,map:null}}if(t&&t.map&&"function"==typeof t.map.originalPositionFor){var r=t.map.originalPositionFor(e);if(null!==r.source)return r.source=C(t.url,r.source),r}return e}function N(){var e,t="";if(this.isNative())t="native";else{!(e=this.getScriptNameOrSourceURL())&&this.isEval()&&(t=this.getEvalOrigin(),t+=", "),t+=e||"<anonymous>";var n=this.getLineNumber();if(null!=n){t+=":"+n;var r=this.getColumnNumber();r&&(t+=":"+r)}}var i="",o=this.getFunctionName(),s=!0,a=this.isConstructor();if(!(this.isToplevel()||a)){var c=this.getTypeName();"[object Object]"===c&&(c="null");var u=this.getMethodName();o?(c&&0!=o.indexOf(c)&&(i+=c+"."),i+=o,u&&o.indexOf("."+u)!=o.length-u.length-1&&(i+=" [as "+u+"]")):i+=c+"."+(u||"<anonymous>")}else a?i+="new "+(o||"<anonymous>"):o?i+=o:(i+=t,s=!1);return s&&(i+=" ("+t+")"),i}function g(e){var t={};return Object.getOwnPropertyNames(Object.getPrototypeOf(e)).forEach(function(n){t[n]=/^(?:is|get)/.test(n)?function(){return e[n].call(e)}:e[n]}),t.toString=N,t}function A(e){if(e.isNative())return e;var t=e.getFileName()||e.getScriptNameOrSourceURL();if(t){var n=e.getLineNumber(),r=e.getColumnNumber()-1;1===n&&r>62&&!S()&&!e.isEval()&&(r-=62);var i=O({source:t,line:n,column:r}),o=(e=g(e)).getFunctionName;return e.getFunctionName=function(){return i.name||o()},e.getFileName=function(){return i.source},e.getLineNumber=function(){return i.line},e.getColumnNumber=function(){return i.column+1},e.getScriptNameOrSourceURL=function(){return i.source},e}var s=e.isEval()&&e.getEvalOrigin();return s?(s=function e(t){var n=/^eval at ([^(]+) \((.+):(\d+):(\d+)\)$/.exec(t);if(n){var r=O({source:n[2],line:+n[3],column:n[4]-1});return"eval at "+n[1]+" ("+r.source+":"+r.line+":"+(r.column+1)+")"}return(n=/^eval at ([^(]+) \((.+)\)$/.exec(t))?"eval at "+n[1]+" ("+e(n[2])+")":t}(s),(e=g(e)).getEvalOrigin=function(){return s},e):e}function I(e,t){return u&&(l={},E={}),e+t.map(function(e){return"\n    at "+A(e)}).join("")}function m(e){var t=/\n    at [^(]+ \((.*):(\d+):(\d+)\)/.exec(e.stack);if(t){var n=t[1],i=+t[2],o=+t[3],s=l[n];if(!s&&r&&r.existsSync(n))try{s=r.readFileSync(n,"utf8")}catch(e){s=""}if(s){var a=s.split(/(?:\r\n|\r|\n)/)[i-1];if(a)return n+":"+i+"\n"+a+"\n"+new Array(o).join(" ")+"^"}}return null}function v(){var t=e.emit;e.emit=function(n){if("uncaughtException"===n){var r=arguments[1]&&arguments[1].stack,i=this.listeners(n).length>0;if(r&&!i)return o=arguments[1],s=m(o),e.stderr._handle&&e.stderr._handle.setBlocking&&e.stderr._handle.setBlocking(!0),s&&(console.error(),console.error(s)),console.error(o.stack),void e.exit(1)}var o,s;return t.apply(this,arguments)}}p.push(function(e){var t,n=function(e){var t;if(S())try{var n=new XMLHttpRequest;n.open("GET",e,!1),n.send(null),t=4===n.readyState?n.responseText:null;var r=n.getResponseHeader("SourceMap")||n.getResponseHeader("X-SourceMap");if(r)return r}catch(e){}t=_(e);for(var i,o,s=/(?:\/\/[@#][ \t]+sourceMappingURL=([^\s'"]+?)[ \t]*$)|(?:\/\*[@#][ \t]+sourceMappingURL=([^\*]+?)[ \t]*(?:\*\/)[ \t]*$)/gm;o=s.exec(t);)i=o;return i?i[1]:null}(e);if(!n)return null;if(f.test(n)){var r=n.slice(n.indexOf(",")+1);t=s(r,"base64").toString(),n=e}else n=C(e,n),t=_(n);return t?{url:n,map:t}:null});var y=d.slice(0),b=p.slice(0);t.wrapCallSite=A,t.getErrorSource=m,t.mapSourcePosition=O,t.retrieveSourceMap=R,t.install=function(t){if((t=t||{}).environment&&(h=t.environment,-1===["node","browser","auto"].indexOf(h)))throw new Error("environment "+h+" was unknown. Available options are {auto, browser, node}");if(t.retrieveFile&&(t.overrideRetrieveFile&&(d.length=0),d.unshift(t.retrieveFile)),t.retrieveSourceMap&&(t.overrideRetrieveSourceMap&&(p.length=0),p.unshift(t.retrieveSourceMap)),t.hookRequire&&!S()){var r;try{r=n(!function(){var e=new Error("Cannot find module 'module'");throw e.code="MODULE_NOT_FOUND",e}())}catch(e){}var i=r.prototype._compile;i.__sourceMapSupport||(r.prototype._compile=function(e,t){return l[t]=e,E[t]=void 0,i.call(this,e,t)},r.prototype._compile.__sourceMapSupport=!0)}(u||(u="emptyCacheBetweenOperations"in t&&t.emptyCacheBetweenOperations),a||(a=!0,Error.prepareStackTrace=I),c)||(!("handleUncaughtExceptions"in t)||t.handleUncaughtExceptions)&&"object"==typeof e&&null!==e&&"function"==typeof e.on&&(c=!0,v())},t.resetRetrieveHandlers=function(){d.length=0,p.length=0,d=y.slice(0),p=b.slice(0)}}).call(this,n(!function(){var e=new Error("Cannot find module './../process/browser.js'");throw e.code="MODULE_NOT_FOUND",e}()))},function(e,t,n){t.SourceMapGenerator=n(18).SourceMapGenerator,t.SourceMapConsumer=n(39).SourceMapConsumer,t.SourceNode=n(42).SourceNode},function(e,t){var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");t.encode=function(e){if(0<=e&&e<n.length)return n[e];throw new TypeError("Must be between 0 and 63: "+e)},t.decode=function(e){return 65<=e&&e<=90?e-65:97<=e&&e<=122?e-97+26:48<=e&&e<=57?e-48+52:43==e?62:47==e?63:-1}},function(e,t,n){var r=n(8);function i(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}i.prototype.unsortedForEach=function(e,t){this._array.forEach(e,t)},i.prototype.add=function(e){var t,n,i,o,s,a;t=this._last,n=e,i=t.generatedLine,o=n.generatedLine,s=t.generatedColumn,a=n.generatedColumn,o>i||o==i&&a>=s||r.compareByGeneratedPositionsInflated(t,n)<=0?(this._last=e,this._array.push(e)):(this._sorted=!1,this._array.push(e))},i.prototype.toArray=function(){return this._sorted||(this._array.sort(r.compareByGeneratedPositionsInflated),this._sorted=!0),this._array},t.MappingList=i},function(e,t,n){var r=n(8),i=n(40),o=n(20).ArraySet,s=n(19),a=n(41).quickSort;function c(e,t){var n=e;return"string"==typeof e&&(n=r.parseSourceMapInput(e)),null!=n.sections?new l(n,t):new u(n,t)}function u(e,t){var n=e;"string"==typeof e&&(n=r.parseSourceMapInput(e));var i=r.getArg(n,"version"),s=r.getArg(n,"sources"),a=r.getArg(n,"names",[]),c=r.getArg(n,"sourceRoot",null),u=r.getArg(n,"sourcesContent",null),h=r.getArg(n,"mappings"),l=r.getArg(n,"file",null);if(i!=this._version)throw new Error("Unsupported version: "+i);c&&(c=r.normalize(c)),s=s.map(String).map(r.normalize).map(function(e){return c&&r.isAbsolute(c)&&r.isAbsolute(e)?r.relative(c,e):e}),this._names=o.fromArray(a.map(String),!0),this._sources=o.fromArray(s,!0),this._absoluteSources=this._sources.toArray().map(function(e){return r.computeSourceURL(c,e,t)}),this.sourceRoot=c,this.sourcesContent=u,this._mappings=h,this._sourceMapURL=t,this.file=l}function h(){this.generatedLine=0,this.generatedColumn=0,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}function l(e,t){var n=e;"string"==typeof e&&(n=r.parseSourceMapInput(e));var i=r.getArg(n,"version"),s=r.getArg(n,"sections");if(i!=this._version)throw new Error("Unsupported version: "+i);this._sources=new o,this._names=new o;var a={line:-1,column:0};this._sections=s.map(function(e){if(e.url)throw new Error("Support for url field in sections not implemented.");var n=r.getArg(e,"offset"),i=r.getArg(n,"line"),o=r.getArg(n,"column");if(i<a.line||i===a.line&&o<a.column)throw new Error("Section offsets must be ordered and non-overlapping.");return a=n,{generatedOffset:{generatedLine:i+1,generatedColumn:o+1},consumer:new c(r.getArg(e,"map"),t)}})}c.fromSourceMap=function(e,t){return u.fromSourceMap(e,t)},c.prototype._version=3,c.prototype.__generatedMappings=null,Object.defineProperty(c.prototype,"_generatedMappings",{configurable:!0,enumerable:!0,get:function(){return this.__generatedMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappings}}),c.prototype.__originalMappings=null,Object.defineProperty(c.prototype,"_originalMappings",{configurable:!0,enumerable:!0,get:function(){return this.__originalMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappings}}),c.prototype._charIsMappingSeparator=function(e,t){var n=e.charAt(t);return";"===n||","===n},c.prototype._parseMappings=function(e,t){throw new Error("Subclasses must implement _parseMappings")},c.GENERATED_ORDER=1,c.ORIGINAL_ORDER=2,c.GREATEST_LOWER_BOUND=1,c.LEAST_UPPER_BOUND=2,c.prototype.eachMapping=function(e,t,n){var i,o=t||null;switch(n||c.GENERATED_ORDER){case c.GENERATED_ORDER:i=this._generatedMappings;break;case c.ORIGINAL_ORDER:i=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}var s=this.sourceRoot;i.map(function(e){var t=null===e.source?null:this._sources.at(e.source);return{source:t=r.computeSourceURL(s,t,this._sourceMapURL),generatedLine:e.generatedLine,generatedColumn:e.generatedColumn,originalLine:e.originalLine,originalColumn:e.originalColumn,name:null===e.name?null:this._names.at(e.name)}},this).forEach(e,o)},c.prototype.allGeneratedPositionsFor=function(e){var t=r.getArg(e,"line"),n={source:r.getArg(e,"source"),originalLine:t,originalColumn:r.getArg(e,"column",0)};if(n.source=this._findSourceIndex(n.source),n.source<0)return[];var o=[],s=this._findMapping(n,this._originalMappings,"originalLine","originalColumn",r.compareByOriginalPositions,i.LEAST_UPPER_BOUND);if(s>=0){var a=this._originalMappings[s];if(void 0===e.column)for(var c=a.originalLine;a&&a.originalLine===c;)o.push({line:r.getArg(a,"generatedLine",null),column:r.getArg(a,"generatedColumn",null),lastColumn:r.getArg(a,"lastGeneratedColumn",null)}),a=this._originalMappings[++s];else for(var u=a.originalColumn;a&&a.originalLine===t&&a.originalColumn==u;)o.push({line:r.getArg(a,"generatedLine",null),column:r.getArg(a,"generatedColumn",null),lastColumn:r.getArg(a,"lastGeneratedColumn",null)}),a=this._originalMappings[++s]}return o},t.SourceMapConsumer=c,u.prototype=Object.create(c.prototype),u.prototype.consumer=c,u.prototype._findSourceIndex=function(e){var t,n=e;if(null!=this.sourceRoot&&(n=r.relative(this.sourceRoot,n)),this._sources.has(n))return this._sources.indexOf(n);for(t=0;t<this._absoluteSources.length;++t)if(this._absoluteSources[t]==e)return t;return-1},u.fromSourceMap=function(e,t){var n=Object.create(u.prototype),i=n._names=o.fromArray(e._names.toArray(),!0),s=n._sources=o.fromArray(e._sources.toArray(),!0);n.sourceRoot=e._sourceRoot,n.sourcesContent=e._generateSourcesContent(n._sources.toArray(),n.sourceRoot),n.file=e._file,n._sourceMapURL=t,n._absoluteSources=n._sources.toArray().map(function(e){return r.computeSourceURL(n.sourceRoot,e,t)});for(var c=e._mappings.toArray().slice(),l=n.__generatedMappings=[],E=n.__originalMappings=[],f=0,d=c.length;f<d;f++){var p=c[f],S=new h;S.generatedLine=p.generatedLine,S.generatedColumn=p.generatedColumn,p.source&&(S.source=s.indexOf(p.source),S.originalLine=p.originalLine,S.originalColumn=p.originalColumn,p.name&&(S.name=i.indexOf(p.name)),E.push(S)),l.push(S)}return a(n.__originalMappings,r.compareByOriginalPositions),n},u.prototype._version=3,Object.defineProperty(u.prototype,"sources",{get:function(){return this._absoluteSources.slice()}}),u.prototype._parseMappings=function(e,t){for(var n,i,o,c,u,l=1,E=0,f=0,d=0,p=0,S=0,T=e.length,_=0,C={},R={},O=[],N=[];_<T;)if(";"===e.charAt(_))l++,_++,E=0;else if(","===e.charAt(_))_++;else{for((n=new h).generatedLine=l,c=_;c<T&&!this._charIsMappingSeparator(e,c);c++);if(o=C[i=e.slice(_,c)])_+=i.length;else{for(o=[];_<c;)s.decode(e,_,R),u=R.value,_=R.rest,o.push(u);if(2===o.length)throw new Error("Found a source, but no line and column");if(3===o.length)throw new Error("Found a source and line, but no column");C[i]=o}n.generatedColumn=E+o[0],E=n.generatedColumn,o.length>1&&(n.source=p+o[1],p+=o[1],n.originalLine=f+o[2],f=n.originalLine,n.originalLine+=1,n.originalColumn=d+o[3],d=n.originalColumn,o.length>4&&(n.name=S+o[4],S+=o[4])),N.push(n),"number"==typeof n.originalLine&&O.push(n)}a(N,r.compareByGeneratedPositionsDeflated),this.__generatedMappings=N,a(O,r.compareByOriginalPositions),this.__originalMappings=O},u.prototype._findMapping=function(e,t,n,r,o,s){if(e[n]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+e[n]);if(e[r]<0)throw new TypeError("Column must be greater than or equal to 0, got "+e[r]);return i.search(e,t,o,s)},u.prototype.computeColumnSpans=function(){for(var e=0;e<this._generatedMappings.length;++e){var t=this._generatedMappings[e];if(e+1<this._generatedMappings.length){var n=this._generatedMappings[e+1];if(t.generatedLine===n.generatedLine){t.lastGeneratedColumn=n.generatedColumn-1;continue}}t.lastGeneratedColumn=1/0}},u.prototype.originalPositionFor=function(e){var t={generatedLine:r.getArg(e,"line"),generatedColumn:r.getArg(e,"column")},n=this._findMapping(t,this._generatedMappings,"generatedLine","generatedColumn",r.compareByGeneratedPositionsDeflated,r.getArg(e,"bias",c.GREATEST_LOWER_BOUND));if(n>=0){var i=this._generatedMappings[n];if(i.generatedLine===t.generatedLine){var o=r.getArg(i,"source",null);null!==o&&(o=this._sources.at(o),o=r.computeSourceURL(this.sourceRoot,o,this._sourceMapURL));var s=r.getArg(i,"name",null);return null!==s&&(s=this._names.at(s)),{source:o,line:r.getArg(i,"originalLine",null),column:r.getArg(i,"originalColumn",null),name:s}}}return{source:null,line:null,column:null,name:null}},u.prototype.hasContentsOfAllSources=function(){return!!this.sourcesContent&&(this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(e){return null==e}))},u.prototype.sourceContentFor=function(e,t){if(!this.sourcesContent)return null;var n=this._findSourceIndex(e);if(n>=0)return this.sourcesContent[n];var i,o=e;if(null!=this.sourceRoot&&(o=r.relative(this.sourceRoot,o)),null!=this.sourceRoot&&(i=r.urlParse(this.sourceRoot))){var s=o.replace(/^file:\/\//,"");if("file"==i.scheme&&this._sources.has(s))return this.sourcesContent[this._sources.indexOf(s)];if((!i.path||"/"==i.path)&&this._sources.has("/"+o))return this.sourcesContent[this._sources.indexOf("/"+o)]}if(t)return null;throw new Error('"'+o+'" is not in the SourceMap.')},u.prototype.generatedPositionFor=function(e){var t=r.getArg(e,"source");if((t=this._findSourceIndex(t))<0)return{line:null,column:null,lastColumn:null};var n={source:t,originalLine:r.getArg(e,"line"),originalColumn:r.getArg(e,"column")},i=this._findMapping(n,this._originalMappings,"originalLine","originalColumn",r.compareByOriginalPositions,r.getArg(e,"bias",c.GREATEST_LOWER_BOUND));if(i>=0){var o=this._originalMappings[i];if(o.source===n.source)return{line:r.getArg(o,"generatedLine",null),column:r.getArg(o,"generatedColumn",null),lastColumn:r.getArg(o,"lastGeneratedColumn",null)}}return{line:null,column:null,lastColumn:null}},t.BasicSourceMapConsumer=u,l.prototype=Object.create(c.prototype),l.prototype.constructor=c,l.prototype._version=3,Object.defineProperty(l.prototype,"sources",{get:function(){for(var e=[],t=0;t<this._sections.length;t++)for(var n=0;n<this._sections[t].consumer.sources.length;n++)e.push(this._sections[t].consumer.sources[n]);return e}}),l.prototype.originalPositionFor=function(e){var t={generatedLine:r.getArg(e,"line"),generatedColumn:r.getArg(e,"column")},n=i.search(t,this._sections,function(e,t){var n=e.generatedLine-t.generatedOffset.generatedLine;return n||e.generatedColumn-t.generatedOffset.generatedColumn}),o=this._sections[n];return o?o.consumer.originalPositionFor({line:t.generatedLine-(o.generatedOffset.generatedLine-1),column:t.generatedColumn-(o.generatedOffset.generatedLine===t.generatedLine?o.generatedOffset.generatedColumn-1:0),bias:e.bias}):{source:null,line:null,column:null,name:null}},l.prototype.hasContentsOfAllSources=function(){return this._sections.every(function(e){return e.consumer.hasContentsOfAllSources()})},l.prototype.sourceContentFor=function(e,t){for(var n=0;n<this._sections.length;n++){var r=this._sections[n].consumer.sourceContentFor(e,!0);if(r)return r}if(t)return null;throw new Error('"'+e+'" is not in the SourceMap.')},l.prototype.generatedPositionFor=function(e){for(var t=0;t<this._sections.length;t++){var n=this._sections[t];if(-1!==n.consumer._findSourceIndex(r.getArg(e,"source"))){var i=n.consumer.generatedPositionFor(e);if(i)return{line:i.line+(n.generatedOffset.generatedLine-1),column:i.column+(n.generatedOffset.generatedLine===i.line?n.generatedOffset.generatedColumn-1:0)}}}return{line:null,column:null}},l.prototype._parseMappings=function(e,t){this.__generatedMappings=[],this.__originalMappings=[];for(var n=0;n<this._sections.length;n++)for(var i=this._sections[n],o=i.consumer._generatedMappings,s=0;s<o.length;s++){var c=o[s],u=i.consumer._sources.at(c.source);u=r.computeSourceURL(i.consumer.sourceRoot,u,this._sourceMapURL),this._sources.add(u),u=this._sources.indexOf(u);var h=null;c.name&&(h=i.consumer._names.at(c.name),this._names.add(h),h=this._names.indexOf(h));var l={source:u,generatedLine:c.generatedLine+(i.generatedOffset.generatedLine-1),generatedColumn:c.generatedColumn+(i.generatedOffset.generatedLine===c.generatedLine?i.generatedOffset.generatedColumn-1:0),originalLine:c.originalLine,originalColumn:c.originalColumn,name:h};this.__generatedMappings.push(l),"number"==typeof l.originalLine&&this.__originalMappings.push(l)}a(this.__generatedMappings,r.compareByGeneratedPositionsDeflated),a(this.__originalMappings,r.compareByOriginalPositions)},t.IndexedSourceMapConsumer=l},function(e,t){t.GREATEST_LOWER_BOUND=1,t.LEAST_UPPER_BOUND=2,t.search=function(e,n,r,i){if(0===n.length)return-1;var o=function e(n,r,i,o,s,a){var c=Math.floor((r-n)/2)+n,u=s(i,o[c],!0);return 0===u?c:u>0?r-c>1?e(c,r,i,o,s,a):a==t.LEAST_UPPER_BOUND?r<o.length?r:-1:c:c-n>1?e(n,c,i,o,s,a):a==t.LEAST_UPPER_BOUND?c:n<0?-1:n}(-1,n.length,e,n,r,i||t.GREATEST_LOWER_BOUND);if(o<0)return-1;for(;o-1>=0&&0===r(n[o],n[o-1],!0);)--o;return o}},function(e,t){function n(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function r(e,t,i,o){if(i<o){var s=i-1;n(e,(h=i,l=o,Math.round(h+Math.random()*(l-h))),o);for(var a=e[o],c=i;c<o;c++)t(e[c],a)<=0&&n(e,s+=1,c);n(e,s+1,c);var u=s+1;r(e,t,i,u-1),r(e,t,u+1,o)}var h,l}t.quickSort=function(e,t){r(e,t,0,e.length-1)}},function(e,t,n){var r=n(18).SourceMapGenerator,i=n(8),o=/(\r?\n)/,s="$$$isSourceNode$$$";function a(e,t,n,r,i){this.children=[],this.sourceContents={},this.line=null==e?null:e,this.column=null==t?null:t,this.source=null==n?null:n,this.name=null==i?null:i,this[s]=!0,null!=r&&this.add(r)}a.fromStringWithSourceMap=function(e,t,n){var r=new a,s=e.split(o),c=0,u=function(){return e()+(e()||"");function e(){return c<s.length?s[c++]:void 0}},h=1,l=0,E=null;return t.eachMapping(function(e){if(null!==E){if(!(h<e.generatedLine)){var t=(n=s[c]||"").substr(0,e.generatedColumn-l);return s[c]=n.substr(e.generatedColumn-l),l=e.generatedColumn,f(E,t),void(E=e)}f(E,u()),h++,l=0}for(;h<e.generatedLine;)r.add(u()),h++;if(l<e.generatedColumn){var n=s[c]||"";r.add(n.substr(0,e.generatedColumn)),s[c]=n.substr(e.generatedColumn),l=e.generatedColumn}E=e},this),c<s.length&&(E&&f(E,u()),r.add(s.splice(c).join(""))),t.sources.forEach(function(e){var o=t.sourceContentFor(e);null!=o&&(null!=n&&(e=i.join(n,e)),r.setSourceContent(e,o))}),r;function f(e,t){if(null===e||void 0===e.source)r.add(t);else{var o=n?i.join(n,e.source):e.source;r.add(new a(e.originalLine,e.originalColumn,o,t,e.name))}}},a.prototype.add=function(e){if(Array.isArray(e))e.forEach(function(e){this.add(e)},this);else{if(!e[s]&&"string"!=typeof e)throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);e&&this.children.push(e)}return this},a.prototype.prepend=function(e){if(Array.isArray(e))for(var t=e.length-1;t>=0;t--)this.prepend(e[t]);else{if(!e[s]&&"string"!=typeof e)throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);this.children.unshift(e)}return this},a.prototype.walk=function(e){for(var t,n=0,r=this.children.length;n<r;n++)(t=this.children[n])[s]?t.walk(e):""!==t&&e(t,{source:this.source,line:this.line,column:this.column,name:this.name})},a.prototype.join=function(e){var t,n,r=this.children.length;if(r>0){for(t=[],n=0;n<r-1;n++)t.push(this.children[n]),t.push(e);t.push(this.children[n]),this.children=t}return this},a.prototype.replaceRight=function(e,t){var n=this.children[this.children.length-1];return n[s]?n.replaceRight(e,t):"string"==typeof n?this.children[this.children.length-1]=n.replace(e,t):this.children.push("".replace(e,t)),this},a.prototype.setSourceContent=function(e,t){this.sourceContents[i.toSetString(e)]=t},a.prototype.walkSourceContents=function(e){for(var t=0,n=this.children.length;t<n;t++)this.children[t][s]&&this.children[t].walkSourceContents(e);var r=Object.keys(this.sourceContents);for(t=0,n=r.length;t<n;t++)e(i.fromSetString(r[t]),this.sourceContents[r[t]])},a.prototype.toString=function(){var e="";return this.walk(function(t){e+=t}),e},a.prototype.toStringWithSourceMap=function(e){var t={code:"",line:1,column:0},n=new r(e),i=!1,o=null,s=null,a=null,c=null;return this.walk(function(e,r){t.code+=e,null!==r.source&&null!==r.line&&null!==r.column?(o===r.source&&s===r.line&&a===r.column&&c===r.name||n.addMapping({source:r.source,original:{line:r.line,column:r.column},generated:{line:t.line,column:t.column},name:r.name}),o=r.source,s=r.line,a=r.column,c=r.name,i=!0):i&&(n.addMapping({generated:{line:t.line,column:t.column}}),o=null,i=!1);for(var u=0,h=e.length;u<h;u++)10===e.charCodeAt(u)?(t.line++,t.column=0,u+1===h?(o=null,i=!1):i&&n.addMapping({source:r.source,original:{line:r.line,column:r.column},generated:{line:t.line,column:t.column},name:r.name})):t.column++}),this.walkSourceContents(function(e,t){n.setSourceContent(e,t)}),{code:t.code,map:n}},t.SourceNode=a},function(e,t,n){(function(t){var n=Object.prototype.toString,r="function"==typeof t.alloc&&"function"==typeof t.allocUnsafe&&"function"==typeof t.from;e.exports=function(e,i,o){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return s=e,"ArrayBuffer"===n.call(s).slice(8,-1)?function(e,n,i){n>>>=0;var o=e.byteLength-n;if(o<0)throw new RangeError("'offset' is out of bounds");if(void 0===i)i=o;else if((i>>>=0)>o)throw new RangeError("'length' is out of bounds");return r?t.from(e.slice(n,n+i)):new t(new Uint8Array(e.slice(n,n+i)))}(e,i,o):"string"==typeof e?function(e,n){if("string"==typeof n&&""!==n||(n="utf8"),!t.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');return r?t.from(e,n):new t(e,n)}(e,i):r?t.from(e):new t(e);var s}}).call(this,n(4).Buffer)},function(e,t,n){"use strict";t.byteLength=function(e){var t=u(e),n=t[0],r=t[1];return 3*(n+r)/4-r},t.toByteArray=function(e){for(var t,n=u(e),r=n[0],s=n[1],a=new o(function(e,t,n){return 3*(t+n)/4-n}(0,r,s)),c=0,h=s>0?r-4:r,l=0;l<h;l+=4)t=i[e.charCodeAt(l)]<<18|i[e.charCodeAt(l+1)]<<12|i[e.charCodeAt(l+2)]<<6|i[e.charCodeAt(l+3)],a[c++]=t>>16&255,a[c++]=t>>8&255,a[c++]=255&t;2===s&&(t=i[e.charCodeAt(l)]<<2|i[e.charCodeAt(l+1)]>>4,a[c++]=255&t);1===s&&(t=i[e.charCodeAt(l)]<<10|i[e.charCodeAt(l+1)]<<4|i[e.charCodeAt(l+2)]>>2,a[c++]=t>>8&255,a[c++]=255&t);return a},t.fromByteArray=function(e){for(var t,n=e.length,i=n%3,o=[],s=0,a=n-i;s<a;s+=16383)o.push(h(e,s,s+16383>a?a:s+16383));1===i?(t=e[n-1],o.push(r[t>>2]+r[t<<4&63]+"==")):2===i&&(t=(e[n-2]<<8)+e[n-1],o.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"="));return o.join("")};for(var r=[],i=[],o="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,c=s.length;a<c;++a)r[a]=s[a],i[s.charCodeAt(a)]=a;function u(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function h(e,t,n){for(var i,o,s=[],a=t;a<n;a+=3)i=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),s.push(r[(o=i)>>18&63]+r[o>>12&63]+r[o>>6&63]+r[63&o]);return s.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,n,r,i){var o,s,a=8*i-r-1,c=(1<<a)-1,u=c>>1,h=-7,l=n?i-1:0,E=n?-1:1,f=e[t+l];for(l+=E,o=f&(1<<-h)-1,f>>=-h,h+=a;h>0;o=256*o+e[t+l],l+=E,h-=8);for(s=o&(1<<-h)-1,o>>=-h,h+=r;h>0;s=256*s+e[t+l],l+=E,h-=8);if(0===o)o=1-u;else{if(o===c)return s?NaN:1/0*(f?-1:1);s+=Math.pow(2,r),o-=u}return(f?-1:1)*s*Math.pow(2,o-r)},t.write=function(e,t,n,r,i,o){var s,a,c,u=8*o-i-1,h=(1<<u)-1,l=h>>1,E=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:o-1,d=r?1:-1,p=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=h):(s=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-s))<1&&(s--,c*=2),(t+=s+l>=1?E/c:E*Math.pow(2,1-l))*c>=2&&(s++,c/=2),s+l>=h?(a=0,s=h):s+l>=1?(a=(t*c-1)*Math.pow(2,i),s+=l):(a=t*Math.pow(2,l-1)*Math.pow(2,i),s=0));i>=8;e[n+f]=255&a,f+=d,a/=256,i-=8);for(s=s<<i|a,u+=i;u>0;e[n+f]=255&s,f+=d,s/=256,u-=8);e[n+f-d]|=128*p}},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(48),i=n(50),o=n(51),s=n(52),a=n(53),c=n(61),u=n(63),h=n(64),l=n(67),E=n(77),f=n(102),d=n(2);t.Client=class extends d{constructor(e,t={}){super(),this.options=Object.assign({},r.DefaultOptions,t);const n={};n.storage=t.storage||new E.Storage(this.options),n.logger=new i.Logger(this),n.timerRegistry=new s.TimerRegistry,n.timeoutRegistry=new o.TimeoutRegistry(n,this.options),n.socketFactory=t.socketFactory||c.socketFactory,n.connection=new a.Connection(n,this.options,e,this),this.services=n,this.services.connection.onLost(n.timeoutRegistry.onConnectionLost.bind(n.timeoutRegistry)),this.event=new u.EventHandler(this.services,this.options),this.rpc=new h.RPCHandler(this.services,this.options),this.record=new l.RecordHandler(this.services,this.options),this.presence=new f.PresenceHandler(this.services,this.options)}login(e,t){if(e&&"object"==typeof e){if(!t)return new Promise((t,n)=>{this.services.connection.authenticate(e,(e,r)=>{e?t(r):n(r)})});this.services.connection.authenticate(e,t)}else{if("function"!=typeof e)return new Promise((e,t)=>{this.services.connection.authenticate({},(n,r)=>{n?e(r):t(r)})});this.services.connection.authenticate({},e)}}getConnectionState(){return this.services.connection.getConnectionState()}close(){this.services.connection.close()}pause(){this.services.connection.pause()}resume(e){if(!e)return new Promise((e,t)=>{this.services.connection.resume(n=>{n?t(n):e()})});this.services.connection.resume(e)}getUid(){return`${(new Date).getTime().toString(36)}-${(1e16*Math.random()).toString(36).replace(".","")}`}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(49);t.DefaultOptions={heartbeatInterval:3e4,reconnectIntervalIncrement:4e3,maxReconnectInterval:18e4,maxReconnectAttempts:5,rpcAcceptTimeout:6e3,rpcResponseTimeout:1e4,subscriptionTimeout:2e3,recordReadAckTimeout:15e3,recordReadTimeout:15e3,recordDeleteTimeout:15e3,offlineBufferTimeout:2e3,discardTimeout:5e3,path:"/deepstream",mergeStrategy:r.REMOTE_WINS,recordDeepCopy:!0,socketOptions:null,dirtyStorageName:"__ds__dirty_records",nodeStoragePath:"./local-storage",nodeStorageSize:5,lazyConnect:!1}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.REMOTE_WINS=((e,t,n,r,i)=>{i(null,n)}),t.LOCAL_WINS=((e,t,n,r,i)=>{i(null,e)})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(1),i=n(0);t.Logger=class{constructor(e){this.emitter=e}warn(e,t,n){let o=`Warning: ${i.TOPIC[e.topic]}`;const s=e.action;s&&(o+=` (${i.ACTIONS[e.topic][s]})`),t&&(o+=`: ${r.EVENT[t]}`),n&&(o+=`  ${"string"==typeof n?n:JSON.stringify(n)}`),console.warn(o)}error(e,t,n){if(o=t,void 0!==r.EVENT[o])t===r.EVENT.IS_CLOSED?this.emitter.emit("error",n,r.EVENT[t],i.TOPIC[i.TOPIC.CONNECTION]):t===r.EVENT.CONNECTION_ERROR&&this.emitter.emit("error",n,r.EVENT[t],i.TOPIC[i.TOPIC.CONNECTION]);else{const r=t||e.action;this.emitter.emit("error",n,i.ACTIONS[e.topic][r],i.TOPIC[e.topic])}var o}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(1),i=n(9),o=n(2);t.TimeoutRegistry=class extends o{constructor(e,t){super(),this.options=t,this.services=e,this.register=new Map}add(e){if(void 0===e.duration&&(e.duration=this.options.subscriptionTimeout),void 0===e.event&&(e.event=r.EVENT.ACK_TIMEOUT),!this.services.connection.isConnected)return-1;this.remove(e.message);const t=Object.assign({},{timerId:-1,uniqueName:this.getUniqueName(e.message),event:e.event},{timeout:e});return t.timerId=this.services.timerRegistry.add({context:this,callback:this.onTimeout,duration:e.duration,data:t}),this.register.set(t.timerId,t),t.timerId}remove(e){let t;const n=i.RESPONSE_TO_REQUEST[e.topic][e.action];t=n?Object.assign({},e,{action:n}):e;const r=this.getUniqueName(t);for(const[e,t]of this.register)t.uniqueName===r&&(this.services.timerRegistry.remove(e),this.register.delete(e))}clear(e){this.services.timerRegistry.remove(e),this.register.delete(e)}onTimeout(e){this.register.delete(e.timerId);const t=e.timeout;t.callback?t.callback(t.event,t.message):this.services.logger.warn(t.message,t.event)}getUniqueName(e){const t=e.originalAction||e.action;let n=`${e.topic}${t}_`;return e.correlationId?n+=e.correlationId:e.name&&(n+=e.name),n}onConnectionLost(){for(const[e]of this.register)clearTimeout(e),this.register.delete(e)}}},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});t.TimerRegistry=class{add(e){return setTimeout(e.callback.bind(e.context,e.data),e.duration)}remove(e){return clearTimeout(e),!0}requestIdleCallback(t){e.nextTick(t)}}}).call(this,n(!function(){var e=new Error("Cannot find module './../../node_modules/process/browser.js'");throw e.code="MODULE_NOT_FOUND",e}()))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(1),i=n(0),o=n(22),s=n(25),a=n(3),c=n(2);t.Connection=class{constructor(e,t,n,i){this.options=t,this.services=e,this.authParams=null,this.handlers=new Map,this.authCallback=null,this.resumeCallback=null,this.emitter=i,this.internalEmitter=new c,this.isInLimbo=!0,this.clientData=null,this.heartbeatInterval=null,this.lastHeartBeat=null,this.endpoint=null,this.reconnectTimeout=null,this.reconnectionAttempt=0,this.limboTimeout=null;let o=!1,u=!0;this.stateMachine=new s.StateMachine(this.services.logger,{init:r.CONNECTION_STATE.CLOSED,onStateChanged:(e,t)=>{e!==t&&(i.emit(r.EVENT.CONNECTION_STATE_CHANGED,e),e===r.CONNECTION_STATE.RECONNECTING?(this.isInLimbo=!0,o=!0,t!==r.CONNECTION_STATE.CLOSED&&(this.internalEmitter.emit(r.EVENT.CONNECTION_LOST),this.limboTimeout=this.services.timerRegistry.add({duration:this.options.offlineBufferTimeout,context:this,callback:()=>{this.isInLimbo=!1,this.internalEmitter.emit(r.EVENT.EXIT_LIMBO)}}))):e===r.CONNECTION_STATE.OPEN&&(o||u)&&(u=!1,this.isInLimbo=!1,this.internalEmitter.emit(r.EVENT.CONNECTION_REESTABLISHED),this.services.timerRegistry.remove(this.limboTimeout)))},transitions:[{name:"initialised",from:r.CONNECTION_STATE.CLOSED,to:r.CONNECTION_STATE.INITIALISING},{name:"connected",from:r.CONNECTION_STATE.INITIALISING,to:r.CONNECTION_STATE.AWAITING_CONNECTION},{name:"connected",from:r.CONNECTION_STATE.REDIRECTING,to:r.CONNECTION_STATE.AWAITING_CONNECTION},{name:"connected",from:r.CONNECTION_STATE.RECONNECTING,to:r.CONNECTION_STATE.AWAITING_CONNECTION},{name:"challenge",from:r.CONNECTION_STATE.AWAITING_CONNECTION,to:r.CONNECTION_STATE.CHALLENGING},{name:"redirected",from:r.CONNECTION_STATE.CHALLENGING,to:r.CONNECTION_STATE.REDIRECTING},{name:"challenge-denied",from:r.CONNECTION_STATE.CHALLENGING,to:r.CONNECTION_STATE.CHALLENGE_DENIED},{name:"accepted",from:r.CONNECTION_STATE.CHALLENGING,to:r.CONNECTION_STATE.AWAITING_AUTHENTICATION,handler:this.onAwaitingAuthentication.bind(this)},{name:"authentication-timeout",from:r.CONNECTION_STATE.AWAITING_CONNECTION,to:r.CONNECTION_STATE.AUTHENTICATION_TIMEOUT},{name:"authentication-timeout",from:r.CONNECTION_STATE.AWAITING_AUTHENTICATION,to:r.CONNECTION_STATE.AUTHENTICATION_TIMEOUT},{name:"authenticate",from:r.CONNECTION_STATE.AWAITING_AUTHENTICATION,to:r.CONNECTION_STATE.AUTHENTICATING},{name:"unsuccesful-login",from:r.CONNECTION_STATE.AUTHENTICATING,to:r.CONNECTION_STATE.AWAITING_AUTHENTICATION},{name:"succesful-login",from:r.CONNECTION_STATE.AUTHENTICATING,to:r.CONNECTION_STATE.OPEN},{name:"too-many-auth-attempts",from:r.CONNECTION_STATE.AUTHENTICATING,to:r.CONNECTION_STATE.TOO_MANY_AUTH_ATTEMPTS},{name:"too-many-auth-attempts",from:r.CONNECTION_STATE.AWAITING_AUTHENTICATION,to:r.CONNECTION_STATE.TOO_MANY_AUTH_ATTEMPTS},{name:"authentication-timeout",from:r.CONNECTION_STATE.AWAITING_AUTHENTICATION,to:r.CONNECTION_STATE.AUTHENTICATION_TIMEOUT},{name:"reconnect",from:r.CONNECTION_STATE.RECONNECTING,to:r.CONNECTION_STATE.RECONNECTING},{name:"closed",from:r.CONNECTION_STATE.CLOSING,to:r.CONNECTION_STATE.CLOSED},{name:"offline",from:r.CONNECTION_STATE.PAUSING,to:r.CONNECTION_STATE.OFFLINE},{name:"error",to:r.CONNECTION_STATE.RECONNECTING},{name:"connection-lost",to:r.CONNECTION_STATE.RECONNECTING},{name:"resume",to:r.CONNECTION_STATE.RECONNECTING},{name:"pause",to:r.CONNECTION_STATE.PAUSING},{name:"close",to:r.CONNECTION_STATE.CLOSING}]}),this.stateMachine.transition("initialised"),this.originalUrl=a.parseUrl(n,this.options.path),this.url=this.originalUrl,t.lazyConnect||this.createEndpoint()}get isConnected(){return this.stateMachine.state===r.CONNECTION_STATE.OPEN}onLost(e){this.internalEmitter.on(r.EVENT.CONNECTION_LOST,e)}removeOnLost(e){this.internalEmitter.off(r.EVENT.CONNECTION_LOST,e)}onReestablished(e){this.internalEmitter.on(r.EVENT.CONNECTION_REESTABLISHED,e)}removeOnReestablished(e){this.internalEmitter.off(r.EVENT.CONNECTION_REESTABLISHED,e)}onExitLimbo(e){this.internalEmitter.on(r.EVENT.EXIT_LIMBO,e)}registerHandler(e,t){this.handlers.set(e,t)}sendMessage(e){this.isOpen()?this.endpoint&&this.endpoint.sendParsedMessage(e):this.services.logger.error(e,r.EVENT.IS_CLOSED)}authenticate(e,t){if(e&&"object"!=typeof e&&"function"!=typeof e)throw new Error("invalid argument authParamsOrCallback");if(t&&"function"!=typeof t)throw new Error("invalid argument callback");this.stateMachine.state!==r.CONNECTION_STATE.CHALLENGE_DENIED&&this.stateMachine.state!==r.CONNECTION_STATE.TOO_MANY_AUTH_ATTEMPTS&&this.stateMachine.state!==r.CONNECTION_STATE.AUTHENTICATION_TIMEOUT?(e&&(this.authParams="object"==typeof e?e:{}),this.authCallback=e&&"function"==typeof e?e:t||(()=>{}),this.stateMachine.state===r.CONNECTION_STATE.AWAITING_AUTHENTICATION&&this.authParams&&this.sendAuthParams(),this.endpoint||this.createEndpoint()):this.services.logger.error({topic:i.TOPIC.CONNECTION},r.EVENT.IS_CLOSED)}getConnectionState(){return this.stateMachine.state}isOpen(){const e=this.getConnectionState();return e!==r.CONNECTION_STATE.CLOSED&&e!==r.CONNECTION_STATE.ERROR&&e!==r.CONNECTION_STATE.CLOSING}close(){this.services.timerRegistry.remove(this.heartbeatInterval),this.sendMessage({topic:i.TOPIC.CONNECTION,action:i.CONNECTION_ACTIONS.CLOSING}),this.stateMachine.transition("close")}pause(){this.stateMachine.transition("pause"),this.services.timerRegistry.remove(this.heartbeatInterval),this.endpoint&&this.endpoint.close()}resume(e){this.stateMachine.transition("resume"),this.resumeCallback=e,this.tryReconnect()}createEndpoint(){this.endpoint=this.services.socketFactory(this.url,this.options.socketOptions),this.endpoint.onopen=this.onOpen.bind(this),this.endpoint.onerror=this.onError.bind(this),this.endpoint.onclose=this.onClose.bind(this),this.endpoint.onparsedmessages=this.onMessages.bind(this)}onOpen(){this.clearReconnect(),this.lastHeartBeat=Date.now(),this.checkHeartBeat(),this.stateMachine.transition("connected"),this.sendMessage({topic:i.TOPIC.CONNECTION,action:i.CONNECTION_ACTIONS.CHALLENGE,url:this.originalUrl,protocolVersion:"0.1a"}),this.stateMachine.transition("challenge")}onError(e){setTimeout(()=>{let t;if("ECONNRESET"===e.code||"ECONNREFUSED"===e.code)t=`Can't connect! Deepstream server unreachable on ${this.originalUrl}`;else try{t=JSON.stringify(e)}catch(n){t=e.toString()}this.services.logger.error({topic:i.TOPIC.CONNECTION},r.EVENT.CONNECTION_ERROR,t)},1),this.services.timerRegistry.remove(this.heartbeatInterval),this.stateMachine.transition("error"),this.tryReconnect()}onClose(){this.services.timerRegistry.remove(this.heartbeatInterval),this.stateMachine.state!==r.CONNECTION_STATE.REDIRECTING?this.stateMachine.state!==r.CONNECTION_STATE.CHALLENGE_DENIED&&this.stateMachine.state!==r.CONNECTION_STATE.TOO_MANY_AUTH_ATTEMPTS&&this.stateMachine.state!==r.CONNECTION_STATE.AUTHENTICATION_TIMEOUT&&(this.stateMachine.state!==r.CONNECTION_STATE.CLOSING?this.stateMachine.state!==r.CONNECTION_STATE.PAUSING?(this.stateMachine.transition("connection-lost"),this.tryReconnect()):this.stateMachine.transition("offline"):this.stateMachine.transition("closed")):this.createEndpoint()}onMessages(e){e.forEach(e=>{if(e.parseError)return void this.services.logger.error({topic:i.TOPIC.PARSER},e.action,e.raw&&e.raw.toString());const t=e,n=o.parseData(t);if(!0!==n&&this.services.logger.error({topic:i.TOPIC.PARSER},i.PARSER_ACTIONS.INVALID_MESSAGE,n),null===t)return;if(t.topic===i.TOPIC.CONNECTION)return void this.handleConnectionResponse(t);if(t.topic===i.TOPIC.AUTH)return void this.handleAuthResponse(t);const r=this.handlers.get(t.topic);r&&r(t)})}sendAuthParams(){this.stateMachine.transition("authenticate"),this.sendMessage({topic:i.TOPIC.AUTH,action:i.AUTH_ACTIONS.REQUEST,parsedData:this.authParams})}checkHeartBeat(){const e=2*this.options.heartbeatInterval;if(Date.now()-this.lastHeartBeat>e)return this.services.timerRegistry.remove(this.heartbeatInterval),this.services.logger.error({topic:i.TOPIC.CONNECTION},r.EVENT.HEARTBEAT_TIMEOUT),void(this.endpoint&&this.endpoint.close());this.heartbeatInterval=this.services.timerRegistry.add({duration:this.options.heartbeatInterval,callback:this.checkHeartBeat,context:this})}tryReconnect(){if(null===this.reconnectTimeout){if(this.reconnectionAttempt<this.options.maxReconnectAttempts)return this.stateMachine.transition("reconnect"),this.reconnectTimeout=setTimeout(this.tryOpen.bind(this),Math.min(this.options.maxReconnectInterval,this.options.reconnectIntervalIncrement*this.reconnectionAttempt)),void this.reconnectionAttempt++;this.emitter.emit(r.EVENT[r.EVENT.MAX_RECONNECTION_ATTEMPTS_REACHED],this.reconnectionAttempt),this.clearReconnect(),this.close()}}tryOpen(){this.stateMachine.state!==r.CONNECTION_STATE.REDIRECTING&&(this.url=this.originalUrl),this.createEndpoint(),this.reconnectTimeout=null}clearReconnect(){this.reconnectTimeout&&clearTimeout(this.reconnectTimeout),this.reconnectTimeout=null,this.reconnectionAttempt=0}handleConnectionResponse(e){return e.action===i.CONNECTION_ACTIONS.PING?(this.lastHeartBeat=Date.now(),void(this.getConnectionState()!==r.CONNECTION_STATE.CLOSING&&this.getConnectionState()!==r.CONNECTION_STATE.PAUSING&&this.sendMessage({topic:i.TOPIC.CONNECTION,action:i.CONNECTION_ACTIONS.PONG}))):e.action!==i.CONNECTION_ACTIONS.ACCEPT?e.action===i.CONNECTION_ACTIONS.REJECT?(this.stateMachine.transition("challenge-denied"),void(this.endpoint&&this.endpoint.close())):e.action===i.CONNECTION_ACTIONS.REDIRECT?(this.url=e.url,this.stateMachine.transition("redirected"),void(this.endpoint&&this.endpoint.close())):void(e.action===i.CONNECTION_ACTIONS.AUTHENTICATION_TIMEOUT&&(this.stateMachine.transition("authentication-timeout"),this.services.logger.error(e))):void this.stateMachine.transition("accepted")}handleAuthResponse(e){return e.action===i.AUTH_ACTIONS.TOO_MANY_AUTH_ATTEMPTS?(this.stateMachine.transition("too-many-auth-attempts"),void this.services.logger.error(e)):e.action===i.AUTH_ACTIONS.AUTH_UNSUCCESSFUL?(this.stateMachine.transition("unsuccesful-login"),void this.onAuthUnSuccessful()):e.action===i.AUTH_ACTIONS.AUTH_SUCCESSFUL?(this.stateMachine.transition("succesful-login"),void this.onAuthSuccessful(e.parsedData)):void 0}onAwaitingAuthentication(){this.authParams&&this.sendAuthParams()}onAuthSuccessful(e){this.updateClientData(e),this.resumeCallback&&(this.resumeCallback(),this.resumeCallback=null),null!==this.authCallback&&(this.authCallback(!0,this.clientData),this.authCallback=null)}onAuthUnSuccessful(){const e={reason:r.EVENT[r.EVENT.INVALID_AUTHENTICATION_DETAILS]};this.resumeCallback&&(this.resumeCallback(e),this.resumeCallback=null),null!==this.authCallback?(this.authCallback(!1,e),this.authCallback=null):this.emitter.emit(r.EVENT.REAUTHENTICATION_FAILURE,e)}updateClientData(e){const t=e||null;(null!==this.clientData||null!==t&&0!==Object.keys(t).length)&&(a.deepEquals(this.clientData,e)||(this.emitter.emit(r.EVENT.CLIENT_DATA_CHANGED,Object.assign({},t)),this.clientData=t))}}},function(e,t,n){"use strict";var r=n(55),i=n(57);function o(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}t.parse=C,t.resolve=function(e,t){return C(e,!1,!0).resolve(t)},t.resolveObject=function(e,t){return e?C(e,!1,!0).resolveObject(t):t},t.format=function(e){i.isString(e)&&(e=C(e));return e instanceof o?e.format():o.prototype.format.call(e)},t.Url=o;var s=/^([a-z0-9.+-]+:)/i,a=/:[0-9]*$/,c=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,u=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),h=["'"].concat(u),l=["%","/","?",";","#"].concat(h),E=["/","?","#"],f=/^[+a-z0-9A-Z_-]{0,63}$/,d=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,p={javascript:!0,"javascript:":!0},S={javascript:!0,"javascript:":!0},T={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},_=n(58);function C(e,t,n){if(e&&i.isObject(e)&&e instanceof o)return e;var r=new o;return r.parse(e,t,n),r}o.prototype.parse=function(e,t,n){if(!i.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var o=e.indexOf("?"),a=-1!==o&&o<e.indexOf("#")?"?":"#",u=e.split(a);u[0]=u[0].replace(/\\/g,"/");var C=e=u.join(a);if(C=C.trim(),!n&&1===e.split("#").length){var R=c.exec(C);if(R)return this.path=C,this.href=C,this.pathname=R[1],R[2]?(this.search=R[2],this.query=t?_.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var O=s.exec(C);if(O){var N=(O=O[0]).toLowerCase();this.protocol=N,C=C.substr(O.length)}if(n||O||C.match(/^\/\/[^@\/]+@[^@\/]+/)){var g="//"===C.substr(0,2);!g||O&&S[O]||(C=C.substr(2),this.slashes=!0)}if(!S[O]&&(g||O&&!T[O])){for(var A,I,m=-1,v=0;v<E.length;v++){-1!==(y=C.indexOf(E[v]))&&(-1===m||y<m)&&(m=y)}-1!==(I=-1===m?C.lastIndexOf("@"):C.lastIndexOf("@",m))&&(A=C.slice(0,I),C=C.slice(I+1),this.auth=decodeURIComponent(A)),m=-1;for(v=0;v<l.length;v++){var y;-1!==(y=C.indexOf(l[v]))&&(-1===m||y<m)&&(m=y)}-1===m&&(m=C.length),this.host=C.slice(0,m),C=C.slice(m),this.parseHost(),this.hostname=this.hostname||"";var b="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!b)for(var D=this.hostname.split(/\./),P=(v=0,D.length);v<P;v++){var w=D[v];if(w&&!w.match(f)){for(var L="",M=0,U=w.length;M<U;M++)w.charCodeAt(M)>127?L+="x":L+=w[M];if(!L.match(f)){var B=D.slice(0,v),k=D.slice(v+1),K=w.match(d);K&&(B.push(K[1]),k.unshift(K[2])),k.length&&(C="/"+k.join(".")+C),this.hostname=B.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),b||(this.hostname=r.toASCII(this.hostname));var Y=this.port?":"+this.port:"",G=this.hostname||"";this.host=G+Y,this.href+=this.host,b&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==C[0]&&(C="/"+C))}if(!p[N])for(v=0,P=h.length;v<P;v++){var H=h[v];if(-1!==C.indexOf(H)){var V=encodeURIComponent(H);V===H&&(V=escape(H)),C=C.split(H).join(V)}}var x=C.indexOf("#");-1!==x&&(this.hash=C.substr(x),C=C.slice(0,x));var j=C.indexOf("?");if(-1!==j?(this.search=C.substr(j),this.query=C.substr(j+1),t&&(this.query=_.parse(this.query)),C=C.slice(0,j)):t&&(this.search="",this.query={}),C&&(this.pathname=C),T[N]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){Y=this.pathname||"";var F=this.search||"";this.path=Y+F}return this.href=this.format(),this},o.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var t=this.protocol||"",n=this.pathname||"",r=this.hash||"",o=!1,s="";this.host?o=e+this.host:this.hostname&&(o=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(o+=":"+this.port)),this.query&&i.isObject(this.query)&&Object.keys(this.query).length&&(s=_.stringify(this.query));var a=this.search||s&&"?"+s||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||T[t])&&!1!==o?(o="//"+(o||""),n&&"/"!==n.charAt(0)&&(n="/"+n)):o||(o=""),r&&"#"!==r.charAt(0)&&(r="#"+r),a&&"?"!==a.charAt(0)&&(a="?"+a),t+o+(n=n.replace(/[?#]/g,function(e){return encodeURIComponent(e)}))+(a=a.replace("#","%23"))+r},o.prototype.resolve=function(e){return this.resolveObject(C(e,!1,!0)).format()},o.prototype.resolveObject=function(e){if(i.isString(e)){var t=new o;t.parse(e,!1,!0),e=t}for(var n=new o,r=Object.keys(this),s=0;s<r.length;s++){var a=r[s];n[a]=this[a]}if(n.hash=e.hash,""===e.href)return n.href=n.format(),n;if(e.slashes&&!e.protocol){for(var c=Object.keys(e),u=0;u<c.length;u++){var h=c[u];"protocol"!==h&&(n[h]=e[h])}return T[n.protocol]&&n.hostname&&!n.pathname&&(n.path=n.pathname="/"),n.href=n.format(),n}if(e.protocol&&e.protocol!==n.protocol){if(!T[e.protocol]){for(var l=Object.keys(e),E=0;E<l.length;E++){var f=l[E];n[f]=e[f]}return n.href=n.format(),n}if(n.protocol=e.protocol,e.host||S[e.protocol])n.pathname=e.pathname;else{for(var d=(e.pathname||"").split("/");d.length&&!(e.host=d.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==d[0]&&d.unshift(""),d.length<2&&d.unshift(""),n.pathname=d.join("/")}if(n.search=e.search,n.query=e.query,n.host=e.host||"",n.auth=e.auth,n.hostname=e.hostname||e.host,n.port=e.port,n.pathname||n.search){var p=n.pathname||"",_=n.search||"";n.path=p+_}return n.slashes=n.slashes||e.slashes,n.href=n.format(),n}var C=n.pathname&&"/"===n.pathname.charAt(0),R=e.host||e.pathname&&"/"===e.pathname.charAt(0),O=R||C||n.host&&e.pathname,N=O,g=n.pathname&&n.pathname.split("/")||[],A=(d=e.pathname&&e.pathname.split("/")||[],n.protocol&&!T[n.protocol]);if(A&&(n.hostname="",n.port=null,n.host&&(""===g[0]?g[0]=n.host:g.unshift(n.host)),n.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===d[0]?d[0]=e.host:d.unshift(e.host)),e.host=null),O=O&&(""===d[0]||""===g[0])),R)n.host=e.host||""===e.host?e.host:n.host,n.hostname=e.hostname||""===e.hostname?e.hostname:n.hostname,n.search=e.search,n.query=e.query,g=d;else if(d.length)g||(g=[]),g.pop(),g=g.concat(d),n.search=e.search,n.query=e.query;else if(!i.isNullOrUndefined(e.search)){if(A)n.hostname=n.host=g.shift(),(b=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=b.shift(),n.host=n.hostname=b.shift());return n.search=e.search,n.query=e.query,i.isNull(n.pathname)&&i.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.href=n.format(),n}if(!g.length)return n.pathname=null,n.search?n.path="/"+n.search:n.path=null,n.href=n.format(),n;for(var I=g.slice(-1)[0],m=(n.host||e.host||g.length>1)&&("."===I||".."===I)||""===I,v=0,y=g.length;y>=0;y--)"."===(I=g[y])?g.splice(y,1):".."===I?(g.splice(y,1),v++):v&&(g.splice(y,1),v--);if(!O&&!N)for(;v--;v)g.unshift("..");!O||""===g[0]||g[0]&&"/"===g[0].charAt(0)||g.unshift(""),m&&"/"!==g.join("/").substr(-1)&&g.push("");var b,D=""===g[0]||g[0]&&"/"===g[0].charAt(0);A&&(n.hostname=n.host=D?"":g.length?g.shift():"",(b=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=b.shift(),n.host=n.hostname=b.shift()));return(O=O||n.host&&g.length)&&!D&&g.unshift(""),g.length?n.pathname=g.join("/"):(n.pathname=null,n.path=null),i.isNull(n.pathname)&&i.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.auth=e.auth||n.auth,n.slashes=n.slashes||e.slashes,n.href=n.format(),n},o.prototype.parseHost=function(){var e=this.host,t=a.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},function(e,t,n){(function(e,r){var i;/*! https://mths.be/punycode v1.4.1 by @mathias */!function(o){t&&t.nodeType,e&&e.nodeType;var s="object"==typeof r&&r;s.global!==s&&s.window!==s&&s.self;var a,c=2147483647,u=36,h=1,l=26,E=38,f=700,d=72,p=128,S="-",T=/^xn--/,_=/[^\x20-\x7E]/,C=/[\x2E\u3002\uFF0E\uFF61]/g,R={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},O=u-h,N=Math.floor,g=String.fromCharCode;function A(e){throw new RangeError(R[e])}function I(e,t){for(var n=e.length,r=[];n--;)r[n]=t(e[n]);return r}function m(e,t){var n=e.split("@"),r="";return n.length>1&&(r=n[0]+"@",e=n[1]),r+I((e=e.replace(C,".")).split("."),t).join(".")}function v(e){for(var t,n,r=[],i=0,o=e.length;i<o;)(t=e.charCodeAt(i++))>=55296&&t<=56319&&i<o?56320==(64512&(n=e.charCodeAt(i++)))?r.push(((1023&t)<<10)+(1023&n)+65536):(r.push(t),i--):r.push(t);return r}function y(e){return I(e,function(e){var t="";return e>65535&&(t+=g((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+=g(e)}).join("")}function b(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function D(e,t,n){var r=0;for(e=n?N(e/f):e>>1,e+=N(e/t);e>O*l>>1;r+=u)e=N(e/O);return N(r+(O+1)*e/(e+E))}function P(e){var t,n,r,i,o,s,a,E,f,T,_,C=[],R=e.length,O=0,g=p,I=d;for((n=e.lastIndexOf(S))<0&&(n=0),r=0;r<n;++r)e.charCodeAt(r)>=128&&A("not-basic"),C.push(e.charCodeAt(r));for(i=n>0?n+1:0;i<R;){for(o=O,s=1,a=u;i>=R&&A("invalid-input"),((E=(_=e.charCodeAt(i++))-48<10?_-22:_-65<26?_-65:_-97<26?_-97:u)>=u||E>N((c-O)/s))&&A("overflow"),O+=E*s,!(E<(f=a<=I?h:a>=I+l?l:a-I));a+=u)s>N(c/(T=u-f))&&A("overflow"),s*=T;I=D(O-o,t=C.length+1,0==o),N(O/t)>c-g&&A("overflow"),g+=N(O/t),O%=t,C.splice(O++,0,g)}return y(C)}function w(e){var t,n,r,i,o,s,a,E,f,T,_,C,R,O,I,m=[];for(C=(e=v(e)).length,t=p,n=0,o=d,s=0;s<C;++s)(_=e[s])<128&&m.push(g(_));for(r=i=m.length,i&&m.push(S);r<C;){for(a=c,s=0;s<C;++s)(_=e[s])>=t&&_<a&&(a=_);for(a-t>N((c-n)/(R=r+1))&&A("overflow"),n+=(a-t)*R,t=a,s=0;s<C;++s)if((_=e[s])<t&&++n>c&&A("overflow"),_==t){for(E=n,f=u;!(E<(T=f<=o?h:f>=o+l?l:f-o));f+=u)I=E-T,O=u-T,m.push(g(b(T+I%O,0))),E=N(I/O);m.push(g(b(E,0))),o=D(n,R,r==i),n=0,++r}++n,++t}return m.join("")}a={version:"1.4.1",ucs2:{decode:v,encode:y},decode:P,encode:w,toASCII:function(e){return m(e,function(e){return _.test(e)?"xn--"+w(e):e})},toUnicode:function(e){return m(e,function(e){return T.test(e)?P(e.slice(4).toLowerCase()):e})}},void 0===(i=function(){return a}.call(t,n,t,e))||(e.exports=i)}()}).call(this,n(56)(e),n(5))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){"use strict";e.exports={isString:function(e){return"string"==typeof e},isObject:function(e){return"object"==typeof e&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}}},function(e,t,n){"use strict";t.decode=t.parse=n(59),t.encode=t.stringify=n(60)},function(e,t,n){"use strict";function r(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.exports=function(e,t,n,o){t=t||"&",n=n||"=";var s={};if("string"!=typeof e||0===e.length)return s;var a=/\+/g;e=e.split(t);var c=1e3;o&&"number"==typeof o.maxKeys&&(c=o.maxKeys);var u=e.length;c>0&&u>c&&(u=c);for(var h=0;h<u;++h){var l,E,f,d,p=e[h].replace(a,"%20"),S=p.indexOf(n);S>=0?(l=p.substr(0,S),E=p.substr(S+1)):(l=p,E=""),f=decodeURIComponent(l),d=decodeURIComponent(E),r(s,f)?i(s[f])?s[f].push(d):s[f]=[s[f],d]:s[f]=d}return s};var i=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},function(e,t,n){"use strict";var r=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};e.exports=function(e,t,n,a){return t=t||"&",n=n||"=",null===e&&(e=void 0),"object"==typeof e?o(s(e),function(s){var a=encodeURIComponent(r(s))+n;return i(e[s])?o(e[s],function(e){return a+encodeURIComponent(r(e))}).join(t):a+encodeURIComponent(r(e[s]))}).join(t):a?encodeURIComponent(r(a))+n+encodeURIComponent(r(e)):""};var i=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function o(e,t){if(e.map)return e.map(t);for(var n=[],r=0;r<e.length;r++)n.push(t(e[r],r));return n}var s=Object.keys||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t}},function(e,t,n){"use strict";(function(e,r){Object.defineProperty(t,"__esModule",{value:!0});const i=n(!function(){var e=new Error("Cannot find module 'ws'");throw e.code="MODULE_NOT_FOUND",e}()),o=n(22),s=n(62),a=n(0),c=e.WebSocket||e.MozWebSocket;t.socketFactory=((e,t)=>{const n=c?new c(e,[],t):new i(e,t);return c&&(n.binaryType="arraybuffer"),n.onparsedmessage=(()=>{}),n.onmessage=(e=>{const t=o.parse(c?new r(new Uint8Array(e.data)):e.data);n.onparsedmessages(t)}),n.sendParsedMessage=(e=>{if(e.topic===a.TOPIC.CONNECTION&&e.action===a.CONNECTION_ACTIONS.CLOSING)return n.onparsedmessages([{topic:a.TOPIC.CONNECTION,action:a.CONNECTION_ACTIONS.CLOSED}]),void n.close();e.data=JSON.stringify(e.parsedData),n.send(s.getMessage(e,!1))}),n})}).call(this,n(5),n(4).Buffer)},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});const r=n(0),i=n(9),o=n(23),s=n(24);function a(t,n,r,i,s){const a=i?i.length:0,c=s?s.length:0,u=o.HEADER_LENGTH+a+c,h=e.allocUnsafe(u);return h[0]=(t?128:0)|n,h[1]=r,h.writeUIntBE(a,2,3),h.writeUIntBE(c,5,3),i&&i.copy(h,o.HEADER_LENGTH),s&&s.copy(h,o.HEADER_LENGTH+a),h}t.getMessage=function(t,n){const c=t;let u=c.action;if(c.isWriteAck&&!i.isWriteAck(c.action)&&(u=i.ACTION_TO_WRITE_ACK[c.action]),(c.isAck||n)&&(u|=128,void 0===r.ACTIONS[c.topic][c.action]))throw new Error(`message ${r.TOPIC[c.topic]} ${c.action} should not have an ack`);const h=Object.create(null);for(const e in r.META_KEYS)h[r.META_KEYS[e]]=c[e];h[r.META_KEYS.payloadEncoding]===r.PAYLOAD_ENCODING.JSON&&delete h[r.META_KEYS.payloadEncoding];const l=s.validateMeta(c.topic,u,h);if(l)throw new Error(`invalid ${r.TOPIC[c.topic]} ${r.ACTIONS[c.topic][u]||u}: ${l}`);const E=JSON.stringify(h),f="{}"===E?null:e.from(E,"utf8");let d;if(c.data instanceof e)d=c.data;else if(void 0!==c.data||void 0!==c.parsedData){let t=c.data;void 0===t&&(t=JSON.stringify(c.parsedData)),d=e.from(t,"utf8")}else d=null;d&&!s.hasPayload(c.topic,u)&&console.error(`invalid message ${r.TOPIC[c.topic]} ${c.action}: should not have payload`);const p=f?f.length:0,S=d?d.length:0;return p<=o.META_PAYLOAD_OVERFLOW_LENGTH&&S<=o.META_PAYLOAD_OVERFLOW_LENGTH?a(!0,c.topic,u,f,d):function(t,n,r,i){const s=r?r.length:0,c=i?i.length:0,u=[];let h,l=0,E=0;do{const e=Math.min(s-l,o.META_PAYLOAD_OVERFLOW_LENGTH),f=Math.min(c-E,o.META_PAYLOAD_OVERFLOW_LENGTH),d=r&&r.slice(l,l+e),p=i&&i.slice(E,E+f);E+=f,h=(l+=e)===s&&E===c,u.push(a(h,t,n,d,p))}while(!h);return e.concat(u)}(c.topic,u,f,d)}}).call(this,n(4).Buffer)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0),i=n(1),o=n(26),s=n(2);t.EventHandler=class{constructor(e,t,n){this.services=e,this.listeners=n||new o.Listener(r.TOPIC.EVENT,e),this.emitter=new s,this.limboQueue=[],this.services.connection.registerHandler(r.TOPIC.EVENT,this.handle.bind(this)),this.services.connection.onExitLimbo(this.onExitLimbo.bind(this)),this.services.connection.onReestablished(this.onConnectionReestablished.bind(this))}subscribe(e,t){if("string"!=typeof e||0===e.length)throw new Error("invalid argument name");if("function"!=typeof t)throw new Error("invalid argument callback");this.emitter.hasListeners(e)||this.services.connection.isConnected&&this.sendSubscriptionMessage(e),this.emitter.on(e,t)}unsubscribe(e,t){if(!e||"string"!=typeof e||0===e.length)throw new Error("invalid argument name");if(void 0!==t&&"function"!=typeof t)throw new Error("invalid argument callback");if(this.emitter.hasListeners(e)){if(this.emitter.off(e,t),!this.emitter.hasListeners(e)){const t={topic:r.TOPIC.EVENT,action:r.EVENT_ACTIONS.UNSUBSCRIBE,name:e};this.services.timeoutRegistry.add({message:t}),this.services.connection.sendMessage(t)}}else this.services.logger.warn({topic:r.TOPIC.EVENT,action:r.EVENT_ACTIONS.NOT_SUBSCRIBED,name:e})}emit(e,t){if("string"!=typeof e||0===e.length)throw new Error("invalid argument name");const n={topic:r.TOPIC.EVENT,action:r.EVENT_ACTIONS.EMIT,name:e,parsedData:t};this.services.connection.isConnected?this.services.connection.sendMessage(n):this.services.connection.isInLimbo&&this.limboQueue.push(n),this.emitter.emit(e,t)}listen(e,t){this.listeners.listen(e,t)}unlisten(e){this.listeners.unlisten(e)}handle(e){if(e.isAck)this.services.timeoutRegistry.remove(e);else{if(e.action!==r.EVENT_ACTIONS.EMIT)return e.action===r.EVENT_ACTIONS.MESSAGE_DENIED?(this.services.logger.error({topic:r.TOPIC.EVENT},r.EVENT_ACTIONS.MESSAGE_DENIED),this.services.timeoutRegistry.remove(e),void(e.originalAction===r.EVENT_ACTIONS.SUBSCRIBE&&this.emitter.off(e.name))):e.action===r.EVENT_ACTIONS.MULTIPLE_SUBSCRIPTIONS?(this.services.timeoutRegistry.remove(Object.assign({},e,{action:r.EVENT_ACTIONS.SUBSCRIBE})),void this.services.logger.warn(e)):e.action===r.EVENT_ACTIONS.NOT_SUBSCRIBED?(this.services.timeoutRegistry.remove(Object.assign({},e,{action:r.EVENT_ACTIONS.SUBSCRIBE})),void this.services.logger.warn(e)):void(e.action!==r.EVENT_ACTIONS.SUBSCRIPTION_FOR_PATTERN_FOUND&&e.action!==r.EVENT_ACTIONS.SUBSCRIPTION_FOR_PATTERN_REMOVED?e.action!==r.EVENT_ACTIONS.INVALID_LISTEN_REGEX?this.services.logger.error(e,i.EVENT.UNSOLICITED_MESSAGE):this.services.logger.error(e):this.listeners.handle(e));void 0!==e.parsedData?this.emitter.emit(e.name,e.parsedData):this.emitter.emit(e.name,void 0)}}onConnectionReestablished(){const e=this.emitter.eventNames();for(const t of e)this.sendSubscriptionMessage(t);for(let e=0;e<this.limboQueue.length;e++)this.services.connection.sendMessage(this.limboQueue[e]);this.limboQueue=[]}onExitLimbo(){this.limboQueue=[]}sendSubscriptionMessage(e){const t={topic:r.TOPIC.EVENT,action:r.EVENT_ACTIONS.SUBSCRIBE,name:e};this.services.timeoutRegistry.add({message:t}),this.services.connection.sendMessage(t)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0),i=n(1),o=n(65),s=n(66),a=n(3);t.RPCHandler=class{constructor(e,t){this.services=e,this.options=t,this.rpcs=new Map,this.providers=new Map,this.limboQueue=[],this.services.connection.registerHandler(r.TOPIC.RPC,this.handle.bind(this)),this.services.connection.onReestablished(this.onConnectionReestablished.bind(this)),this.services.connection.onExitLimbo(this.onExitLimbo.bind(this)),this.services.connection.onLost(this.onConnectionLost.bind(this))}provide(e,t){if("string"!=typeof e||0===e.length)throw new Error("invalid argument name");if(this.providers.has(e))throw new Error(`RPC ${e} already registered`);if("function"!=typeof t)throw new Error("invalid argument callback");this.providers.set(e,t),this.services.connection.isConnected&&this.sendProvide(e)}unprovide(e){if("string"!=typeof e||0===e.length)throw new Error("invalid argument name");if(this.providers.has(e)){if(this.providers.delete(e),this.services.connection.isConnected){const t={topic:r.TOPIC.RPC,action:r.RPC_ACTIONS.UNPROVIDE,name:e};return this.services.timeoutRegistry.add({message:t}),void this.services.connection.sendMessage(t)}}else this.services.logger.warn({topic:r.TOPIC.RPC,action:r.RPC_ACTIONS.NOT_PROVIDED,name:e})}make(e,t,n){if("string"!=typeof e||0===e.length)throw new Error("invalid argument name");if(n&&"function"!=typeof n)throw new Error("invalid argument callback");const r=a.getUid();if(this.services.connection.isConnected)return n?void this.rpcs.set(r,new o.RPC(e,r,t,n,this.options,this.services)):new Promise((n,i)=>{this.rpcs.set(r,new o.RPC(e,r,t,(e,t)=>e?i(e):n(t),this.options,this.services))});if(this.services.connection.isInLimbo){if(!n)return new Promise((n,i)=>{this.limboQueue.push({correlationId:r,name:e,data:t,callback:(e,t)=>e?i(e):n(t)})});this.limboQueue.push({correlationId:r,name:e,data:t,callback:n})}else{if(!n)return Promise.reject(i.EVENT.CLIENT_OFFLINE);n(i.EVENT.CLIENT_OFFLINE)}}respondToRpc(e){const t=this.providers.get(e.name);t?t(e.parsedData,new s.RPCResponse(e,this.options,this.services)):this.services.connection.sendMessage({topic:r.TOPIC.RPC,action:r.RPC_ACTIONS.REJECT,name:e.name,correlationId:e.correlationId})}handle(e){if(e.action===r.RPC_ACTIONS.REQUEST)return void this.respondToRpc(e);if(e.isAck)return void this.services.timeoutRegistry.remove(e);if(e.action===r.RPC_ACTIONS.MESSAGE_PERMISSION_ERROR||e.action===r.RPC_ACTIONS.MESSAGE_DENIED){if(e.originalAction===r.RPC_ACTIONS.PROVIDE||e.originalAction===r.RPC_ACTIONS.UNPROVIDE)return this.services.timeoutRegistry.remove(e),this.providers.delete(e.name),void this.services.logger.error(e);if(e.originalAction===r.RPC_ACTIONS.REQUEST){const t=this.getRPC(e);if(t)return t.error(r.RPC_ACTIONS[e.action]),void this.rpcs.delete(e.correlationId)}}const t=this.getRPC(e);if(t){if(e.action===r.RPC_ACTIONS.ACCEPT)return void t.accept();e.action===r.RPC_ACTIONS.RESPONSE?t.respond(e.parsedData):e.action===r.RPC_ACTIONS.REQUEST_ERROR?t.error(e.parsedData):e.action!==r.RPC_ACTIONS.RESPONSE_TIMEOUT&&e.action!==r.RPC_ACTIONS.NO_RPC_PROVIDER||t.error(r.RPC_ACTIONS[e.action]),this.rpcs.delete(e.correlationId)}}getRPC(e){const t=this.rpcs.get(e.correlationId);return void 0===t&&this.services.logger.error(e,i.EVENT.UNKNOWN_CORRELATION_ID),t}sendProvide(e){const t={topic:r.TOPIC.RPC,action:r.RPC_ACTIONS.PROVIDE,name:e};this.services.timeoutRegistry.add({message:t}),this.services.connection.sendMessage(t)}onConnectionReestablished(){for(const[e]of this.providers)this.sendProvide(e);for(let e=0;e<this.limboQueue.length;e++){const{correlationId:t,name:n,data:r,callback:i}=this.limboQueue[e];this.rpcs.set(t,new o.RPC(n,t,r,i,this.options,this.services))}this.limboQueue=[]}onExitLimbo(){for(let e=0;e<this.limboQueue.length;e++)this.limboQueue[e].callback(i.EVENT.CLIENT_OFFLINE);this.limboQueue=[]}onConnectionLost(){this.rpcs.forEach(e=>{e.error(i.EVENT.CLIENT_OFFLINE)}),this.rpcs.clear()}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0);t.RPC=class{constructor(e,t,n,i,o,s){this.options=o,this.services=s,this.name=e,this.correlationId=t,this.response=i,this.onTimeout=this.onTimeout.bind(this);const a={topic:r.TOPIC.RPC,action:r.RPC_ACTIONS.REQUEST,correlationId:t,name:e,parsedData:n};this.acceptTimeout=this.services.timeoutRegistry.add({message:{topic:r.TOPIC.RPC,action:r.RPC_ACTIONS.ACCEPT,name:this.name,correlationId:this.correlationId},event:r.RPC_ACTIONS.ACCEPT_TIMEOUT,duration:this.options.rpcAcceptTimeout,callback:this.onTimeout.bind(this)}),this.responseTimeout=this.services.timeoutRegistry.add({message:{topic:r.TOPIC.RPC,action:r.RPC_ACTIONS.REQUEST,name:this.name,correlationId:this.correlationId},event:r.RPC_ACTIONS.RESPONSE_TIMEOUT,duration:this.options.rpcResponseTimeout,callback:this.onTimeout}),this.services.connection.sendMessage(a)}accept(){this.services.timeoutRegistry.clear(this.acceptTimeout)}respond(e){this.response(null,e),this.complete()}error(e){this.response(e),this.complete()}onTimeout(e,t){this.response(r.RPC_ACTIONS[e]),this.complete()}complete(){this.services.timeoutRegistry.clear(this.acceptTimeout),this.services.timeoutRegistry.clear(this.responseTimeout)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0);t.RPCResponse=class{constructor(e,t,n){this.name=e.name,this.correlationId=e.correlationId,this.services=n,this.isAccepted=!1,this.isComplete=!1,this.autoAccept=!0,this.services.timerRegistry.requestIdleCallback(this.performAutoAck.bind(this))}accept(){!1===this.isAccepted&&(this.services.connection.sendMessage({topic:r.TOPIC.RPC,action:r.RPC_ACTIONS.ACCEPT,name:this.name,correlationId:this.correlationId}),this.isAccepted=!0)}reject(){if(!0===this.isComplete)throw new Error(`Rpc ${this.name} already completed`);this.autoAccept=!1,this.isComplete=!0,this.isAccepted=!0,this.services.connection.sendMessage({topic:r.TOPIC.RPC,action:r.RPC_ACTIONS.REJECT,name:this.name,correlationId:this.correlationId})}error(e){if(!0===this.isComplete)throw new Error(`Rpc ${this.name} already completed`);this.autoAccept=!1,this.isComplete=!0,this.isAccepted=!0,this.services.connection.sendMessage({topic:r.TOPIC.RPC,action:r.RPC_ACTIONS.REQUEST_ERROR,name:this.name,correlationId:this.correlationId,parsedData:e})}send(e){if(!0===this.isComplete)throw new Error(`Rpc ${this.name} already completed`);this.accept(),this.services.connection.sendMessage({topic:r.TOPIC.RPC,action:r.RPC_ACTIONS.RESPONSE,name:this.name,correlationId:this.correlationId,parsedData:e}),this.isComplete=!0}performAutoAck(){!0===this.autoAccept&&this.accept()}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(3),i=n(1),o=n(0),s=n(9),a=n(68),c=n(70),u=n(71),h=n(72),l=n(26),E=n(73),f=n(74),d=n(75),p=n(76);t.RecordHandler=class{constructor(e,t,n,r){this.services=e,this.options=t,this.listener=r||new l.Listener(o.TOPIC.RECORD,this.services),this.recordCores=new Map,this.recordServices=n||{writeAckService:new f.WriteAcknowledgementService(e),readRegistry:new E.SingleNotifier(e,o.RECORD_ACTIONS.READ,t.recordReadTimeout),headRegistry:new E.SingleNotifier(e,o.RECORD_ACTIONS.HEAD,t.recordReadTimeout),dirtyService:new d.DirtyService(e.storage,t.dirtyStorageName),mergeStrategy:new p.MergeStrategyService(e,t.mergeStrategy)},this.dirtyService=this.recordServices.dirtyService,this.sendUpdatedData=this.sendUpdatedData.bind(this),this.onRecordUpdated=this.onRecordUpdated.bind(this),this.onMergeCompleted=this.onMergeCompleted.bind(this),this.getRecordCore=this.getRecordCore.bind(this),this.services.connection.registerHandler(o.TOPIC.RECORD,this.handle.bind(this)),this.services.connection.onReestablished(this.syncDirtyRecords.bind(this)),this.services.connection.isConnected&&this.syncDirtyRecords()}setMergeStrategy(e,t){if("function"!=typeof t)throw new Error("Invalid merge strategy: Must be a Function");this.recordServices.mergeStrategy.setMergeStrategyByName(e,t)}setMergeStrategyRegExp(e,t){if("function"!=typeof t)throw new Error("Invalid merge strategy: Must be a Function");this.recordServices.mergeStrategy.setMergeStrategyByPattern(e,t)}getRecord(e){return new c.Record(this.getRecordCore(e))}getList(e){return new h.List(this.getRecordCore(e))}getAnonymousRecord(){return new u.AnonymousRecord(this.getRecordCore)}listen(e,t){this.listener.listen(e,t)}unlisten(e){this.listener.unlisten(e)}snapshot(e,t){if("string"!=typeof e||0===e.length)throw new Error("invalid argument: name");if(void 0!==t&&"function"!=typeof t)throw new Error("invalid argument: callback");const n=this.recordCores.get(e);return n?t?void n.whenReady(null,()=>{t(null,n.get())}):new Promise((e,t)=>{n.whenReady(null,()=>{e(n.get())})}):t?void this.recordServices.readRegistry.request(e,t):new Promise((t,n)=>{this.recordServices.readRegistry.request(e,(e,r)=>e?n(e):t(r))})}has(e,t){if("string"!=typeof e||0===e.length)throw new Error("invalid argument: name");if(void 0!==t&&"function"!=typeof t)throw new Error("invalid argument: callback");let n;if(!t)return new Promise((t,r)=>{n=((e,n)=>e?r(e):t(-1!==n)),this.head(e,n)});n=((e,n)=>e?t(e,null):t(null,-1!==n)),this.head(e,n)}head(e,t){if("string"!=typeof e||0===e.length)throw new Error("invalid argument: name");if(void 0!==t&&"function"!=typeof t)throw new Error("invalid argument: callback");const n=this.recordCores.get(e);return n?t?void n.whenReady(null,()=>{t(null,n.version)}):new Promise((e,t)=>{n.whenReady(null,()=>{e(n.version)})}):t?void this.recordServices.headRegistry.request(e,t):new Promise((t,n)=>{this.recordServices.headRegistry.request(e,(e,r)=>e?n(e):t(r))})}setDataWithAck(e,...t){const n=r.normalizeSetArguments(arguments,1);if(!n.callback)return new Promise((t,r)=>{n.callback=(e=>null===e?t():r(e)),this.sendSetData(e,-1,n)});this.sendSetData(e,-1,n)}setData(e){const t=r.normalizeSetArguments(arguments,1);this.sendSetData(e,-1,t)}sendSetData(e,t,n){const{path:r,data:i,callback:s}=n;if(!e||"string"!=typeof e||0===e.length)throw new Error("invalid argument: recordName must be an non empty string");if(!r&&(null===i||"object"!=typeof i))throw new Error("invalid argument: data must be an object when no path is provided");const a=this.recordCores.get(e);if(a)return void a.set({path:r,data:i,callback:s});let c;c=r?void 0===i?o.RECORD_ACTIONS.ERASE:o.RECORD_ACTIONS.CREATEANDPATCH:o.RECORD_ACTIONS.CREATEANDUPDATE;const u={topic:o.TOPIC.RECORD,action:c,name:e,path:r,version:t,parsedData:i};s?this.recordServices.writeAckService.send(u,s):this.services.connection.sendMessage(u)}handle(e){if(e.action===o.RECORD_ACTIONS.SUBSCRIPTION_FOR_PATTERN_FOUND||e.action===o.RECORD_ACTIONS.SUBSCRIPTION_FOR_PATTERN_REMOVED||e.action===o.RECORD_ACTIONS.LISTEN||e.action===o.RECORD_ACTIONS.UNLISTEN)return void this.listener.handle(e);if(s.isWriteAck(e.action)||s.isWriteAck(e.originalAction))return void this.recordServices.writeAckService.recieve(e);if(e.action===o.RECORD_ACTIONS.READ_RESPONSE||e.originalAction===o.RECORD_ACTIONS.READ)return void(e.isError?this.recordServices.readRegistry.recieve(e,o.RECORD_ACTIONS[e.action]):this.recordServices.readRegistry.recieve(e,null,e.parsedData));e.action!==o.RECORD_ACTIONS.HEAD_RESPONSE&&e.originalAction!==o.RECORD_ACTIONS.HEAD||(e.isError?this.recordServices.headRegistry.recieve(e,o.RECORD_ACTIONS[e.action]):this.recordServices.headRegistry.recieve(e,null,e.version));const t=this.recordCores.get(e.name);t?t.handle(e):e.action!==o.RECORD_ACTIONS.VERSION_EXISTS&&e.action!==o.RECORD_ACTIONS.SUBSCRIPTION_HAS_PROVIDER&&e.action!==o.RECORD_ACTIONS.SUBSCRIPTION_HAS_NO_PROVIDER&&(e.isError?this.services.logger.error(e):this.services.logger.error(e,i.EVENT.UNSOLICITED_MESSAGE))}removeRecord(e){this.recordCores.delete(e)}getRecordCore(e){let t=this.recordCores.get(e);return t?t.usages++:(t=new a.RecordCore(e,this.services,this.options,this.recordServices,this.removeRecord.bind(this)),this.recordCores.set(e,t)),t}syncDirtyRecords(){this.dirtyService.whenLoaded(()=>{const e=this.dirtyService.getAll();for(const t in e){const e=this.recordCores.get(t);e&&e.usages>0||this.services.storage.get(t,this.sendUpdatedData)}})}sendUpdatedData(e,t,n){this.sendSetData(e,t,{data:n,callback:this.onRecordUpdated})}onRecordUpdated(e,t){e||this.dirtyService.setDirty(t,!1)}onMergeCompleted(e,t,n,r,i){this.sendSetData(t,r+1,{data:n})}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(1),i=n(0),o=n(69),s=n(2),a=n(3),c=n(25);t.RecordCore=class extends s{constructor(e,t,n,o,a){if(super(),this.services=t,this.options=n,this.recordServices=o,this.emitter=new s,this.data=Object.create(null),this.name=e,this.whenComplete=a,this.references=1,this.hasProvider=!1,this.pendingWrites=[],this.isReady=!1,this.version=null,this.responseTimeout=-1,this.discardTimeout=-1,this.deletedTimeout=-1,this.deleteResponse={},"string"!=typeof e||0===e.length)throw new Error("invalid argument name");this.stateMachine=new c.StateMachine(this.services.logger,{init:0,onStateChanged:(e,t)=>{this.emitter.emit(r.EVENT.RECORD_STATE_CHANGED,e)},transitions:[{name:i.RECORD_ACTIONS.SUBSCRIBE,from:0,to:1,handler:this.onSubscribing.bind(this)},{name:0,from:0,to:3,handler:this.onOfflineLoading.bind(this)},{name:1,from:3,to:4,handler:this.onReady.bind(this)},{name:i.RECORD_ACTIONS.READ_RESPONSE,from:1,to:4,handler:this.onReady.bind(this)},{name:2,from:2,to:4},{name:3,from:0,to:2,handler:this.onResubscribing.bind(this)},{name:3,from:4,to:2,handler:this.onResubscribing.bind(this)},{name:3,from:6,to:2,handler:this.onResubscribing.bind(this)},{name:4,from:2,to:4},{name:5,from:2,to:5},{name:i.RECORD_ACTIONS.DELETE,from:4,to:8},{name:i.RECORD_ACTIONS.DELETED,from:4,to:9,handler:this.onDeleted.bind(this)},{name:i.RECORD_ACTIONS.DELETE_SUCCESS,from:8,to:9,handler:this.onDeleted.bind(this)},{name:i.RECORD_ACTIONS.UNSUBSCRIBE,from:4,to:6},{name:i.RECORD_ACTIONS.SUBSCRIBE,from:6,to:4},{name:i.RECORD_ACTIONS.UNSUBSCRIBE_ACK,from:6,to:7,handler:this.onUnsubscribed.bind(this)},{name:5,from:4,to:5}]}),this.handleReadResponse=this.handleReadResponse.bind(this),this.onRecordRecovered=this.onRecordRecovered.bind(this),this.onConnectionReestablished=this.onConnectionReestablished.bind(this),this.onConnectionLost=this.onConnectionLost.bind(this),this.handleReadResponse=this.handleReadResponse.bind(this),this.recordServices.dirtyService.whenLoaded(()=>{this.services.connection.isConnected?this.recordServices.dirtyService.isDirty(this.name)?this.services.storage.get(this.name,(e,t,n)=>{this.version=t,this.data=n,this.stateMachine.transition(3)}):this.stateMachine.transition(i.RECORD_ACTIONS.SUBSCRIBE):this.stateMachine.transition(0),this.services.connection.onReestablished(this.onConnectionReestablished),this.services.connection.onLost(this.onConnectionLost)})}get recordState(){return this.stateMachine.state}set usages(e){this.references=e,1===this.references&&(this.services.timerRegistry.remove(this.discardTimeout),this.stateMachine.transition(i.RECORD_ACTIONS.SUBSCRIBE))}get usages(){return this.references}whenReady(e,t){return!0===this.isReady?t?void t(e):Promise.resolve(e):t?void this.once(r.EVENT.RECORD_READY,()=>t(e)):new Promise((t,n)=>{this.once(r.EVENT.RECORD_READY,()=>t(e))})}set({path:e,data:t,callback:n}){if(!e&&(null===t||"object"!=typeof t))throw new Error("invalid arguments, scalar values cannot be set without path");if(this.checkDestroyed("set"))return;if(!this.isReady)return void this.pendingWrites.push({path:e,data:t,callback:n});const i=this.data,s=o.setValue(i,e||null,t);i!==s?(this.applyChange(s),this.services.connection.isConnected?this.sendUpdate(e,t,n):(n&&n(r.EVENT.CLIENT_OFFLINE,this.name),this.saveUpdate())):n&&this.services.timerRegistry.requestIdleCallback(()=>n(null,this.name))}setWithAck(e){if(!e.callback)return new Promise((t,n)=>{e.callback=(e=>null===e?t():n(e)),this.set(e)});this.set(e)}get(e){return o.get(this.data,e||null,this.options.recordDeepCopy)}subscribe(e){if(void 0!==e.path&&("string"!=typeof e.path||0===e.path.length))throw new Error("invalid argument path");if("function"!=typeof e.callback)throw new Error("invalid argument callback");this.checkDestroyed("subscribe")||(e.triggerNow?this.whenReady(null,()=>{this.emitter.on(e.path||"",e.callback),e.callback(this.get(e.path))}):this.emitter.on(e.path||"",e.callback))}unsubscribe(e){if(void 0!==e.path&&("string"!=typeof e.path||0===e.path.length))throw new Error("invalid argument path");if(void 0!==e.callback&&"function"!=typeof e.callback)throw new Error("invalid argument callback");this.checkDestroyed("unsubscribe")||this.emitter.off(e.path||"",e.callback)}discard(){this.checkDestroyed("discard")||(this.whenReady(null,()=>{this.references--,this.references<=0&&(this.discardTimeout=this.services.timerRegistry.add({duration:this.options.discardTimeout,callback:this.stateMachine.transition,context:this.stateMachine,data:i.RECORD_ACTIONS.UNSUBSCRIBE_ACK}))}),this.stateMachine.transition(i.RECORD_ACTIONS.UNSUBSCRIBE))}delete(e){if(!this.services.connection.isConnected)return e?void this.services.timerRegistry.requestIdleCallback(()=>{e("Deleting while offline is not supported")}):Promise.reject("Deleting while offline is not supported");if(!this.checkDestroyed("delete")){if(this.stateMachine.transition(i.RECORD_ACTIONS.DELETE),!e||"function"!=typeof e)return new Promise((e,t)=>{this.deleteResponse={resolve:e,reject:t},this.sendDelete()});this.deleteResponse={callback:e},this.sendDelete()}}setMergeStrategy(e){this.recordServices.mergeStrategy.setMergeStrategyByName(this.name,e)}saveRecordToOffline(){this.services.storage.set(this.name,this.version,this.data,()=>{})}onSubscribing(){this.recordServices.readRegistry.register(this.name,this.handleReadResponse),this.services.timeoutRegistry.add({message:{topic:i.TOPIC.RECORD,action:i.RECORD_ACTIONS.SUBSCRIBE,name:this.name}}),this.responseTimeout=this.services.timeoutRegistry.add({message:{topic:i.TOPIC.RECORD,action:i.RECORD_ACTIONS.READ_RESPONSE,name:this.name}}),this.services.connection.sendMessage({topic:i.TOPIC.RECORD,action:i.RECORD_ACTIONS.SUBSCRIBECREATEANDREAD,name:this.name})}onResubscribing(){this.services.timerRegistry.remove(this.discardTimeout),this.recordServices.headRegistry.register(this.name,this.handleHeadResponse),this.services.timeoutRegistry.add({message:{topic:i.TOPIC.RECORD,action:i.RECORD_ACTIONS.SUBSCRIBE,name:this.name}}),this.responseTimeout=this.services.timeoutRegistry.add({message:{topic:i.TOPIC.RECORD,action:i.RECORD_ACTIONS.HEAD_RESPONSE,name:this.name}}),this.services.connection.sendMessage({topic:i.TOPIC.RECORD,action:i.RECORD_ACTIONS.SUBSCRIBEANDHEAD,name:this.name})}onOfflineLoading(){this.services.storage.get(this.name,(e,t,n)=>{-1===t?(this.data={},this.version=1,this.recordServices.dirtyService.setDirty(this.name,!0),this.services.storage.set(this.name,this.version,this.data,e=>{this.stateMachine.transition(1)})):(this.data=n,this.version=t,this.stateMachine.transition(1))})}onReady(){this.services.timeoutRegistry.clear(this.responseTimeout),this.applyPendingWrites(),this.isReady=!0,this.emit(r.EVENT.RECORD_READY)}applyPendingWrites(){const e=[],t=this.data;let n=t;for(let t=0;t<this.pendingWrites.length;t++){const{callback:r,path:i,data:s}=this.pendingWrites[t];r&&e.push(r),n=o.setValue(n,i||null,s)}this.pendingWrites=[],this.applyChange(n);const i=t=>{for(let n=0;n<e.length;n++)e[n](t,this.name)};a.deepEquals(t,n)?i(null):this.services.connection.isConnected?this.sendUpdate(null,n,i):(i(r.EVENT.CLIENT_OFFLINE),this.saveUpdate())}onUnsubscribed(){if(this.services.connection.isConnected){const e={topic:i.TOPIC.RECORD,action:i.RECORD_ACTIONS.UNSUBSCRIBE,name:this.name};this.discardTimeout=this.services.timeoutRegistry.add({message:e}),this.services.connection.sendMessage(e)}this.emit(r.EVENT.RECORD_DISCARDED),this.destroy()}onDeleted(){this.emit(r.EVENT.RECORD_DELETED),this.destroy()}handle(e){if(e.isAck)this.services.timeoutRegistry.remove(e);else if(e.action!==i.RECORD_ACTIONS.PATCH&&e.action!==i.RECORD_ACTIONS.UPDATE&&e.action!==i.RECORD_ACTIONS.ERASE){if(e.action===i.RECORD_ACTIONS.DELETE_SUCCESS)return this.services.timeoutRegistry.clear(this.deletedTimeout),this.stateMachine.transition(e.action),void(this.deleteResponse.callback?this.deleteResponse.callback(null):this.deleteResponse.resolve&&this.deleteResponse.resolve());if(e.action!==i.RECORD_ACTIONS.DELETED){if(e.action!==i.RECORD_ACTIONS.VERSION_EXISTS){if(e.action===i.RECORD_ACTIONS.MESSAGE_DENIED||e.action===i.RECORD_ACTIONS.MESSAGE_PERMISSION_ERROR){if(e.originalAction===i.RECORD_ACTIONS.SUBSCRIBECREATEANDREAD||e.originalAction===i.RECORD_ACTIONS.SUBSCRIBEANDHEAD||e.originalAction===i.RECORD_ACTIONS.SUBSCRIBEANDREAD){const t=Object.assign({},e,{originalAction:i.RECORD_ACTIONS.SUBSCRIBE}),n=Object.assign({},e,{originalAction:e.originalAction===i.RECORD_ACTIONS.SUBSCRIBECREATEANDREAD?i.RECORD_ACTIONS.READ_RESPONSE:i.RECORD_ACTIONS.HEAD_RESPONSE});this.services.timeoutRegistry.remove(t),this.services.timeoutRegistry.remove(n)}return this.emit(r.EVENT.RECORD_ERROR,i.RECORD_ACTIONS[i.RECORD_ACTIONS.MESSAGE_DENIED],i.RECORD_ACTIONS[e.originalAction]),void(e.originalAction===i.RECORD_ACTIONS.DELETE&&(this.deleteResponse.callback?this.deleteResponse.callback(i.RECORD_ACTIONS[i.RECORD_ACTIONS.MESSAGE_DENIED]):this.deleteResponse.reject&&this.deleteResponse.reject(i.RECORD_ACTIONS[i.RECORD_ACTIONS.MESSAGE_DENIED])))}return e.action===i.RECORD_ACTIONS.SUBSCRIPTION_HAS_PROVIDER||e.action===i.RECORD_ACTIONS.SUBSCRIPTION_HAS_NO_PROVIDER?(this.hasProvider=e.action===i.RECORD_ACTIONS.SUBSCRIPTION_HAS_PROVIDER,void this.emit(r.EVENT.RECORD_HAS_PROVIDER_CHANGED,this.hasProvider)):void 0}}else this.stateMachine.transition(e.action)}else this.applyUpdate(e)}handleReadResponse(e){if(5===this.stateMachine.state)return this.recoverRecord(e.version,e.parsedData,e),void this.recordServices.dirtyService.setDirty(this.name,!1);this.version=e.version,this.applyChange(o.setValue(this.data,null,e.parsedData)),this.stateMachine.transition(i.RECORD_ACTIONS.READ_RESPONSE)}handleHeadResponse(e){const t=e.version;this.recordServices.dirtyService.isDirty(this.name)?-1===t&&1===this.version?(this.stateMachine.transition(2),this.sendCreateUpdate(this.data)):this.version===t+1?(this.sendUpdate(null,this.data),this.stateMachine.transition(4)):(this.stateMachine.transition(5),this.sendRead(),this.recordServices.readRegistry.register(this.name,this.handleReadResponse)):t<this.version||(this.version===t?this.stateMachine.transition(4):(this.stateMachine.transition(5),this.sendRead(),this.recordServices.readRegistry.register(this.name,this.handleReadResponse)))}sendRead(){this.services.connection.sendMessage({topic:i.TOPIC.RECORD,action:i.RECORD_ACTIONS.READ,name:this.name})}saveUpdate(){this.recordServices.dirtyService.isDirty(this.name)||(this.version++,this.recordServices.dirtyService.setDirty(this.name,!0)),this.saveRecordToOffline()}sendUpdate(e=null,t,n){this.recordServices.dirtyService.isDirty(this.name)?this.recordServices.dirtyService.setDirty(this.name,!1):this.version++;const r={topic:i.TOPIC.RECORD,version:this.version,name:this.name};e?void 0===t?Object.assign(r,{action:i.RECORD_ACTIONS.ERASE,path:e}):Object.assign(r,{action:i.RECORD_ACTIONS.PATCH,path:e,parsedData:t}):Object.assign(r,{action:i.RECORD_ACTIONS.UPDATE,parsedData:t}),n?this.recordServices.writeAckService.send(r,n):this.services.connection.sendMessage(r)}sendCreateUpdate(e){this.services.connection.sendMessage({name:this.name,topic:i.TOPIC.RECORD,action:i.RECORD_ACTIONS.CREATEANDUPDATE,version:1,parsedData:e}),this.recordServices.dirtyService.setDirty(this.name,!1)}applyUpdate(e){const t=e.version,n=e.parsedData;if(null===this.version)this.version=t;else if(this.version+1!==t)return this.stateMachine.transition(5),void(e.action===i.RECORD_ACTIONS.PATCH?this.sendRead():this.recoverRecord(e.version,e.parsedData,e));let r;this.version=t,r=e.action===i.RECORD_ACTIONS.PATCH?o.setValue(this.data,e.path,n):e.action===i.RECORD_ACTIONS.ERASE?o.setValue(this.data,e.path,void 0):o.setValue(this.data,null,n),this.applyChange(r)}applyChange(e){if(this.stateMachine.inEndState)return;const t=this.data;this.data=e;const n=this.emitter.eventNames();for(let r=0;r<n.length;r++)o.get(e,n[r],!1)!==o.get(t,n[r],!1)&&this.emitter.emit(n[r],this.get(n[r]))}sendDelete(){this.whenReady(null,()=>{if(this.services.connection.isConnected){const e={topic:i.TOPIC.RECORD,action:i.RECORD_ACTIONS.DELETE,name:this.name};this.deletedTimeout=this.services.timeoutRegistry.add({message:e,event:r.EVENT.RECORD_DELETE_TIMEOUT,duration:this.options.recordDeleteTimeout}),this.services.connection.sendMessage(e)}else this.services.storage.delete(this.name,()=>{this.services.timerRegistry.requestIdleCallback(()=>{this.stateMachine.transition(i.RECORD_ACTIONS.DELETE_SUCCESS)})})})}recoverRecord(e,t,n){this.recordServices.mergeStrategy.merge(this.name,this.version,this.get(),e,t,this.onRecordRecovered)}onRecordRecovered(e,t,n,s){e&&this.services.logger.error({topic:i.TOPIC.RECORD},r.EVENT.RECORD_VERSION_EXISTS),this.version=n;const c=this.data;if(a.deepEquals(c,s))return;const u=o.setValue(c,null,t);a.deepEquals(t,s)&&this.applyChange(t),this.applyChange(u)}checkDestroyed(e){return!!this.stateMachine.inEndState&&(this.services.logger.error({topic:i.TOPIC.RECORD},r.EVENT.RECORD_ALREADY_DESTROYED,{methodName:e}),!0)}destroy(){this.services.timerRegistry.remove(this.deletedTimeout),this.services.timerRegistry.remove(this.discardTimeout),this.services.timerRegistry.remove(this.responseTimeout),this.services.connection.removeOnReestablished(this.onConnectionReestablished),this.services.connection.removeOnLost(this.onConnectionLost),this.emitter.off(),this.isReady=!1,this.whenComplete(this.name)}onConnectionReestablished(){this.stateMachine.transition(3)}onConnectionLost(){this.saveRecordToOffline()}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(3),i=/[[\]]/g;function o(e){if(null===e)return[];const t=[],n=e.split(".");for(let e=0;e<n.length;e++){const r=n[e].trim();if(0===r.length)continue;const o=r.split(i);if(0!==o.length){t.push(o[0]);for(let e=1;e<o.length;e++)0!==o[e].length&&t.push(Number(o[e]))}}return t}t.get=function(e,t,n){const i=o(t);let s=e;for(let e=0;e<i.length;e++){if(void 0===s)return;if("object"!=typeof s)throw new Error("invalid data or path");s=s[i[e]]}return!1!==n?r.deepCopy(s):s},t.setValue=function(e,t,n){if(null===t)return n;const i=o(t),s=r.deepCopy(e),a=r.deepCopy(n);let c,u=s;for(c=0;c<i.length-1;c++){const e=i[c];if(void 0!==u[e]&&null!==u[e]&&"object"==typeof u[e])u=u[e];else if("number"==typeof i[c+1]){const t=new Array(i[c+1]);t.fill(null),u=u[e]=t}else u=u[e]={}}return void 0===n?delete u[i[c]]:u[i[c]]=a,s}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(3),i=n(1),o=n(2);t.Record=class extends o{constructor(e){super(),this.record=e,this.subscriptions=[],this.record.on(i.EVENT.RECORD_READY,this.emit.bind(this,i.EVENT.RECORD_READY,this)),this.record.on(i.EVENT.RECORD_DISCARDED,this.emit.bind(this,i.EVENT.RECORD_DISCARDED)),this.record.on(i.EVENT.RECORD_DELETED,this.emit.bind(this,i.EVENT.RECORD_DELETED)),this.record.on(i.EVENT.RECORD_ERROR,this.emit.bind(this,i.EVENT.RECORD_ERROR))}get name(){return this.record.name}get isReady(){return this.record.isReady}get version(){return this.record.version}get hasProvider(){return this.record.hasProvider}whenReady(e){return this.record.whenReady(this,e)}get(e){return this.record.get(e)}set(e,t,n){return this.record.set(r.normalizeSetArguments(arguments))}setWithAck(e,t,n){return this.record.setWithAck(r.normalizeSetArguments(arguments))}erase(e){if(!e)throw new Error("unable to erase record data without path, consider using `delete`");this.set(e,void 0)}eraseWithAck(e,t){if(!e)throw new Error("unable to erase record data without path, consider using `delete`");if(!t)return this.setWithAck(e,void 0);this.setWithAck(e,void 0,t)}subscribe(e,t,n){const i=r.normalizeArguments(arguments);this.subscriptions.push(i),this.record.subscribe(i)}unsubscribe(e,t){const n=r.normalizeArguments(arguments);this.subscriptions=this.subscriptions.filter(e=>e.path!==n.path||e.callback!==n.callback),this.record.unsubscribe(n)}discard(){for(let e=0;e<this.subscriptions.length;e++)this.record.unsubscribe(this.subscriptions[e]);return this.record.discard()}delete(e){return this.record.delete(e)}setMergeStrategy(e){this.record.setMergeStrategy(e)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(3),i=n(2);t.AnonymousRecord=class extends i{constructor(e){super(),this.record=null,this.subscriptions=[],this.getRecordCore=e}get name(){return this.record?this.record.name:""}get isReady(){return!!this.record&&this.record.isReady}get version(){return this.record?this.record.version:-1}whenReady(e){if(this.record)return this.record.whenReady(this,e)}setName(e,t){if(this.name!==e){this.discard(),this.record=this.getRecordCore(e);for(let e=0;e<this.subscriptions.length;e++)this.record.subscribe(this.subscriptions[e]);return this.emit("nameChanged",e),this.record.whenReady(this,t)}}get(e){if(this.record)return this.record.get(e)}set(e,t,n){if(this.record)return this.record.set(r.normalizeSetArguments(arguments))}setWithAck(e,t,n){if(this.record)return this.record.setWithAck(r.normalizeSetArguments(arguments))}erase(e){if(this.record)return this.record.set(r.normalizeSetArguments(arguments))}eraseWithAck(e,t){if(this.record)return this.record.setWithAck(r.normalizeSetArguments(arguments))}subscribe(e,t,n){const i=r.normalizeArguments(arguments);this.subscriptions.push(i),this.record&&this.record.subscribe(i)}unsubscribe(e,t){const n=r.normalizeArguments(arguments);this.subscriptions=this.subscriptions.filter(e=>e.path!==n.path||e.callback!==n.callback),this.record&&this.record.unsubscribe(n)}discard(){if(this.record){for(let e=0;e<this.subscriptions.length;e++)this.record.unsubscribe(this.subscriptions[e]);return this.record.discard()}}delete(e){if(this.record)return this.record.delete(e)}setMergeStrategy(e){this.record&&this.record.setMergeStrategy(e)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(3),i=n(1),o=n(2);t.List=class extends o{constructor(e){super(),this.record=e,this.originalApplyUpdate=this.record.applyUpdate.bind(this.record),this.record.applyUpdate=this.applyUpdate.bind(this),this.wrappedFunctions=new Map,this.hasAddListener=!1,this.hasRemoveListener=!1,this.hasMoveListener=!1}get name(){return this.record.name}get isReady(){return this.record.isReady}get version(){return this.record.version}whenReady(e){return this.record.whenReady(this,e)}getEntries(){const e=this.record.get();return e instanceof Array?e:[]}isEmpty(){return 0===this.getEntries().length}setEntriesWithAck(e,t){if(!t)return new Promise((t,n)=>{this.setEntries(e,e=>{e?n(e):t()})});this.setEntries(e,t)}setEntries(e,t){const n="entries must be an array of record names";let r;if(!(e instanceof Array))throw new Error(n);for(r=0;r<e.length;r++)if("string"!=typeof e[r])throw new Error(n);!1===this.record.isReady||(this.beforeChange(),this.record.set({data:e,callback:t}),this.afterChange())}removeEntry(e,t,n){if(!1===this.record.isReady)return;const r=this.record.get(),i=this.hasIndex(t),o=[];let s;for(s=0;s<r.length;s++)(r[s]!==e||i&&t!==s)&&o.push(r[s]);this.beforeChange(),this.record.set({data:o,callback:n}),this.afterChange()}addEntry(e,t,n){if("string"!=typeof e)throw new Error("Entry must be a recordName");if(!1===this.record.isReady)return;const r=this.hasIndex(t),i=this.getEntries();r?i.splice(t,0,e):i.push(e),this.beforeChange(),this.record.set({data:i,callback:n}),this.afterChange()}subscribe(e){const t=r.normalizeArguments(arguments);if(t.path)throw new Error("path is not supported for List.subscribe");const n=function(e,t){t(e.getEntries())}.bind(this,this,t.callback);this.wrappedFunctions.set(t.callback,n),t.callback=n,this.record.subscribe(t)}unsubscribe(e){const t=r.normalizeArguments(arguments);if(t.path)throw new Error("path is not supported for List.unsubscribe");const n=this.wrappedFunctions.get(t.callback);t.callback=n,this.record.unsubscribe(t),this.wrappedFunctions.delete(t.callback)}applyUpdate(e){e.parsedData instanceof Array||(e.parsedData=[]),this.beforeChange(),this.originalApplyUpdate(e),this.afterChange()}hasIndex(e){let t=!1;const n=this.getEntries();if(void 0!==e){if(isNaN(e))throw new Error("Index must be a number");if(e!==n.length&&(e>=n.length||e<0))throw new Error("Index must be within current entries");t=!0}return t}beforeChange(){this.hasAddListener=this.listeners(i.EVENT.ENTRY_ADDED_EVENT).length>0,this.hasRemoveListener=this.listeners(i.EVENT.ENTRY_REMOVED_EVENT).length>0,this.hasMoveListener=this.listeners(i.EVENT.ENTRY_MOVED_EVENT).length>0,this.hasAddListener||this.hasRemoveListener||this.hasMoveListener?this.beforeStructure=this.getStructure():this.beforeStructure=null}afterChange(){if(null===this.beforeStructure)return;const e=this.getStructure(),t=this.beforeStructure;let n,r;if(this.hasRemoveListener)for(n in t)for(r=0;r<t[n].length;r++)void 0!==e[n]&&void 0!==e[n][r]||this.emit(i.EVENT.ENTRY_REMOVED_EVENT,n,t[n][r]);if(this.hasAddListener||this.hasMoveListener)for(n in e)if(void 0===t[n])for(r=0;r<e[n].length;r++)this.emit(i.EVENT.ENTRY_ADDED_EVENT,n,e[n][r]);else for(r=0;r<e[n].length;r++)t[n][r]!==e[n][r]&&(void 0===t[n][r]?this.emit(i.EVENT.ENTRY_ADDED_EVENT,n,e[n][r]):this.emit(i.EVENT.ENTRY_MOVED_EVENT,n,e[n][r]))}getStructure(){const e={};let t;const n=this.record.get();for(t=0;t<n.length;t++)void 0===e[n[t]]?e[n[t]]=[t]:e[n[t]].push(t);return e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0),i=n(1);t.SingleNotifier=class{constructor(e,t,n){this.services=e,this.action=t,this.requests=new Map,this.internalRequests=new Map,this.limboQueue=[],this.services.connection.onLost(this.onConnectionLost.bind(this)),this.services.connection.onExitLimbo(this.onExitLimbo.bind(this)),this.services.connection.onReestablished(this.onConnectionReestablished.bind(this))}request(e,t){const n={topic:r.TOPIC.RECORD,action:this.action,name:e},o=this.requests.get(e);o?o.push(t):(this.requests.set(e,[t]),this.services.connection.isConnected?(this.services.connection.sendMessage(n),this.services.timeoutRegistry.add({message:n})):this.services.connection.isInLimbo?this.limboQueue.push(n):t(i.EVENT.CLIENT_OFFLINE))}register(e,t){const n=this.internalRequests.get(e);n?n.push(t):this.internalRequests.set(e,[t])}recieve(e,t,n){this.services.timeoutRegistry.remove(e);const r=e.name,i=this.requests.get(r)||[],o=this.internalRequests.get(r)||[];if(i||o){for(let t=0;t<o.length;t++)o[t](e);this.internalRequests.delete(r);for(let e=0;e<i.length;e++)i[e](t,n);this.requests.delete(r)}}onConnectionLost(){this.requests.forEach(e=>{e.forEach(e=>e(i.EVENT.CLIENT_OFFLINE))}),this.requests.clear()}onExitLimbo(){for(let e=0;e<this.limboQueue.length;e++){const t=this.limboQueue[e],n=this.requests.get(t.name);n&&n.forEach(e=>e(i.EVENT.CLIENT_OFFLINE))}this.requests.clear(),this.limboQueue=[]}onConnectionReestablished(){for(let e=0;e<this.limboQueue.length;e++){const t=this.limboQueue[e];this.services.connection.sendMessage(t),this.services.timeoutRegistry.add({message:t})}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0),i=n(9),o=n(1);t.WriteAcknowledgementService=class{constructor(e){this.services=e,this.responses=new Map,this.count=1,this.services.connection.onLost(this.onConnectionLost.bind(this))}send(e,t){if(!1===this.services.connection.isConnected)return void this.services.timerRegistry.requestIdleCallback(t.bind(this,o.EVENT.CLIENT_OFFLINE));const n=this.count.toString();this.responses.set(n,t),this.services.connection.sendMessage(Object.assign({},e,{correlationId:n,action:i.ACTION_TO_WRITE_ACK[e.action]})),this.count++}recieve(e){const t=e.correlationId,n=this.responses.get(t);n&&(e.action===r.RECORD_ACTIONS.WRITE_ACKNOWLEDGEMENT||e.isError)&&(e.isError?n(r.RECORD_ACTIONS[e.action]):n(null),this.responses.delete(t))}onConnectionLost(){this.responses.forEach(e=>e(o.EVENT.CLIENT_OFFLINE)),this.responses.clear()}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(2),i="dirty-service-loaded";t.DirtyService=class{constructor(e,t){this.storage=e,this.name=t,this.loaded=!1,this.emitter=new r,this.dirtyRecords={},this.load()}isDirty(e){return!!this.dirtyRecords[e]}setDirty(e,t){this.updateDirtyRecords(e,t)}whenLoaded(e){this.loaded?e():this.emitter.once(i,()=>{e()})}getAll(){return this.dirtyRecords}load(){this.loaded||this.storage.get(this.name,(e,t,n)=>{this.dirtyRecords=-1!==t?n:{},this.loaded=!0,this.emitter.emit(i)})}updateDirtyRecords(e,t){t?this.dirtyRecords[e]=!0:delete this.dirtyRecords[e],this.storage.set(this.name,1,this.dirtyRecords,()=>{})}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(1),i=n(0);t.MergeStrategyService=class{constructor(e,t){this.services=e,this.defaultStrategy=t,this.strategiesByRecord=new Map,this.strategiesByPattern=new Map}setMergeStrategyByName(e,t){this.strategiesByRecord.set(e,t)}setMergeStrategyByPattern(e,t){this.strategiesByPattern.set(e,t)}merge(e,t,n,o,s,a){const c=this.strategiesByRecord.get(e);if(c)c(n,t,s,o,(r,i)=>{a(r,e,i,o,s,t,n)});else{for(const[r,i]of this.strategiesByPattern)if(r.test(e))return void i(n,t,s,o,(r,i)=>{a(r,e,i,o,s,t,n)});this.defaultStrategy&&this.defaultStrategy(n,t,s,o,(r,i)=>{a(r,e,i,o,s,t,n)}),this.services.logger.error({topic:i.TOPIC.RECORD},r.EVENT.RECORD_VERSION_EXISTS,{remoteVersion:o,recordName:e})}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Storage=class{constructor(e){if("undefined"==typeof localStorage||null===localStorage){const t=n(78).LocalStorage;this.storage=new t(e.nodeStoragePath,1024*e.nodeStorageSize*1024)}else this.storage=window.localStorage}get(e,t){const n=this.storage.getItem(e);if(n){const r=JSON.parse(n);setTimeout(t.bind(this,e,r.version,r.data),0)}else setTimeout(t.bind(this,e,-1,null),0)}set(e,t,n,r){this.storage.setItem(e,JSON.stringify({recordName:e,version:t,data:n})),setTimeout(r,0)}delete(e,t){this.storage.removeItem(e),setTimeout(t,0)}}},function(e,t,n){(function(e){(function(){var r,i,o,s,a,c,u,h,l,E,f,d,p,S=function(e,t){for(var n in t)T.call(t,n)&&(e[n]=t[n]);function r(){this.constructor=e}return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},T={}.hasOwnProperty;d=n(21),f=n(14),E=n(11),p=n(79).sync,c=function(e){var t,n,r,i,o;for(o=[],t=0,n=(i=f.readdirSync(e)).length;t<n;t++)r=i[t],o.push(h(d.join(e,r)));return o},h=function(e){return f.statSync(e).isDirectory()?(c(e),f.rmdirSync(e)):f.unlinkSync(e)},u=function(e){return""===e?"---.EMPTY_STRING.---":e.toString()},s=function(e){function t(e){this.message=null!=e?e:"Unknown error.",null!=Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),this.name=this.constructor.name}return S(t,e),t.prototype.toString=function(){return this.name+": "+this.message},t}(Error),a=function(){return function(e,t,n,r,i){this.key=e,this.oldValue=t,this.newValue=n,this.url=r,this.storageArea=null!=i?i:"localStorage"}}(),o=function(){return function e(t,n){if(this.key=t,this.index=n,!(this instanceof e))return new e(this.key,this.index)}}(),l=function(){var e;return(e=function(){}).prototype=Object.create(null),new e},i=function(t){var n;function r(t,i){return this._location=t,this.quota=null!=i?i:5242880,this instanceof r?(this._location=d.resolve(this._location),null!=n[this._location]?n[this._location]:(this.length=0,this._bytesInUse=0,this._keys=[],this._metaKeyMap=l(),this._eventUrl="pid:"+e.pid,this._init(),this._QUOTA_EXCEEDED_ERR=s,n[this._location]=this,n[this._location])):new r(this._location,this.quota)}return S(r,t),n={},r.prototype._init=function(){var e,t,n,r,i,s,a,c,u,h,l;try{if(null!=(l=f.statSync(this._location))&&!l.isDirectory())throw new Error("A file exists at the location '"+this._location+"' when trying to create/open localStorage");for(this._bytesInUse=0,this.length=0,n=f.readdirSync(this._location),c=a=0,h=n.length;a<h;c=++a)u=n[c],t=decodeURIComponent(u),this._keys.push(t),e=new o(u,c),this._metaKeyMap[t]=e,null!=(null!=(l=this._getStat(u))?l.size:void 0)&&(e.size=l.size,this._bytesInUse+=l.size);this.length=n.length}catch(i){if("ENOENT"!==(r=i).code)throw r;try{f.mkdirSync(this._location)}catch(s){if("EEXIST"!==(r=s).code)throw r}}},r.prototype.setItem=function(e,t){var n,r,i,c,h,l,f,S,T,_;if(S=null,(h=E.EventEmitter.listenerCount(this,"storage"))&&(S=this.getItem(e)),e=u(e),n=encodeURIComponent(e),c=d.join(this._location,n),_=(T=t.toString()).length,f=(i=!!(l=this._metaKeyMap[e]))?l.size:0,this._bytesInUse-f+_>this.quota)throw new s;if(p(c,T,"utf8"),i||((l=new o(n,this._keys.push(e)-1)).size=_,this._metaKeyMap[e]=l,this.length+=1,this._bytesInUse+=_),h)return r=new a(e,S,t,this._eventUrl),this.emit("storage",r)},r.prototype.getItem=function(e){var t,n;return e=u(e),(n=this._metaKeyMap[e])?(t=d.join(this._location,n.key),f.readFileSync(t,"utf8")):null},r.prototype._getStat=function(e){var t;e=u(e),t=d.join(this._location,encodeURIComponent(e));try{return f.statSync(t)}catch(e){return null}},r.prototype.removeItem=function(e){var t,n,r,i,o,s,c,l;if(e=u(e),s=this._metaKeyMap[e]){for(i in c=null,(r=E.EventEmitter.listenerCount(this,"storage"))&&(c=this.getItem(e)),delete this._metaKeyMap[e],this.length-=1,this._bytesInUse-=s.size,n=d.join(this._location,s.key),this._keys.splice(s.index,1),l=this._metaKeyMap)l[i],(o=this._metaKeyMap[i]).index>s.index&&(o.index-=1);if(h(n),r)return t=new a(e,c,null,this._eventUrl),this.emit("storage",t)}},r.prototype.key=function(e){return this._keys[e]},r.prototype.clear=function(){var e;if(c(this._location),this._metaKeyMap=l(),this._keys=[],this.length=0,this._bytesInUse=0,E.EventEmitter.listenerCount(this,"storage"))return e=new a(null,null,null,this._eventUrl),this.emit("storage",e)},r.prototype._getBytesInUse=function(){return this._bytesInUse},r.prototype._deleteLocation=function(){return delete n[this._location],h(this._location),this._metaKeyMap={},this._keys=[],this.length=0,this._bytesInUse=0},r}(E.EventEmitter),r=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return S(t,i),t.prototype.setItem=function(e,n){var r;return r=JSON.stringify(n),t.__super__.setItem.call(this,e,r)},t.prototype.getItem=function(e){return JSON.parse(t.__super__.getItem.call(this,e))},t}(),t.LocalStorage=i,t.JSONStorage=r,t.QUOTA_EXCEEDED_ERR=s}).call(this)}).call(this,n(!function(){var e=new Error("Cannot find module './../process/browser.js'");throw e.code="MODULE_NOT_FOUND",e}()))},function(e,t,n){"use strict";(function(t,r,i){e.exports=function(e,t,n,a){n instanceof Function&&(a=n,n=null);n||(n={});o.realpath(e,function(u,l){!function(e,t,n,a){var u=h(e);return n.mode&&n.chown?l():o.stat(e,function(e,t){return e||!t?l():((n=c({},n)).mode||(n.mode=t.mode),!n.chown&&r.getuid&&(n.chown={uid:t.uid,gid:t.gid}),l())});function l(){s([[E,u,t,n.mode,n.encoding||"utf8"],n.chown&&[o,o.chown,u,n.chown.uid,n.chown.gid],n.mode&&[o,o.chmod,u,n.mode],[o,o.rename,u,e]],function(e){e?o.unlink(u,function(){a(e)}):a()})}function E(e,t,r,s,a){o.open(e,"w",n.mode,function(e,n){return e?a(e):i.isBuffer(t)?o.write(n,t,0,t.length,0,r):null!=t?o.write(n,String(t),0,String(s),r):r();function r(e){if(e)return a(e);o.fsync(n,function(e){if(e)return a(e);o.close(n,a)})}})}}(l||e,t,n,a)})},e.exports.sync=function(e,t,n){n||(n={});try{e=o.realpathSync(e)}catch(e){}var s=h(e);try{if(!n.mode||!n.chown)try{var a=o.statSync(e);(n=c({},n)).mode||(n.mode=a.mode),!n.chown&&r.getuid&&(n.chown={uid:a.uid,gid:a.gid})}catch(e){}var u=o.openSync(s,"w",n.mode);i.isBuffer(t)?o.writeSync(u,t,0,t.length,0):null!=t&&o.writeSync(u,String(t),0,String(n.encoding||"utf8")),o.fsyncSync(u),o.closeSync(u),n.chown&&o.chownSync(s,n.chown.uid,n.chown.gid),n.mode&&o.chmodSync(s,n.mode),o.renameSync(s,e)}catch(e){try{o.unlinkSync(s)}catch(e){}throw e}},e.exports._getTmpname=h;var o=n(80),s=n(98).chain,a=n(101),c=Object.assign||n(17)._extend,u=0;function h(e){return e+"."+a(t).hash(String(r.pid)).hash(String(++u)).result()}}).call(this,"/index.js",n(!function(){var e=new Error("Cannot find module './../process/browser.js'");throw e.code="MODULE_NOT_FOUND",e}()),n(4).Buffer)},function(e,t,n){(function(t){var r=n(14),i=n(81),o=n(83),s=n(95),a=[],c=n(17);var u,h,l=function(){};function E(e){i(e),e.gracefulify=E,e.FileReadStream=p,e.FileWriteStream=S,e.createReadStream=function(e,t){return new p(e,t)},e.createWriteStream=function(e,t){return new S(e,t)};var n=e.readFile;e.readFile=function(e,t,r){"function"==typeof t&&(r=t,t=null);return function e(t,r,i){return n(t,r,function(n){!n||"EMFILE"!==n.code&&"ENFILE"!==n.code?("function"==typeof i&&i.apply(this,arguments),d()):f([e,[t,r,i]])})}(e,t,r)};var r=e.writeFile;e.writeFile=function(e,t,n,i){"function"==typeof n&&(i=n,n=null);return function e(t,n,i,o){return r(t,n,i,function(r){!r||"EMFILE"!==r.code&&"ENFILE"!==r.code?("function"==typeof o&&o.apply(this,arguments),d()):f([e,[t,n,i,o]])})}(e,t,n,i)};var s=e.appendFile;s&&(e.appendFile=function(e,t,n,r){"function"==typeof n&&(r=n,n=null);return function e(t,n,r,i){return s(t,n,r,function(o){!o||"EMFILE"!==o.code&&"ENFILE"!==o.code?("function"==typeof i&&i.apply(this,arguments),d()):f([e,[t,n,r,i]])})}(e,t,n,r)});var a=e.readdir;function c(t){return a.apply(e,t)}if(e.readdir=function(e,t,n){var r=[e];"function"!=typeof t?r.push(t):n=t;return r.push(function(e,t){t&&t.sort&&t.sort(),!e||"EMFILE"!==e.code&&"ENFILE"!==e.code?("function"==typeof n&&n.apply(this,arguments),d()):f([c,[r]])}),c(r)},"v0.8"===t.version.substr(0,4)){var u=o(e);p=u.ReadStream,S=u.WriteStream}var h=e.ReadStream;h&&(p.prototype=Object.create(h.prototype),p.prototype.open=function(){var e=this;_(e.path,e.flags,e.mode,function(t,n){t?(e.autoClose&&e.destroy(),e.emit("error",t)):(e.fd=n,e.emit("open",n),e.read())})});var l=e.WriteStream;function p(e,t){return this instanceof p?(h.apply(this,arguments),this):p.apply(Object.create(p.prototype),arguments)}function S(e,t){return this instanceof S?(l.apply(this,arguments),this):S.apply(Object.create(S.prototype),arguments)}l&&(S.prototype=Object.create(l.prototype),S.prototype.open=function(){var e=this;_(e.path,e.flags,e.mode,function(t,n){t?(e.destroy(),e.emit("error",t)):(e.fd=n,e.emit("open",n))})}),e.ReadStream=p,e.WriteStream=S;var T=e.open;function _(e,t,n,r){return"function"==typeof n&&(r=n,n=null),function e(t,n,r,i){return T(t,n,r,function(o,s){!o||"EMFILE"!==o.code&&"ENFILE"!==o.code?("function"==typeof i&&i.apply(this,arguments),d()):f([e,[t,n,r,i]])})}(e,t,n,r)}return e.open=_,e}function f(e){l("ENQUEUE",e[0].name,e[1]),a.push(e)}function d(){var e=a.shift();e&&(l("RETRY",e[0].name,e[1]),e[0].apply(null,e[1]))}c.debuglog?l=c.debuglog("gfs4"):/\bgfs4\b/i.test(t.env.NODE_DEBUG||"")&&(l=function(){var e=c.format.apply(c,arguments);e="GFS4: "+e.split(/\n/).join("\nGFS4: "),console.error(e)}),/\bgfs4\b/i.test(t.env.NODE_DEBUG||"")&&t.on("exit",function(){l(a),n(97).equal(a.length,0)}),e.exports=E(s(r)),t.env.TEST_GRACEFUL_FS_GLOBAL_PATCH&&!r.__patched&&(e.exports=E(r),r.__patched=!0),e.exports.close=(u=r.close,function(e,t){return u.call(r,e,function(e){e||d(),"function"==typeof t&&t.apply(this,arguments)})}),e.exports.closeSync=(h=r.closeSync,function(e){var t=h.apply(r,arguments);return d(),t}),/\bgraceful-fs\b/.test(r.closeSync.toString())||(r.closeSync=e.exports.closeSync,r.close=e.exports.close)}).call(this,n(!function(){var e=new Error("Cannot find module './../process/browser.js'");throw e.code="MODULE_NOT_FOUND",e}()))},function(e,t,n){(function(t){var r=n(82),i=t.cwd,o=null,s=t.env.GRACEFUL_FS_PLATFORM||t.platform;t.cwd=function(){return o||(o=i.call(t)),o};try{t.cwd()}catch(e){}var a=t.chdir;t.chdir=function(e){o=null,a.call(t,e)},e.exports=function(e){r.hasOwnProperty("O_SYMLINK")&&t.version.match(/^v0\.6\.[0-2]|^v0\.5\./)&&function(e){e.lchmod=function(t,n,i){e.open(t,r.O_WRONLY|r.O_SYMLINK,n,function(t,r){t?i&&i(t):e.fchmod(r,n,function(t){e.close(r,function(e){i&&i(t||e)})})})},e.lchmodSync=function(t,n){var i,o=e.openSync(t,r.O_WRONLY|r.O_SYMLINK,n),s=!0;try{i=e.fchmodSync(o,n),s=!1}finally{if(s)try{e.closeSync(o)}catch(e){}else e.closeSync(o)}return i}}(e);e.lutimes||function(e){r.hasOwnProperty("O_SYMLINK")?(e.lutimes=function(t,n,i,o){e.open(t,r.O_SYMLINK,function(t,r){t?o&&o(t):e.futimes(r,n,i,function(t){e.close(r,function(e){o&&o(t||e)})})})},e.lutimesSync=function(t,n,i){var o,s=e.openSync(t,r.O_SYMLINK),a=!0;try{o=e.futimesSync(s,n,i),a=!1}finally{if(a)try{e.closeSync(s)}catch(e){}else e.closeSync(s)}return o}):(e.lutimes=function(e,n,r,i){i&&t.nextTick(i)},e.lutimesSync=function(){})}(e);e.chown=a(e.chown),e.fchown=a(e.fchown),e.lchown=a(e.lchown),e.chmod=i(e.chmod),e.fchmod=i(e.fchmod),e.lchmod=i(e.lchmod),e.chownSync=c(e.chownSync),e.fchownSync=c(e.fchownSync),e.lchownSync=c(e.lchownSync),e.chmodSync=o(e.chmodSync),e.fchmodSync=o(e.fchmodSync),e.lchmodSync=o(e.lchmodSync),e.stat=u(e.stat),e.fstat=u(e.fstat),e.lstat=u(e.lstat),e.statSync=h(e.statSync),e.fstatSync=h(e.fstatSync),e.lstatSync=h(e.lstatSync),e.lchmod||(e.lchmod=function(e,n,r){r&&t.nextTick(r)},e.lchmodSync=function(){});e.lchown||(e.lchown=function(e,n,r,i){i&&t.nextTick(i)},e.lchownSync=function(){});"win32"===s&&(e.rename=(n=e.rename,function(t,r,i){var o=Date.now(),s=0;n(t,r,function a(c){if(c&&("EACCES"===c.code||"EPERM"===c.code)&&Date.now()-o<6e4)return setTimeout(function(){e.stat(r,function(e,o){e&&"ENOENT"===e.code?n(t,r,a):i(c)})},s),void(s<100&&(s+=10));i&&i(c)})}));var n;function i(t){return t?function(n,r,i){return t.call(e,n,r,function(e){l(e)&&(e=null),i&&i.apply(this,arguments)})}:t}function o(t){return t?function(n,r){try{return t.call(e,n,r)}catch(e){if(!l(e))throw e}}:t}function a(t){return t?function(n,r,i,o){return t.call(e,n,r,i,function(e){l(e)&&(e=null),o&&o.apply(this,arguments)})}:t}function c(t){return t?function(n,r,i){try{return t.call(e,n,r,i)}catch(e){if(!l(e))throw e}}:t}function u(t){return t?function(n,r){return t.call(e,n,function(e,t){if(!t)return r.apply(this,arguments);t.uid<0&&(t.uid+=4294967296),t.gid<0&&(t.gid+=4294967296),r&&r.apply(this,arguments)})}:t}function h(t){return t?function(n){var r=t.call(e,n);return r.uid<0&&(r.uid+=4294967296),r.gid<0&&(r.gid+=4294967296),r}:t}function l(e){if(!e)return!0;if("ENOSYS"===e.code)return!0;var n=!t.getuid||0!==t.getuid();return!(!n||"EINVAL"!==e.code&&"EPERM"!==e.code)}e.read=(f=e.read,function(t,n,r,i,o,s){var a;if(s&&"function"==typeof s){var c=0;a=function(u,h,l){if(u&&"EAGAIN"===u.code&&c<10)return c++,f.call(e,t,n,r,i,o,a);s.apply(this,arguments)}}return f.call(e,t,n,r,i,o,a)}),e.readSync=(E=e.readSync,function(t,n,r,i,o){for(var s=0;;)try{return E.call(e,t,n,r,i,o)}catch(e){if("EAGAIN"===e.code&&s<10){s++;continue}throw e}});var E;var f}}).call(this,n(!function(){var e=new Error("Cannot find module './../process/browser.js'");throw e.code="MODULE_NOT_FOUND",e}()))},function(e){e.exports={O_RDONLY:0,O_WRONLY:1,O_RDWR:2,S_IFMT:61440,S_IFREG:32768,S_IFDIR:16384,S_IFCHR:8192,S_IFBLK:24576,S_IFIFO:4096,S_IFLNK:40960,S_IFSOCK:49152,O_CREAT:512,O_EXCL:2048,O_NOCTTY:131072,O_TRUNC:1024,O_APPEND:8,O_DIRECTORY:1048576,O_NOFOLLOW:256,O_SYNC:128,O_SYMLINK:2097152,O_NONBLOCK:4,S_IRWXU:448,S_IRUSR:256,S_IWUSR:128,S_IXUSR:64,S_IRWXG:56,S_IRGRP:32,S_IWGRP:16,S_IXGRP:8,S_IRWXO:7,S_IROTH:4,S_IWOTH:2,S_IXOTH:1,E2BIG:7,EACCES:13,EADDRINUSE:48,EADDRNOTAVAIL:49,EAFNOSUPPORT:47,EAGAIN:35,EALREADY:37,EBADF:9,EBADMSG:94,EBUSY:16,ECANCELED:89,ECHILD:10,ECONNABORTED:53,ECONNREFUSED:61,ECONNRESET:54,EDEADLK:11,EDESTADDRREQ:39,EDOM:33,EDQUOT:69,EEXIST:17,EFAULT:14,EFBIG:27,EHOSTUNREACH:65,EIDRM:90,EILSEQ:92,EINPROGRESS:36,EINTR:4,EINVAL:22,EIO:5,EISCONN:56,EISDIR:21,ELOOP:62,EMFILE:24,EMLINK:31,EMSGSIZE:40,EMULTIHOP:95,ENAMETOOLONG:63,ENETDOWN:50,ENETRESET:52,ENETUNREACH:51,ENFILE:23,ENOBUFS:55,ENODATA:96,ENODEV:19,ENOENT:2,ENOEXEC:8,ENOLCK:77,ENOLINK:97,ENOMEM:12,ENOMSG:91,ENOPROTOOPT:42,ENOSPC:28,ENOSR:98,ENOSTR:99,ENOSYS:78,ENOTCONN:57,ENOTDIR:20,ENOTEMPTY:66,ENOTSOCK:38,ENOTSUP:45,ENOTTY:25,ENXIO:6,EOPNOTSUPP:102,EOVERFLOW:84,EPERM:1,EPIPE:32,EPROTO:100,EPROTONOSUPPORT:43,EPROTOTYPE:41,ERANGE:34,EROFS:30,ESPIPE:29,ESRCH:3,ESTALE:70,ETIME:101,ETIMEDOUT:60,ETXTBSY:26,EWOULDBLOCK:35,EXDEV:18,SIGHUP:1,SIGINT:2,SIGQUIT:3,SIGILL:4,SIGTRAP:5,SIGABRT:6,SIGIOT:6,SIGBUS:10,SIGFPE:8,SIGKILL:9,SIGUSR1:30,SIGSEGV:11,SIGUSR2:31,SIGPIPE:13,SIGALRM:14,SIGTERM:15,SIGCHLD:20,SIGCONT:19,SIGSTOP:17,SIGTSTP:18,SIGTTIN:21,SIGTTOU:22,SIGURG:16,SIGXCPU:24,SIGXFSZ:25,SIGVTALRM:26,SIGPROF:27,SIGWINCH:28,SIGIO:23,SIGSYS:12,SSL_OP_ALL:2147486719,SSL_OP_ALLOW_UNSAFE_LEGACY_RENEGOTIATION:262144,SSL_OP_CIPHER_SERVER_PREFERENCE:4194304,SSL_OP_CISCO_ANYCONNECT:32768,SSL_OP_COOKIE_EXCHANGE:8192,SSL_OP_CRYPTOPRO_TLSEXT_BUG:2147483648,SSL_OP_DONT_INSERT_EMPTY_FRAGMENTS:2048,SSL_OP_EPHEMERAL_RSA:0,SSL_OP_LEGACY_SERVER_CONNECT:4,SSL_OP_MICROSOFT_BIG_SSLV3_BUFFER:32,SSL_OP_MICROSOFT_SESS_ID_BUG:1,SSL_OP_MSIE_SSLV2_RSA_PADDING:0,SSL_OP_NETSCAPE_CA_DN_BUG:536870912,SSL_OP_NETSCAPE_CHALLENGE_BUG:2,SSL_OP_NETSCAPE_DEMO_CIPHER_CHANGE_BUG:1073741824,SSL_OP_NETSCAPE_REUSE_CIPHER_CHANGE_BUG:8,SSL_OP_NO_COMPRESSION:131072,SSL_OP_NO_QUERY_MTU:4096,SSL_OP_NO_SESSION_RESUMPTION_ON_RENEGOTIATION:65536,SSL_OP_NO_SSLv2:16777216,SSL_OP_NO_SSLv3:33554432,SSL_OP_NO_TICKET:16384,SSL_OP_NO_TLSv1:67108864,SSL_OP_NO_TLSv1_1:268435456,SSL_OP_NO_TLSv1_2:134217728,SSL_OP_PKCS1_CHECK_1:0,SSL_OP_PKCS1_CHECK_2:0,SSL_OP_SINGLE_DH_USE:1048576,SSL_OP_SINGLE_ECDH_USE:524288,SSL_OP_SSLEAY_080_CLIENT_DH_BUG:128,SSL_OP_SSLREF2_REUSE_CERT_TYPE_BUG:0,SSL_OP_TLS_BLOCK_PADDING_BUG:512,SSL_OP_TLS_D5_BUG:256,SSL_OP_TLS_ROLLBACK_BUG:8388608,ENGINE_METHOD_DSA:2,ENGINE_METHOD_DH:4,ENGINE_METHOD_RAND:8,ENGINE_METHOD_ECDH:16,ENGINE_METHOD_ECDSA:32,ENGINE_METHOD_CIPHERS:64,ENGINE_METHOD_DIGESTS:128,ENGINE_METHOD_STORE:256,ENGINE_METHOD_PKEY_METHS:512,ENGINE_METHOD_PKEY_ASN1_METHS:1024,ENGINE_METHOD_ALL:65535,ENGINE_METHOD_NONE:0,DH_CHECK_P_NOT_SAFE_PRIME:2,DH_CHECK_P_NOT_PRIME:1,DH_UNABLE_TO_CHECK_GENERATOR:4,DH_NOT_SUITABLE_GENERATOR:8,NPN_ENABLED:1,RSA_PKCS1_PADDING:1,RSA_SSLV23_PADDING:2,RSA_NO_PADDING:3,RSA_PKCS1_OAEP_PADDING:4,RSA_X931_PADDING:5,RSA_PKCS1_PSS_PADDING:6,POINT_CONVERSION_COMPRESSED:2,POINT_CONVERSION_UNCOMPRESSED:4,POINT_CONVERSION_HYBRID:6,F_OK:0,R_OK:4,W_OK:2,X_OK:1,UV_UDP_REUSEADDR:4}},function(e,t,n){(function(t){var r=n(84).Stream;e.exports=function(e){return{ReadStream:function n(i,o){if(!(this instanceof n))return new n(i,o);r.call(this);var s=this;this.path=i;this.fd=null;this.readable=!0;this.paused=!1;this.flags="r";this.mode=438;this.bufferSize=65536;o=o||{};var a=Object.keys(o);for(var c=0,u=a.length;c<u;c++){var h=a[c];this[h]=o[h]}this.encoding&&this.setEncoding(this.encoding);if(void 0!==this.start){if("number"!=typeof this.start)throw TypeError("start must be a Number");if(void 0===this.end)this.end=1/0;else if("number"!=typeof this.end)throw TypeError("end must be a Number");if(this.start>this.end)throw new Error("start must be <= end");this.pos=this.start}if(null!==this.fd)return void t.nextTick(function(){s._read()});e.open(this.path,this.flags,this.mode,function(e,t){if(e)return s.emit("error",e),void(s.readable=!1);s.fd=t,s.emit("open",t),s._read()})},WriteStream:function t(n,i){if(!(this instanceof t))return new t(n,i);r.call(this);this.path=n;this.fd=null;this.writable=!0;this.flags="w";this.encoding="binary";this.mode=438;this.bytesWritten=0;i=i||{};var o=Object.keys(i);for(var s=0,a=o.length;s<a;s++){var c=o[s];this[c]=i[c]}if(void 0!==this.start){if("number"!=typeof this.start)throw TypeError("start must be a Number");if(this.start<0)throw new Error("start must be >= zero");this.pos=this.start}this.busy=!1;this._queue=[];null===this.fd&&(this._open=e.open,this._queue.push([this._open,this.path,this.flags,this.mode,void 0]),this.flush())}}}}).call(this,n(!function(){var e=new Error("Cannot find module './../process/browser.js'");throw e.code="MODULE_NOT_FOUND",e}()))},function(e,t,n){e.exports=i;var r=n(11).EventEmitter;function i(){r.call(this)}n(6)(i,r),i.Readable=n(15),i.Writable=n(91),i.Duplex=n(92),i.Transform=n(93),i.PassThrough=n(94),i.Stream=i,i.prototype.pipe=function(e,t){var n=this;function i(t){e.writable&&!1===e.write(t)&&n.pause&&n.pause()}function o(){n.readable&&n.resume&&n.resume()}n.on("data",i),e.on("drain",o),e._isStdio||t&&!1===t.end||(n.on("end",a),n.on("close",c));var s=!1;function a(){s||(s=!0,e.end())}function c(){s||(s=!0,"function"==typeof e.destroy&&e.destroy())}function u(e){if(h(),0===r.listenerCount(this,"error"))throw e}function h(){n.removeListener("data",i),e.removeListener("drain",o),n.removeListener("end",a),n.removeListener("close",c),n.removeListener("error",u),e.removeListener("error",u),n.removeListener("end",h),n.removeListener("close",h),e.removeListener("close",h)}return n.on("error",u),e.on("error",u),n.on("end",h),n.on("close",h),e.on("close",h),e.emit("pipe",n),e}},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t){},function(e,t,n){"use strict";var r=n(13).Buffer,i=n(88);e.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}return e.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},e.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},e.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},e.prototype.clear=function(){this.head=this.tail=null,this.length=0},e.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,n=""+t.data;t=t.next;)n+=e+t.data;return n},e.prototype.concat=function(e){if(0===this.length)return r.alloc(0);if(1===this.length)return this.head.data;for(var t,n,i,o=r.allocUnsafe(e>>>0),s=this.head,a=0;s;)t=s.data,n=o,i=a,t.copy(n,i),a+=s.data.length,s=s.next;return o},e}(),i&&i.inspect&&i.inspect.custom&&(e.exports.prototype[i.inspect.custom]=function(){var e=i.inspect({length:this.length});return this.constructor.name+" "+e})},function(e,t){},function(e,t,n){(function(t){function n(e){try{if(!t.localStorage)return!1}catch(e){return!1}var n=t.localStorage[e];return null!=n&&"true"===String(n).toLowerCase()}e.exports=function(e,t){if(n("noDeprecation"))return e;var r=!1;return function(){if(!r){if(n("throwDeprecation"))throw new Error(t);n("traceDeprecation")?console.trace(t):console.warn(t),r=!0}return e.apply(this,arguments)}}}).call(this,n(5))},function(e,t,n){"use strict";e.exports=o;var r=n(31),i=n(10);function o(e){if(!(this instanceof o))return new o(e);r.call(this,e)}i.inherits=n(6),i.inherits(o,r),o.prototype._transform=function(e,t,n){n(null,e)}},function(e,t,n){e.exports=n(16)},function(e,t,n){e.exports=n(7)},function(e,t,n){e.exports=n(15).Transform},function(e,t,n){e.exports=n(15).PassThrough},function(e,t,n){"use strict";e.exports=function(e){if(null===e||"object"!=typeof e)return e;if(e instanceof Object)var t={__proto__:e.__proto__};else var t=Object.create(null);return Object.getOwnPropertyNames(e).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))}),t}},function(e,t){e.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},function(e,t,n){"use strict";(function(t){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
function r(e,t){if(e===t)return 0;for(var n=e.length,r=t.length,i=0,o=Math.min(n,r);i<o;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0}function i(e){return t.Buffer&&"function"==typeof t.Buffer.isBuffer?t.Buffer.isBuffer(e):!(null==e||!e._isBuffer)}var o=n(17),s=Object.prototype.hasOwnProperty,a=Array.prototype.slice,c="foo"===function(){}.name;function u(e){return Object.prototype.toString.call(e)}function h(e){return!i(e)&&("function"==typeof t.ArrayBuffer&&("function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):!!e&&(e instanceof DataView||!!(e.buffer&&e.buffer instanceof ArrayBuffer))))}var l=e.exports=T,E=/\s*function\s+([^\(\s]*)\s*/;function f(e){if(o.isFunction(e)){if(c)return e.name;var t=e.toString().match(E);return t&&t[1]}}function d(e,t){return"string"==typeof e?e.length<t?e:e.slice(0,t):e}function p(e){if(c||!o.isFunction(e))return o.inspect(e);var t=f(e);return"[Function"+(t?": "+t:"")+"]"}function S(e,t,n,r,i){throw new l.AssertionError({message:n,actual:e,expected:t,operator:r,stackStartFunction:i})}function T(e,t){e||S(e,!0,t,"==",l.ok)}function _(e,t,n,s){if(e===t)return!0;if(i(e)&&i(t))return 0===r(e,t);if(o.isDate(e)&&o.isDate(t))return e.getTime()===t.getTime();if(o.isRegExp(e)&&o.isRegExp(t))return e.source===t.source&&e.global===t.global&&e.multiline===t.multiline&&e.lastIndex===t.lastIndex&&e.ignoreCase===t.ignoreCase;if(null!==e&&"object"==typeof e||null!==t&&"object"==typeof t){if(h(e)&&h(t)&&u(e)===u(t)&&!(e instanceof Float32Array||e instanceof Float64Array))return 0===r(new Uint8Array(e.buffer),new Uint8Array(t.buffer));if(i(e)!==i(t))return!1;var c=(s=s||{actual:[],expected:[]}).actual.indexOf(e);return-1!==c&&c===s.expected.indexOf(t)||(s.actual.push(e),s.expected.push(t),function(e,t,n,r){if(null==e||null==t)return!1;if(o.isPrimitive(e)||o.isPrimitive(t))return e===t;if(n&&Object.getPrototypeOf(e)!==Object.getPrototypeOf(t))return!1;var i=C(e),s=C(t);if(i&&!s||!i&&s)return!1;if(i)return e=a.call(e),t=a.call(t),_(e,t,n);var c,u,h=N(e),l=N(t);if(h.length!==l.length)return!1;for(h.sort(),l.sort(),u=h.length-1;u>=0;u--)if(h[u]!==l[u])return!1;for(u=h.length-1;u>=0;u--)if(c=h[u],!_(e[c],t[c],n,r))return!1;return!0}(e,t,n,s))}return n?e===t:e==t}function C(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function R(e,t){if(!e||!t)return!1;if("[object RegExp]"==Object.prototype.toString.call(t))return t.test(e);try{if(e instanceof t)return!0}catch(e){}return!Error.isPrototypeOf(t)&&!0===t.call({},e)}function O(e,t,n,r){var i;if("function"!=typeof t)throw new TypeError('"block" argument must be a function');"string"==typeof n&&(r=n,n=null),i=function(e){var t;try{e()}catch(e){t=e}return t}(t),r=(n&&n.name?" ("+n.name+").":".")+(r?" "+r:"."),e&&!i&&S(i,n,"Missing expected exception"+r);var s="string"==typeof r,a=!e&&i&&!n;if((!e&&o.isError(i)&&s&&R(i,n)||a)&&S(i,n,"Got unwanted exception"+r),e&&i&&n&&!R(i,n)||!e&&i)throw i}l.AssertionError=function(e){var t;this.name="AssertionError",this.actual=e.actual,this.expected=e.expected,this.operator=e.operator,e.message?(this.message=e.message,this.generatedMessage=!1):(this.message=d(p((t=this).actual),128)+" "+t.operator+" "+d(p(t.expected),128),this.generatedMessage=!0);var n=e.stackStartFunction||S;if(Error.captureStackTrace)Error.captureStackTrace(this,n);else{var r=new Error;if(r.stack){var i=r.stack,o=f(n),s=i.indexOf("\n"+o);if(s>=0){var a=i.indexOf("\n",s+1);i=i.substring(a+1)}this.stack=i}}},o.inherits(l.AssertionError,Error),l.fail=S,l.ok=T,l.equal=function(e,t,n){e!=t&&S(e,t,n,"==",l.equal)},l.notEqual=function(e,t,n){e==t&&S(e,t,n,"!=",l.notEqual)},l.deepEqual=function(e,t,n){_(e,t,!1)||S(e,t,n,"deepEqual",l.deepEqual)},l.deepStrictEqual=function(e,t,n){_(e,t,!0)||S(e,t,n,"deepStrictEqual",l.deepStrictEqual)},l.notDeepEqual=function(e,t,n){_(e,t,!1)&&S(e,t,n,"notDeepEqual",l.notDeepEqual)},l.notDeepStrictEqual=function e(t,n,r){_(t,n,!0)&&S(t,n,r,"notDeepStrictEqual",e)},l.strictEqual=function(e,t,n){e!==t&&S(e,t,n,"===",l.strictEqual)},l.notStrictEqual=function(e,t,n){e===t&&S(e,t,n,"!==",l.notStrictEqual)},l.throws=function(e,t,n){O(!0,e,t,n)},l.doesNotThrow=function(e,t,n){O(!1,e,t,n)},l.ifError=function(e){if(e)throw e};var N=Object.keys||function(e){var t=[];for(var n in e)s.call(e,n)&&t.push(n);return t}}).call(this,n(5))},function(e,t,n){t.asyncMap=n(99),t.bindActor=n(32),t.chain=n(100)},function(e,t,n){(function(t){e.exports=function(){var e=Array.prototype.slice.call(arguments),n=e.shift()||[],r=e.pop();if("function"!=typeof r)throw new Error("No callback provided to asyncMap");if(!n)return r(null,[]);Array.isArray(n)||(n=[n]);var i=e.length,o=[],s=null,a=n.length,c=a*i;if(!c)return r(null,[]);function u(h){h&&!s&&(s=h);for(var l=arguments.length,E=1;E<l;E++)void 0!==arguments[E]&&(o[E-1]=(o[E-1]||[]).concat(arguments[E]));if(n.length>a){var f=n.slice(a);c+=(n.length-a)*i,a=n.length,t.nextTick(function(){f.forEach(function(t){e.forEach(function(e){e(t,u)})})})}0==--c&&r.apply(null,[s].concat(o))}n.forEach(function(t){e.forEach(function(e){e(t,u)})})}}).call(this,n(!function(){var e=new Error("Cannot find module './../../process/browser.js'");throw e.code="MODULE_NOT_FOUND",e}()))},function(e,t,n){e.exports=i;var r=n(32);function i(e,t){var n=[];!function o(s,a){return s>=a?t(null,n):(Array.isArray(e[s])&&(e[s]=r.apply(null,e[s].map(function(e){return e===i.first?n[0]:e===i.last?n[n.length-1]:e}))),e[s]?void e[s](function(e,r){if(e)return t(e,n);void 0!==r&&(n=n.concat(r)),o(s+1,a)}):o(s+1,a))}(0,e.length)}i.first={},i.last={}},function(e,t,n){
/**
 * @preserve
 * JS Implementation of incremental MurmurHash3 (r150) (as of May 10, 2013)
 *
 * @author <a href="mailto:jensyt@gmail.com">Jens Taylor</a>
 * @see http://github.com/homebrewing/brauhaus-diff
 * @author <a href="mailto:gary.court@gmail.com">Gary Court</a>
 * @see http://github.com/garycourt/murmurhash-js
 * @author <a href="mailto:aappleby@gmail.com">Austin Appleby</a>
 * @see http://sites.google.com/site/murmurhash/
 */
!function(){var t;function n(e,r){var i=this instanceof n?this:t;if(i.reset(r),"string"==typeof e&&e.length>0&&i.hash(e),i!==this)return i}n.prototype.hash=function(e){var t,n,r,i,o;switch(o=e.length,this.len+=o,n=this.k1,r=0,this.rem){case 0:n^=o>r?65535&e.charCodeAt(r++):0;case 1:n^=o>r?(65535&e.charCodeAt(r++))<<8:0;case 2:n^=o>r?(65535&e.charCodeAt(r++))<<16:0;case 3:n^=o>r?(255&e.charCodeAt(r))<<24:0,n^=o>r?(65280&e.charCodeAt(r++))>>8:0}if(this.rem=o+this.rem&3,(o-=this.rem)>0){for(t=this.h1;t=5*(t=(t^=n=13715*(n=(n=11601*n+3432906752*(65535&n)&4294967295)<<15|n>>>17)+461832192*(65535&n)&4294967295)<<13|t>>>19)+3864292196&4294967295,!(r>=o);)n=65535&e.charCodeAt(r++)^(65535&e.charCodeAt(r++))<<8^(65535&e.charCodeAt(r++))<<16,n^=(255&(i=e.charCodeAt(r++)))<<24^(65280&i)>>8;switch(n=0,this.rem){case 3:n^=(65535&e.charCodeAt(r+2))<<16;case 2:n^=(65535&e.charCodeAt(r+1))<<8;case 1:n^=65535&e.charCodeAt(r)}this.h1=t}return this.k1=n,this},n.prototype.result=function(){var e,t;return e=this.k1,t=this.h1,e>0&&(t^=e=13715*(e=(e=11601*e+3432906752*(65535&e)&4294967295)<<15|e>>>17)+461832192*(65535&e)&4294967295),t^=this.len,t=51819*(t^=t>>>16)+2246770688*(65535&t)&4294967295,t=44597*(t^=t>>>13)+3266445312*(65535&t)&4294967295,(t^=t>>>16)>>>0},n.prototype.reset=function(e){return this.h1="number"==typeof e?e:0,this.rem=this.k1=this.len=0,this},t=new n,e.exports=n}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(1),i=n(0),o=n(2),s="OE";t.PresenceHandler=class{constructor(e,t){this.services=e,this.subscriptionEmitter=new o,this.globalSubscriptionEmitter=new o,this.queryEmitter=new o,this.queryAllEmitter=new o,this.services.connection.registerHandler(i.TOPIC.PRESENCE,this.handle.bind(this)),this.services.connection.onExitLimbo(this.onExitLimbo.bind(this)),this.services.connection.onLost(this.onExitLimbo.bind(this)),this.services.connection.onReestablished(this.onConnectionReestablished.bind(this)),this.counter=0,this.pendingSubscribes=new Set,this.pendingUnsubscribes=new Set,this.limboQueue=[],this.flushTimeout=null}subscribe(e,t){if("string"==typeof e&&e.length>0&&"function"==typeof t){const n=e;return this.subscriptionEmitter.hasListeners(n)||this.pendingSubscribes.add(n),this.subscriptionEmitter.on(n,t),this.pendingUnsubscribes.delete(n),void this.registerFlushTimeout()}if("function"==typeof e&&void 0===t)return this.globalSubscriptionEmitter.hasListeners(s)||this.subscribeToAllChanges(),void this.globalSubscriptionEmitter.on(s,e);throw new Error('invalid arguments: "user" or "callback"')}unsubscribe(e,t){if(!(e&&"string"==typeof e&&e.length>0)){if(e&&"function"==typeof e)return t=e,this.globalSubscriptionEmitter.off(s,t),void(this.globalSubscriptionEmitter.hasListeners(s)||this.unsubscribeToAllChanges());if(void 0===e&&void 0===t){this.subscriptionEmitter.off(),this.globalSubscriptionEmitter.off(),this.pendingSubscribes.clear();const e=this.subscriptionEmitter.eventNames();for(let t=0;t<e.length;t++)this.pendingUnsubscribes.add(e[t]);return this.registerFlushTimeout(),void this.unsubscribeToAllChanges()}throw new Error('invalid argument: "user" or "callback"')}{const n=e;if(t){if("function"!=typeof t)throw new Error('invalid argument: "callback"');this.subscriptionEmitter.off(n,t)}else this.subscriptionEmitter.off(n);this.subscriptionEmitter.hasListeners(n)||(this.pendingSubscribes.delete(n),this.pendingUnsubscribes.add(n),this.registerFlushTimeout())}}getAll(...e){const{callback:t,users:n}=function(e){let t=null,n=null;if(1===e.length)if(Array.isArray(e[0]))t=e[0];else{if("function"!=typeof e[0])throw new Error('invalid argument: "callback"');n=e[0]}else if(2===e.length&&(t=e[0],n=e[1],!Array.isArray(t)||"function"!=typeof n))throw new Error('invalid argument: "users" or "callback"');return{users:t,callback:n}}(e);let o,a,c;if(n){const e=(this.counter++).toString();o={topic:i.TOPIC.PRESENCE,action:i.PRESENCE_ACTIONS.QUERY,correlationId:e,names:n},a=this.queryEmitter,c=e}else o={topic:i.TOPIC.PRESENCE,action:i.PRESENCE_ACTIONS.QUERY_ALL},a=this.queryAllEmitter,c=s;if(this.services.connection.isConnected?this.sendQuery(o):this.services.connection.isInLimbo?this.limboQueue.push(o):this.services.timerRegistry.requestIdleCallback(()=>{a.emit(c,r.EVENT.CLIENT_OFFLINE)}),!t)return new Promise((e,t)=>{a.once(c,(n,r)=>n?t(n):e(r))});a.once(c,t)}handle(e){if(e.isAck)this.services.timeoutRegistry.remove(e);else{if(e.action===i.PRESENCE_ACTIONS.QUERY_ALL_RESPONSE)return this.queryAllEmitter.emit(s,null,e.names),void this.services.timeoutRegistry.remove(e);if(e.action===i.PRESENCE_ACTIONS.QUERY_RESPONSE)return this.queryEmitter.emit(e.correlationId,null,e.parsedData),void this.services.timeoutRegistry.remove(e);if(e.action!==i.PRESENCE_ACTIONS.PRESENCE_JOIN)if(e.action!==i.PRESENCE_ACTIONS.PRESENCE_JOIN_ALL)if(e.action!==i.PRESENCE_ACTIONS.PRESENCE_LEAVE){if(e.action!==i.PRESENCE_ACTIONS.PRESENCE_LEAVE_ALL)return e.isError?(this.services.timeoutRegistry.remove(e),void(e.originalAction===i.PRESENCE_ACTIONS.QUERY?this.queryEmitter.emit(e.correlationId,i.PRESENCE_ACTIONS[e.action]):e.originalAction===i.PRESENCE_ACTIONS.QUERY_ALL?this.queryAllEmitter.emit(s,i.PRESENCE_ACTIONS[e.action]):this.services.logger.error(e))):void this.services.logger.error(e,r.EVENT.UNSOLICITED_MESSAGE);this.globalSubscriptionEmitter.emit(s,e.name,!1)}else this.subscriptionEmitter.emit(e.name,e.name,!1);else this.globalSubscriptionEmitter.emit(s,e.name,!0);else this.subscriptionEmitter.emit(e.name,e.name,!0)}}sendQuery(e){this.services.connection.sendMessage(e),this.services.timeoutRegistry.add({message:e})}flush(){if(!this.services.connection.isConnected)return;const e=Array.from(this.pendingSubscribes.keys());e.length>0&&(this.bulkSubscription(i.PRESENCE_ACTIONS.SUBSCRIBE,e),this.pendingSubscribes.clear());const t=Array.from(this.pendingUnsubscribes.keys());t.length>0&&(this.bulkSubscription(i.PRESENCE_ACTIONS.UNSUBSCRIBE,t),this.pendingUnsubscribes.clear()),this.flushTimeout=null}bulkSubscription(e,t){const n=this.counter++,r={topic:i.TOPIC.PRESENCE,action:e,correlationId:n.toString(),names:t};this.services.timeoutRegistry.add({message:r}),this.services.connection.sendMessage(r)}subscribeToAllChanges(){if(!this.services.connection.isConnected)return;const e={topic:i.TOPIC.PRESENCE,action:i.PRESENCE_ACTIONS.SUBSCRIBE_ALL};this.services.timeoutRegistry.add({message:e}),this.services.connection.sendMessage(e)}unsubscribeToAllChanges(){if(!this.services.connection.isConnected)return;const e={topic:i.TOPIC.PRESENCE,action:i.PRESENCE_ACTIONS.UNSUBSCRIBE_ALL};this.services.timeoutRegistry.add({message:e}),this.services.connection.sendMessage(e)}registerFlushTimeout(){this.flushTimeout||(this.flushTimeout=this.services.timerRegistry.add({duration:0,context:this,callback:this.flush}))}onConnectionReestablished(){const e=this.subscriptionEmitter.eventNames();e.length>0&&this.bulkSubscription(i.PRESENCE_ACTIONS.SUBSCRIBE,e),this.globalSubscriptionEmitter.hasListeners(s)&&this.subscribeToAllChanges();for(let e=0;e<this.limboQueue.length;e++)this.sendQuery(this.limboQueue[e]);this.limboQueue=[]}onExitLimbo(){this.queryEmitter.eventNames().forEach(e=>{this.queryEmitter.emit(e,r.EVENT.CLIENT_OFFLINE)}),this.queryAllEmitter.emit(s,r.EVENT.CLIENT_OFFLINE),this.limboQueue=[],this.queryAllEmitter.off(),this.queryEmitter.off()}}}])});